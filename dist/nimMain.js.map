{"version":3,"sources":["../webpack/bootstrap","../external \"vscode\"",".././src/nimUtils.ts",".././src/nimSuggestExec.ts","../external \"fs\"","../external \"path\"","../external \"child_process\"","../external \"util\"",".././node_modules/underscore/underscore.js",".././node_modules/nedb/lib/model.js",".././node_modules/async/lib/async.js",".././src/nimMode.ts","../external \"os\"",".././src/nimImports.ts",".././src/nimIndexer.ts",".././node_modules/nedb/lib/customUtils.js",".././node_modules/nedb/lib/indexes.js",".././node_modules/binary-search-tree/lib/bst.js",".././node_modules/binary-search-tree/lib/customUtils.js",".././src/nimStatus.ts",".././src/nimMain.ts",".././src/elrpc/elrpc.ts","../external \"net\"",".././src/elrpc/sexp.ts","../external \"readline\"",".././src/nimSuggest.ts",".././src/nimDeclaration.ts",".././src/nimReferences.ts",".././src/nimHover.ts",".././src/nimRename.ts",".././src/nimOutline.ts",".././node_modules/nedb/index.js",".././node_modules/nedb/lib/datastore.js","../external \"crypto\"",".././node_modules/nedb/lib/executor.js",".././node_modules/binary-search-tree/index.js",".././node_modules/binary-search-tree/lib/avltree.js",".././node_modules/nedb/lib/persistence.js",".././node_modules/nedb/lib/storage.js",".././node_modules/mkdirp/index.js",".././node_modules/nedb/lib/cursor.js","../external \"events\"",".././src/nimSignature.ts",".././src/nimFormatting.ts",".././src/nimBuild.ts"],"names":["installedModules","__webpack_require__","moduleId","exports","module","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","prototype","hasOwnProperty","p","s","require","_pathesCache","_projects","_projectMapping","path","getBinPath","vscode","window","showInformationMessage","filePath","isAbsolute","workspaceFolder","workspace","getWorkspaceFolder","Uri","file","wsFolder","asRelativePath","workspaceFolders","length","parsedPath","split","folder","substr","parse","uri","dir","index","base","project","with","fsPath","tool","process","env","delimiter","pathparts","PATH","map","join","correctBinname","filter","candidate","fs","existsSync","platform","nimPath","cp","execFileSync","toString","trim","normalize","dirname","e","binname","_channel","createOutputChannel","padStart","len","input","out","scheme","toLowerCase","startsWith","nimPrettyPath","resolve","getNimExecPath","nimblePath","filename","isProjectMode","projectInfo","uriPath","forEach","mapping","fileRegex","test","toProjectInfo","replace","projectPath","toLocalFile","document","dirtyFilePath","os","tmpdir","writeFileSync","getText","config","getConfiguration","projects","Array","push","findFiles","then","result","projectMapping","RegExp","readdirSync","curPath","lstatSync","isDirectory","removeDirSync","unlinkSync","rmdirSync","message","channel","getOutputChannel","timeNow","Date","date","appendLine","getFullYear","getMonth","getDate","getHours","getMinutes","getSeconds","getMilliseconds","nimSuggestProcessCache","NimSuggestType","_nimSuggestPath","_nimSuggestVersion","answerType","suggest","names","type","line","column","documentation","Range","this","Position","Location","position","slice","trace","pid","projectFile","msg","console","log","desc","rpc","stop","kill","undefined","version","nimVersionParts","versionParts","Math","min","diff","parseInt","prepareConfig","nimSuggestNewPath","versionOutput","spawnSync","getNimSuggestPath","cwd","rootPath","output","versionArgs","exec","onDidChangeConfiguration","suggestType","dirtyFile","extname","getProjectFileInfo","normalizedFilename","nimProject","backend","rd","createInterface","createReadStream","on","tokens","Promise","reject","nimConfig","args","spawn","stdout","once","data","dataStr","portNumber","isNaN","elrpc","startClient","peer","stderr","code","signal","error","getNimSuggestProcess","suggestCmd","ret","callMethod","kind","str","parts","item","NimSuggestResult","doc","closeNimSuggestProcess","res","visibleTextEditors","every","array","root","previousUnderscore","_","breaker","ArrayProto","ObjProto","FuncProto","Function","concat","nativeForEach","nativeMap","nativeReduce","reduce","nativeReduceRight","reduceRight","nativeFilter","nativeEvery","nativeSome","some","nativeIndexOf","indexOf","nativeLastIndexOf","lastIndexOf","nativeIsArray","isArray","nativeKeys","keys","nativeBind","obj","_wrapped","VERSION","each","iterator","context","has","collect","results","list","reduceError","foldl","inject","memo","initial","arguments","TypeError","foldr","find","detect","any","select","all","identity","contains","include","target","invoke","method","isFunc","isFunction","apply","pluck","where","attrs","first","isEmpty","findWhere","max","Infinity","computed","shuffle","rand","shuffled","random","lookupIterator","sortBy","criteria","sort","left","right","a","b","group","behavior","groupBy","countBy","sortedIndex","low","high","mid","toArray","values","size","head","take","guard","last","rest","tail","drop","compact","flatten","shallow","without","difference","uniq","unique","isSorted","seen","union","intersection","other","zip","from","hasIndex","range","start","step","ceil","idx","func","partial","bindAll","funcs","functions","f","memoize","hasher","delay","wait","setTimeout","defer","throttle","timeout","previous","later","now","remaining","clearTimeout","debounce","immediate","callNow","ran","wrap","wrapper","compose","after","times","pairs","invert","methods","extend","source","prop","pick","copy","omit","defaults","clone","isObject","tap","interceptor","eq","aStack","bStack","className","String","global","multiline","ignoreCase","aCtor","constructor","bCtor","pop","isEqual","isString","isElement","nodeType","isArguments","isFinite","parseFloat","isNumber","isBoolean","isNull","isUndefined","noConflict","accum","floor","entityMap","escape","unescape","entityRegexes","string","match","mixin","idCounter","uniqueId","prefix","id","templateSettings","evaluate","interpolate","noMatch","escapes","escaper","template","text","settings","render","matcher","offset","variable","chain","_chain","util","modifierFunctions","lastStepModifierFunctions","comparisonFunctions","logicalOperators","arrayComparisonFunctions","checkKey","k","v","Error","checkObject","deepCopy","strictKeys","isDate","isPrimitiveType","compareNSB","compareArrays","comp","compareThings","_compareStrings","aKeys","bKeys","compareStrings","getTime","getDotValue","field","objs","fieldParts","areThingsEqual","areComparable","query","queryKeys","queryKey","queryValue","matchQueryPart","needAKey","treatObjAsValue","firstChars","dollarFirstChars","objValue","isRegExp","$regex","$set","$unset","$push","$slice","$each","end","$addToSet","addToSet","$pop","$pull","arr","splice","$inc","$max","$min","modifier","createModifierFunction","$lt","$lte","$gt","$gte","$ne","$in","$nin","$exists","exists","$size","$elemMatch","$or","$and","$not","$where","fn","serialize","JSON","stringify","$$date","deserialize","rawData","modify","updateQuery","newDoc","modifiers","_id","previous_async","async","only_once","called","_each","_map","x","_keys","nextTick","setImmediate","callback","completed","err","eachSeries","iterate","forEachSeries","eachLimit","limit","_eachLimit","forEachLimit","started","running","replenish","doParallel","doSeries","_asyncMap","eachfn","mapSeries","mapLimit","_mapLimit","doParallelLimit","reversed","reverse","_filter","filterSeries","selectSeries","_reject","rejectSeries","_detect","main_callback","detectSeries","auto","tasks","listeners","addListener","unshift","taskComplete","task","taskCallback","safeResults","rkey","requires","abs","ready","listener","removeListener","waterfall","wrapIterator","next","_parallel","parallel","parallelLimit","series","makeCallback","_concat","cb","y","concatSeries","whilst","doWhilst","until","doUntil","queue","worker","concurrency","_insert","q","pos","saturated","workers","empty","drain","shift","cargo","payload","working","ts","ds","_console_fn","queues","memoized","unmemoized","unmemoize","count","counter","timesSeries","fns","that","newargs","nextargs","_applyEach","go","applyEach","applyEachSeries","forever","NIM_MODE","language","NimbleModuleInfo","NimModuleInfo","nimbleModules","nimModules","createNimModule","projectDir","rootDir","fullPath","nimModule","moduleDir","sep","fullName","walkDir","singlePass","readdir","files","statSync","endsWith","nimDirectories","part","getNimDirectories","nimRoot","dirPath","nimbleModuleNames","getNimbleExecPath","getNimbleModules","moduleName","execSync","nimbleModule","substring","author","description","suggestions","suggestion","CompletionItem","CompletionItemKind","Module","detail","MarkdownString","insertText","initNimbleModules","getProjects","initNimDirectories","basename","items","dbFiles","dbTypes","execNimSuggest","outline","symbols","containerName","symbolInfo","SymbolInformation","symbolName","SymbolKind","Constant","Enum","Variable","Method","Interface","Class","Property","vscodeKindFromNimSym","catch","reason","timestamp","mtime","findOne","findFile","infos","getFileSymbols","remove","multi","insert","ws","location","range_start","range_end","container","cleanOldDb","basePath","dbPath","getDbName","indexFile","removeFromIndex","extensionPath","Datastore","autoload","persistence","setAutocompactionInterval","ensureIndex","fieldName","urls","showNimProgress","cnt","updateNimProgress","hideNimProgress","reg","docs","_line","_character","crypto","uid","randomBytes","BinarySearchTree","AVLTree","model","checkValueEquality","projectForUnique","elt","Index","options","sparse","treeOptions","compareKeys","reset","newData","tree","failingI","insertMultipleDocs","delete","self","_key","update","oldDoc","updateMultipleDocs","revertUpdate","revert","pair","getMatching","_res","search","getBetweenBounds","betweenBounds","getAll","executeOnEveryNode","node","customUtils","parent","defaultCompareKeysFunction","defaultCheckValueEquality","append","toAppend","getMaxKeyDescendant","getMaxKey","getMinKeyDescendant","getMinKey","checkAllNodesFullfillCondition","checkNodeOrdering","checkInternalPointers","checkIsBST","getNumberOfKeys","createSimilar","createLeftChild","leftChild","createRightChild","rightChild","errorType","getLowerBoundMatcher","getUpperBoundMatcher","lbm","ubm","deleteIfLeaf","deleteIfOnlyOneChild","child","replaceWith","prettyPrint","printData","spacing","getRandomArray","statusBarEntry","progressBarEntry","activeTextEditor","languages","show","hide","dispose","command","tooltip","createStatusBarItem","StatusBarAlignment","Right","Number","MIN_VALUE","color","diagnosticCollection","fileWatcher","terminal","runCheck","languageId","fileName","withProgress","ProgressLocation","Window","cancellable","title","progress","check","errors","clear","diagnosticMap","Map","targetUri","endColumn","diagnostic","Diagnostic","sev","DiagnosticSeverity","Warning","mapSeverityToVSCodeSeverity","severity","diagnostics","set","entries","diags","runFile","editor","createTerminal","isUntitled","sendText","getDirtyFile","outputDirConfig","outputParams","mkdirSync","isDirty","save","success","ctx","subscriptions","commands","registerCommand","execSelectionInTerminal","initNimSuggest","registerCompletionItemProvider","NimCompletionItemProvider","registerDefinitionProvider","NimDefinitionProvider","registerReferenceProvider","NimReferenceProvider","registerRenameProvider","NimRenameProvider","registerDocumentSymbolProvider","NimDocumentSymbolProvider","registerSignatureHelpProvider","NimSignatureHelpProvider","registerHoverProvider","NimHoverProvider","registerDocumentFormattingEditProvider","NimFormattingProvider","createDiagnosticCollection","setLanguageConfiguration","onEnterRules","beforeText","action","indentAction","IndentAction","None","appendText","raw","Indent","Outdent","wordPattern","onDidChangeActiveTextEditor","showHideStatus","onDidCloseTerminal","processId","activateEvalConsole","indexer","initWorkspace","createFileSystemWatcher","onDidCreate","stat","stats","edit","WorkspaceEdit","applyEdit","addFileToImports","onDidDelete","removeFileFromImports","registerWorkspaceSymbolProvider","NimWorkspaceSymbolProvider","onDidSaveTextDocument","executeCommand","setInterval","closeAllNimSuggestProcesses","initImports","outputLine","socket","sessions","socketClosed","receivedBuffer","Buffer","content","sexp","parseSExp","guid","handle","session","parameter","elements","write","TextEncoder","encode","destroy","port","net","createConnection","EPCPeer","toJS","car","cdr","element","ident","stringRepr","ptr","parseSymbol","symbolStart","sym","parseString","hasEscapes","startPos","parseListOrCon","cons","token","getWordRangeAtPosition","txt","lineAt","txtPart","getImports","sug","character","Value","Keyword","Snippet","Field","nimSymDetails","sortText","def","saveAll","use","references","label","hoverLabel","Hover","newName","endPosition","findWorkspaceSymbols","Executor","Persistence","Cursor","inMemoryOnly","timestampData","db","nodeWebkitAppName","afterSerialization","beforeDeserialization","corruptAlertThreshold","executor","indexes","ttlIndexes","loadDatabase","onload","inherits","EventEmitter","getAllData","resetIndexes","missingFieldName","expireAfterSeconds","persistNewState","$$indexCreated","removeIndex","$$indexRemoved","addToIndexes","failingIndex","removeFromIndexes","updateIndexes","getCandidates","dontExpireStaleDocs","usableQueryKeys","indexNames","expiredDocsIds","validDocs","ttlIndexesFieldNames","valid","_remove","preparedDoc","prepareDocumentForInsertion","_insertInCache","createNewId","tentativeId","createdAt","updatedAt","_insertMultipleDocsInCache","preparedDocs","cursor","projection","_update","upsert","numReplaced","_exec","toBeInserted","modifiedDoc","modifications","candidates","updatedDocs","returnUpdatedDocs","updatedDocsDC","numRemoved","removedDocs","$$deleted","buffer","newArguments","lastArg","forceQueuing","processBuffer","_AVLTree","checkHeightCorrect","leftH","rightH","height","balanceFactor","checkBalanceFactors","checkIsAVLT","super_","rightRotation","ah","bh","ch","leftRotation","rightTooSmall","leftTooSmall","rebalanceAlongPath","rotated","newRoot","insertPath","currentNode","newTree","deletePath","storage","j","randomString","charAt","getNWAppFilename","ensureDirectoryExists","mkdirp","appName","relativeFilename","home","LOCALAPPDATA","APPDATA","HOME","persistCachedDatabase","toPersist","crashSafeWriteFile","emit","compactDatafile","interval","realInterval","stopAutocompaction","autocompactionIntervalId","clearInterval","newDocs","appendFile","treatRawData","dataById","tdata","corruptItems","ensureDatafileIntegrity","readFile","treatedData","rename","writeFile","unlink","ensureFileDoesntExist","flushToStorage","flags","isDir","open","fd","fsync","errFS","close","errC","errorOnFsync","errorOnClose","tempFilename","filenameExists","oldFilenameExists","_0777","mkdirP","opts","made","xfs","mkdir","er","er2","sync","err0","err1","execFn","_limit","skip","_skip","sortQuery","_sort","_projection","keepId","toPush","_callback","added","skipped","direction","criterion","compare","currentArgument","identBeforeDot","lines","cursorX","cursorY","bracketsWithin","dotPosition","con","signatures","SignatureHelp","isModule","activeSignature","signature","SignatureInformation","genericsCleanType","insideGeneric","signatureCutDown","parameters","ParameterInformation","activeParameter","getNimPrettyExecPath","status","readFileSync","validateRange","TextEdit","executors","nimExec","useStdErr","initialized","ps","EOL","lfSplit","parseErrors","messageText","lastFile","lineStr","charStr","isWorkspaceFile","evalTerminal","runningToolsPromises","chk","parseNimsuggestErrors","resultSets","selection"],"mappings":"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","file":"nimMain.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 19);\n","module.exports = require(\"vscode\");","/*---------------------------------------------------------\r\n * Copyright (C) Xored Software Inc. All rights reserved.\r\n * Licensed under the MIT License. See LICENSE in the project root for license information.\r\n *--------------------------------------------------------*/\r\n\r\n'use strict';\r\n\r\nimport fs = require('fs');\r\nimport path = require('path');\r\nimport os = require('os');\r\nimport cp = require('child_process');\r\nimport vscode = require('vscode');\r\n\r\nexport interface ProjectFileInfo {\r\n    wsFolder: vscode.WorkspaceFolder;\r\n    filePath: string;\r\n}\r\n\r\nexport interface ProjectMappingInfo {\r\n    fileRegex: RegExp;\r\n    projectPath: string;\r\n}\r\n\r\nlet _pathesCache: { [tool: string]: string; } = {};\r\nvar _projects: ProjectFileInfo[] = [];\r\nvar _projectMapping: ProjectMappingInfo[] = [];\r\n\r\nexport function getNimExecPath(): string {\r\n    let path = getBinPath('nim');\r\n    if (!path) {\r\n        vscode.window.showInformationMessage('No \\'nim\\' binary could be found in PATH environment variable');\r\n    }\r\n    return path;\r\n}\r\n\r\n/**\r\n * Returns true if path related to any workspace folders,\r\n *\r\n * @param filePath absolute file path\r\n */\r\nexport function isWorkspaceFile(filePath: string): boolean {\r\n    if (vscode.workspace.workspaceFolders) {\r\n        for (const wsFolder of vscode.workspace.workspaceFolders) {\r\n            if (wsFolder.uri.scheme === 'file' &&\r\n                filePath.toLowerCase().startsWith(wsFolder.uri.fsPath.toLowerCase())) {\r\n                return true;\r\n            }\r\n        }\r\n    }\r\n    return false;\r\n}\r\n\r\n/**\r\n * Return project info from file path.\r\n *\r\n * @param filePath relative or absolite file path\r\n */\r\nexport function toProjectInfo(filePath: string): ProjectFileInfo {\r\n    if (path.isAbsolute(filePath)) {\r\n        let workspaceFolder = vscode.workspace.getWorkspaceFolder(vscode.Uri.file(filePath));\r\n        if (workspaceFolder) {\r\n            return { wsFolder: workspaceFolder, filePath: vscode.workspace.asRelativePath(filePath, false) };\r\n        }\r\n    } else {\r\n        if (vscode.workspace.workspaceFolders && vscode.workspace.workspaceFolders.length > 0) {\r\n            if (vscode.workspace.workspaceFolders.length === 1) {\r\n                return { wsFolder: vscode.workspace.workspaceFolders[0], filePath: filePath };\r\n            } else {\r\n                let parsedPath = filePath.split('/');\r\n                if (parsedPath.length > 1) {\r\n                    for (const folder of vscode.workspace.workspaceFolders) {\r\n                        if (parsedPath[0] === folder.name) {\r\n                            return { wsFolder: folder, filePath: filePath.substr(parsedPath[0].length + 1) };\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    }\r\n    let parsedPath = path.parse(filePath);\r\n    return {\r\n        wsFolder: {\r\n            uri: vscode.Uri.file(parsedPath.dir),\r\n            name: 'root',\r\n            index: 0\r\n        },\r\n        filePath: parsedPath.base\r\n    };\r\n}\r\n\r\n/**\r\n * Return project file in filesystem.\r\n *\r\n * @param project project file info\r\n */\r\nexport function toLocalFile(project: ProjectFileInfo): string {\r\n    return project.wsFolder.uri.with({path: project.wsFolder.uri.path + '/' + project.filePath}).fsPath;\r\n}\r\n\r\n/**\r\n * Returns full path to nimpretty executables or '' if file not found.\r\n */\r\nexport function getNimPrettyExecPath(): string {\r\n    let toolname = 'nimpretty';\r\n    if (!_pathesCache[toolname]) {\r\n        let nimPrettyPath = path.resolve(path.dirname(getNimExecPath()), correctBinname(toolname));\r\n        if (fs.existsSync(nimPrettyPath)) {\r\n            _pathesCache[toolname] = nimPrettyPath;\r\n        } else {\r\n            _pathesCache[toolname] = '';\r\n        }\r\n    }\r\n    return _pathesCache[toolname];\r\n}\r\n\r\n/**\r\n * Returns full path to nimble executables or '' if file not found.\r\n */\r\nexport function getNimbleExecPath(): string {\r\n    let toolname = 'nimble';\r\n    if (!_pathesCache[toolname]) {\r\n        let nimblePath = path.resolve(path.dirname(getNimExecPath()), correctBinname(toolname));\r\n        if (fs.existsSync(nimblePath)) {\r\n            _pathesCache[toolname] = nimblePath;\r\n        } else {\r\n            _pathesCache[toolname] = '';\r\n        }\r\n    }\r\n    return _pathesCache[toolname];\r\n}\r\n\r\nexport function getProjectFileInfo(filename: string): ProjectFileInfo {\r\n    if (!isProjectMode()) {\r\n        if (_projectMapping.length > 0) {\r\n            var projectInfo: ProjectFileInfo | undefined;\r\n            let uriPath = vscode.Uri.file(filename).path;\r\n            _projectMapping.forEach(mapping => {\r\n                if (mapping.fileRegex.test(uriPath)) {\r\n                    projectInfo = toProjectInfo(uriPath.replace(mapping.fileRegex, mapping.projectPath));\r\n                    return;\r\n                }\r\n            });\r\n            if (!projectInfo) {\r\n                projectInfo = toProjectInfo(filename);\r\n            }\r\n            return projectInfo;\r\n        } else {\r\n            return toProjectInfo(filename);\r\n        }\r\n    }\r\n    for (const project of _projects) {\r\n        if (filename.startsWith(path.dirname(toLocalFile(project)))) {\r\n            return project;\r\n        }\r\n    }\r\n    return _projects[0];\r\n}\r\n\r\n/**\r\n * Returns temporary file path of edited document.\r\n */\r\nexport function getDirtyFile(document: vscode.TextDocument): string {\r\n    var dirtyFilePath = path.normalize(path.join(os.tmpdir(), 'vscodenimdirty.nim'));\r\n    fs.writeFileSync(dirtyFilePath, document.getText());\r\n    return dirtyFilePath;\r\n}\r\n\r\nexport function isProjectMode(): boolean {\r\n    return _projects.length > 0;\r\n}\r\n\r\nexport function getProjects(): ProjectFileInfo[] {\r\n    return _projects;\r\n}\r\n\r\nexport function prepareConfig(): void {\r\n    let config = vscode.workspace.getConfiguration('nim');\r\n    let projects = config['project'];\r\n    _projects = [];\r\n    if (projects) {\r\n        if (projects instanceof Array) {\r\n            projects.forEach((project) => {\r\n                _projects.push(toProjectInfo(project));\r\n            });\r\n        } else {\r\n            vscode.workspace.findFiles(projects).then(result => {\r\n                if (result && result.length > 0) {\r\n                    _projects.push(toProjectInfo(result[0].fsPath));\r\n                }\r\n            });\r\n        }\r\n    }\r\n    let projectMapping = config['projectMapping'];\r\n    _projectMapping = [];\r\n    if (projectMapping) {\r\n        if (projectMapping instanceof Object) {\r\n            for (const key in projectMapping) {\r\n                if (projectMapping.hasOwnProperty(key)) {\r\n                    const path = <string> projectMapping[key];\r\n                    _projectMapping.push({ fileRegex: new RegExp(key), projectPath: path });\r\n                }\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\nexport function getBinPath(tool: string): string {\r\n    if (_pathesCache[tool]) return _pathesCache[tool];\r\n    if (process.env['PATH']) {\r\n        // add support for choosenim\r\n        process.env['PATH'] = process.env['PATH'] + (<any>path).delimiter + process.env['HOME'] + '/.nimble/bin';\r\n        var pathparts = (<string>process.env.PATH).split((<any>path).delimiter);\r\n        _pathesCache[tool] = pathparts.map(dir => path.join(dir, correctBinname(tool))).filter(candidate => fs.existsSync(candidate))[0];\r\n        if (process.platform !== 'win32') {\r\n            try {\r\n                let nimPath;\r\n                if (process.platform === 'darwin') {\r\n                    nimPath = cp.execFileSync('readlink', [_pathesCache[tool]]).toString().trim();\r\n                    if (nimPath.length > 0 && !path.isAbsolute(nimPath)) {\r\n                        nimPath = path.normalize(path.join(path.dirname(_pathesCache[tool]), nimPath));\r\n                    }\r\n                } else if (process.platform === 'linux') {\r\n                    nimPath = cp.execFileSync('readlink', ['-f', _pathesCache[tool]]).toString().trim();\r\n                } else {\r\n                    nimPath = cp.execFileSync('readlink', [_pathesCache[tool]]).toString().trim();\r\n                }\r\n\r\n                if (nimPath.length > 0) {\r\n                    _pathesCache[tool] = nimPath;\r\n                }\r\n            } catch (e) {\r\n                // ignore exception\r\n            }\r\n        }\r\n    }\r\n    return _pathesCache[tool];\r\n}\r\n\r\nexport function correctBinname(binname: string): string {\r\n    if (process.platform === 'win32') {\r\n        return binname + '.exe';\r\n    } else {\r\n        return binname;\r\n    }\r\n}\r\n\r\nexport function removeDirSync(p: string): void {\r\n    if (fs.existsSync(p)) {\r\n        fs.readdirSync(p).forEach((file, index) => {\r\n            var curPath = path.resolve(p, file);\r\n            if (fs.lstatSync(curPath).isDirectory()) {\r\n                removeDirSync(curPath);\r\n            } else {\r\n                fs.unlinkSync(curPath);\r\n            }\r\n        });\r\n        fs.rmdirSync(p);\r\n    }\r\n}\r\n\r\n\r\nlet _channel: vscode.OutputChannel;\r\nexport function getOutputChannel() {\r\n    if (!_channel) {\r\n        _channel = vscode.window.createOutputChannel('Nim');\r\n    }\r\n    return _channel;\r\n}\r\nfunction padStart(len: number, input: string): string {\r\n    let out = '';\r\n    for (let i = input.length; i < len; i++) {\r\n        out += '0';\r\n    }\r\n    return out + input;\r\n}\r\nfunction cleanDateString(date: Date): string {\r\n    let year = date.getFullYear();\r\n    let month = padStart(2, date.getMonth().toString());\r\n    let dd = padStart(2, date.getDate().toString());\r\n    let hour = padStart(2, date.getHours().toString());\r\n    let minute = padStart(2, date.getMinutes().toString());\r\n    let second = padStart(2, date.getSeconds().toString());\r\n    let millisecond = padStart(3, date.getMilliseconds().toString());\r\n    return `${year}-${month}-${dd} ${hour}:${minute}:${second}.${millisecond}`;\r\n}\r\n\r\n/**\r\n * Prints message in Nim's output channel\r\n */\r\nexport function outputLine(message: string) {\r\n    let channel = getOutputChannel();\r\n    let timeNow = new Date();\r\n    channel.appendLine(`${cleanDateString(timeNow)} - ${message}`);\r\n}","/*---------------------------------------------------------\r\n * Copyright (C) Xored Software Inc. All rights reserved.\r\n * Licensed under the MIT License. See LICENSE in the project root for license information.\r\n *--------------------------------------------------------*/\r\n\r\n'use strict';\r\n\r\nimport vscode = require('vscode');\r\nimport cp = require('child_process');\r\nimport path = require('path');\r\nimport fs = require('fs');\r\nimport elrpc = require('./elrpc/elrpc');\r\nimport { prepareConfig, getProjectFileInfo, isProjectMode, getNimExecPath, correctBinname, ProjectFileInfo, toLocalFile } from './nimUtils';\r\nimport * as rd from 'readline'\r\n\r\nclass NimSuggestProcessDescription {\r\n    process?: cp.ChildProcess;\r\n    rpc?: elrpc.EPCPeer;\r\n}\r\n\r\nlet nimSuggestProcessCache: { [project: string]: PromiseLike<NimSuggestProcessDescription> | undefined } = {};\r\nvar _nimSuggestPath: string = '';\r\nvar _nimSuggestVersion: string = '';\r\n\r\nexport enum NimSuggestType {\r\n    /** Suggest from position */\r\n    sug,\r\n    /** Get context from position */\r\n    con,\r\n    /** Get symbol definition from position */\r\n    def,\r\n    /** Get references of symbol from position */\r\n    use,\r\n    /** Get usage of symbol from position in project */\r\n    dus,\r\n    /** Ivoke nim check on file */\r\n    chk,\r\n    /** Returns all tokens in file (symbolType, line, pos, lenght) */\r\n    highlight,\r\n    /** Get outline symbols for file */\r\n    outline,\r\n    /** Returns 'true' if given file is related to the project, otherwise 'false'  */\r\n    known\r\n}\r\n/**\r\n * Parsed string line from nimsuggest utility.\r\n */\r\nexport class NimSuggestResult {\r\n\r\n    /** Three characters indicating the type of returned answer\r\n     * (e.g. def for definition, sug for suggestion, etc). */\r\n    answerType: string = '';\r\n\r\n    /** Type of the symbol. This can be skProc, skLet, and just\r\n     *  about any of the enums defined in the module compiler/ast.nim. */\r\n    suggest: string = '';\r\n\r\n    /** Full qualitifed path of the symbol.If you are querying a symbol\r\n     * defined in the proj.nim file, this would have the form [proj, symbolName]. */\r\n    names: string[] = [];\r\n\r\n    /** Type / signature.For variables and enums this will contain the type\r\n     * of the symbol, for procs, methods and templates this will contain the\r\n     * full unique signature (e.g.proc(File)). */\r\n    type: string = '';\r\n\r\n    /** Full path to the file containing the symbol. */\r\n    path: string = '';\r\n\r\n    /** Line where the symbol is located in the file.Lines start to count at 1. */\r\n    line: number = 1;\r\n\r\n    /** Column where the symbol is located in the file.Columns start to count at 0. */\r\n    column: number = 0;\r\n\r\n    /** Docstring for the symbol if available or the empty string.\r\n     * To differentiate the docstring from end of answer in server mode,\r\n     * the docstring is always provided enclosed in double quotes, and if\r\n     * the docstring spans multiple lines, all following lines of the docstring\r\n     * will start with a blank space to align visually with the starting quote.\r\n     * //\r\n     * Also, you won't find raw \\n characters breaking the one answer per line format.\r\n     * Instead you will need to parse sequences in the form \\xHH, where HH\r\n     * is a hexadecimal value (e.g. newlines generate the sequence \\x0A). */\r\n    documentation: string = '';\r\n\r\n    get range(): vscode.Range {\r\n        return new vscode.Range(this.line - 1, this.column, this.line - 1, this.column);\r\n    }\r\n\r\n    get position(): vscode.Position {\r\n        return new vscode.Position(this.line - 1, this.column);\r\n    }\r\n\r\n    get uri(): vscode.Uri {\r\n        return vscode.Uri.file(this.path);\r\n    }\r\n\r\n    get location(): vscode.Location {\r\n        return new vscode.Location(this.uri, this.position);\r\n    }\r\n\r\n    get fullName(): string {\r\n        return this.names ? this.names.join('.') : '';\r\n    }\r\n\r\n    get symbolName(): string {\r\n        return this.names ? this.names[this.names.length - 1] : '';\r\n    }\r\n\r\n    get moduleName(): string {\r\n        return this.names ? this.names[0] : '';\r\n    }\r\n\r\n    get containerName(): string {\r\n        return this.names ? this.names.slice(0, this.names.length - 1).join('.') : '';\r\n    }\r\n}\r\n\r\nexport function getNimSuggestPath(): string {\r\n    return _nimSuggestPath;\r\n}\r\n\r\nexport function getNimSuggestVersion(): string {\r\n    return _nimSuggestVersion;\r\n}\r\n\r\n/**\r\n * Returns true if nimsuggest version is great or equals to given.\r\n * @param version version to match\r\n */\r\nexport function isNimSuggestVersion(version: string): boolean {\r\n    if (!_nimSuggestVersion) {\r\n        return false;\r\n    }\r\n    let nimVersionParts = _nimSuggestVersion.split('.');\r\n    let versionParts = version.split('.');\r\n    for (var i = 0; i < Math.min(nimVersionParts.length, versionParts.length); i++) {\r\n        let diff = parseInt(nimVersionParts[i]) - parseInt(versionParts[i]);\r\n        if (diff === 0) {\r\n            continue;\r\n        }\r\n        return diff > 0;\r\n    }\r\n    return true;\r\n}\r\n\r\nexport function initNimSuggest() {\r\n    prepareConfig();\r\n    // let check nimsuggest related nim executable\r\n    let nimSuggestNewPath = path.resolve(path.dirname(getNimExecPath()), correctBinname('nimsuggest'));\r\n    if (fs.existsSync(nimSuggestNewPath)) {\r\n        _nimSuggestPath = nimSuggestNewPath;\r\n        let versionOutput = cp.spawnSync(getNimSuggestPath(), ['--version'], { cwd: vscode.workspace.rootPath }).output.toString();\r\n        let versionArgs = /.+Version\\s([\\d|\\.]+)\\s\\(.+/g.exec(versionOutput);\r\n        if (versionArgs && versionArgs.length === 2) {\r\n            _nimSuggestVersion = versionArgs[1];\r\n        }\r\n\r\n        console.log(versionOutput);\r\n        console.log('Nimsuggest version: ' + _nimSuggestVersion);\r\n    }\r\n    vscode.workspace.onDidChangeConfiguration(prepareConfig);\r\n}\r\n\r\nfunction trace(pid: number, projectFile: ProjectFileInfo | string, msg: any): void {\r\n    if (!!vscode.workspace.getConfiguration('nim').get('logNimsuggest')) {\r\n        if (typeof projectFile === 'string') {\r\n            console.log('[' + pid + ':' + projectFile + ']');\r\n        } else {\r\n            console.log('[' + pid + ':' + projectFile.wsFolder.name + ':' + projectFile.wsFolder.uri.fsPath + ':' + projectFile.filePath + ']');\r\n        }\r\n        console.log(msg);\r\n    }\r\n}\r\n\r\nexport async function execNimSuggest(suggestType: NimSuggestType, filename: string,\r\n    line: number, column: number, dirtyFile?: string): Promise<NimSuggestResult[] | undefined> {\r\n    var nimSuggestExec = getNimSuggestPath();\r\n    // if nimsuggest not found just ignore\r\n    if (!nimSuggestExec) {\r\n        return [];\r\n    }\r\n\r\n    // Dont run nimsuggest for nims files and cfg\r\n    // See https://github.com/pragmagic/vscode-nim/issues/84\r\n    if (path.extname(filename).toLowerCase() === '.nims' || path.extname(filename).toLowerCase() === '.cfg') {\r\n        return [];\r\n    }\r\n\r\n    let projectFile = getProjectFileInfo(filename);\r\n    try {\r\n        let normalizedFilename = filename.replace(/\\\\+/g, '/');\r\n        let desc = await getNimSuggestProcess(projectFile);\r\n        let suggestCmd = NimSuggestType[suggestType];\r\n        if (desc && desc.process) {\r\n            trace(desc.process.pid, projectFile, suggestCmd + ' ' + normalizedFilename + ':' + line + ':' + column);\r\n        }\r\n        var result: NimSuggestResult[] = [];\r\n        if (desc && desc.rpc) {\r\n            let ret = await desc.rpc.callMethod(suggestCmd, { kind: 'string', str: normalizedFilename }, { kind: 'number', n: line }, { kind: 'number', n: column }, { kind: 'string', str: dirtyFile as string });\r\n\r\n            if (desc.process) {\r\n                trace(desc.process.pid, toLocalFile(projectFile) + '=' + suggestCmd + ' ' + normalizedFilename, ret);\r\n            }\r\n\r\n            if (ret != null) {\r\n                if (ret instanceof Array) {\r\n                    for (var i = 0; i < ret.length; i++) {\r\n                        var parts = ret[i];\r\n                        if (parts.length >= 8) {\r\n                            var item = new NimSuggestResult();\r\n                            item.answerType = parts[0];\r\n                            item.suggest = parts[1];\r\n                            item.names = parts[2];\r\n                            item.path = parts[3].replace(/\\\\,\\\\/g, '\\\\');\r\n                            item.type = parts[4];\r\n                            item.line = parts[5];\r\n                            item.column = parts[6];\r\n                            var doc = parts[7];\r\n                            if (doc !== '') {\r\n                                doc = doc.replace(/\\`\\`/g, '`');\r\n                                doc = doc.replace(/\\.\\. code-block:: (\\w+)\\r?\\n(( .*\\r?\\n?)+)/g, '```$1\\n$2\\n```\\n');\r\n                                doc = doc.replace(/\\`([^\\<\\`]+)\\<([^\\>]+)\\>\\`\\_/g, '\\[$1\\]\\($2\\)');\r\n                            }\r\n                            item.documentation = doc;\r\n                            result.push(item);\r\n                        }\r\n                    }\r\n                } else if (ret === 'EPC Connection closed') {\r\n                    console.error(ret);\r\n                    await closeNimSuggestProcess(projectFile);\r\n                } else {\r\n                    var res = new NimSuggestResult();\r\n                    res.suggest = '' + ret;\r\n                    result.push(res);\r\n                }\r\n            }\r\n        }\r\n        if (!isProjectMode() &&\r\n            vscode.window.visibleTextEditors.every((value, index, array) => { return value.document.uri.fsPath !== filename; })) {\r\n            await closeNimSuggestProcess(projectFile);\r\n        }\r\n        return result;\r\n    } catch (e) {\r\n        console.error(e);\r\n        await closeNimSuggestProcess(projectFile);\r\n    }\r\n}\r\n\r\nexport async function closeAllNimSuggestProcesses(): Promise<void> {\r\n    console.log('Close all nimsuggest processes');\r\n    for (var project in nimSuggestProcessCache) {\r\n        let desc = await nimSuggestProcessCache[project];\r\n        if (desc) {\r\n            if (desc.rpc) {\r\n                desc.rpc.stop();\r\n            }\r\n            if (desc.process) {\r\n                desc.process.kill();\r\n            }\r\n        }\r\n    }\r\n    nimSuggestProcessCache = {};\r\n}\r\n\r\nexport async function closeNimSuggestProcess(project: ProjectFileInfo): Promise<void> {\r\n    var file = toLocalFile(project);\r\n    if (nimSuggestProcessCache[file]) {\r\n        try {\r\n            let desc = await nimSuggestProcessCache[file];\r\n            if (desc) {\r\n                if (desc.rpc) {\r\n                    desc.rpc.stop();\r\n                }\r\n                if (desc.process) {\r\n                    desc.process.kill();\r\n                }\r\n            }\r\n            nimSuggestProcessCache[file] = undefined;\r\n        } catch {\r\n            nimSuggestProcessCache[file] = undefined;\r\n        }\r\n    }\r\n}\r\n\r\nasync function getNimSuggestProcess(nimProject: ProjectFileInfo): Promise<NimSuggestProcessDescription | undefined> {\r\n    let projectPath = toLocalFile(nimProject);\r\n    \r\n    var reader = rd.createInterface(fs.createReadStream(projectPath))\r\n    var backend: string\r\n    reader.on('line', (l: string) => {\r\n        var tokens = l.split(' ')\r\n        if (tokens.length == 3 && tokens[0].toLowerCase() == 'backend' && tokens[1] == '=')\r\n            backend = tokens[2]\r\n    })\r\n\r\n    if (!nimSuggestProcessCache[projectPath]) {\r\n        nimSuggestProcessCache[projectPath] = new Promise<NimSuggestProcessDescription>((resolve, reject) => {\r\n            let nimConfig = vscode.workspace.getConfiguration('nim');\r\n            var args = ['--epc', '--v2'];\r\n            if (!!nimConfig['logNimsuggest']) {\r\n                args.push('--log');\r\n            }\r\n            if (!!nimConfig['useNimsuggestCheck']) {\r\n                args.push('--refresh:on');\r\n            }\r\n            if (backend.toLowerCase() == \"js\") {\r\n                args.push('-d:js')\r\n            }\r\n\r\n            args.push(nimProject.filePath);\r\n            let process = cp.spawn(getNimSuggestPath(), args, { cwd: nimProject.wsFolder.uri.fsPath });\r\n            process.stdout.once('data', (data) => {\r\n                let dataStr = data.toString();\r\n                let portNumber = parseInt(dataStr);\r\n                if (isNaN(portNumber)) {\r\n                    reject('Nimsuggest returns unknown port number: ' + dataStr);\r\n                } else {\r\n                    elrpc.startClient(portNumber).then((peer) => {\r\n                        resolve({ process: process, rpc: peer });\r\n                    });\r\n                }\r\n            });\r\n            process.stdout.once('data', (data) => {\r\n                console.log(data.toString());\r\n            });\r\n            process.stderr.once('data', (data) => {\r\n                console.log(data.toString());\r\n            });\r\n            process.on('close', (code: number, signal: string) => {\r\n                if (code !== 0) {\r\n                    console.error('nimsuggest closed with code: ' + code + ', signal: ' + signal);\r\n                }\r\n                if (nimSuggestProcessCache[projectPath]) {\r\n                    (<Promise<NimSuggestProcessDescription>> nimSuggestProcessCache[projectPath]).then((desc) => {\r\n                        if (desc && desc.rpc) {\r\n                            desc.rpc.stop();\r\n                        }\r\n                    });\r\n                }\r\n                reject();\r\n            });\r\n        });\r\n    }\r\n    return nimSuggestProcessCache[projectPath];\r\n}\r\n","module.exports = require(\"fs\");","module.exports = require(\"path\");","module.exports = require(\"child_process\");","module.exports = require(\"util\");","//     Underscore.js 1.4.4\n//     http://underscorejs.org\n//     (c) 2009-2013 Jeremy Ashkenas, DocumentCloud Inc.\n//     Underscore may be freely distributed under the MIT license.\n\n(function() {\n\n  // Baseline setup\n  // --------------\n\n  // Establish the root object, `window` in the browser, or `global` on the server.\n  var root = this;\n\n  // Save the previous value of the `_` variable.\n  var previousUnderscore = root._;\n\n  // Establish the object that gets returned to break out of a loop iteration.\n  var breaker = {};\n\n  // Save bytes in the minified (but not gzipped) version:\n  var ArrayProto = Array.prototype, ObjProto = Object.prototype, FuncProto = Function.prototype;\n\n  // Create quick reference variables for speed access to core prototypes.\n  var push             = ArrayProto.push,\n      slice            = ArrayProto.slice,\n      concat           = ArrayProto.concat,\n      toString         = ObjProto.toString,\n      hasOwnProperty   = ObjProto.hasOwnProperty;\n\n  // All **ECMAScript 5** native function implementations that we hope to use\n  // are declared here.\n  var\n    nativeForEach      = ArrayProto.forEach,\n    nativeMap          = ArrayProto.map,\n    nativeReduce       = ArrayProto.reduce,\n    nativeReduceRight  = ArrayProto.reduceRight,\n    nativeFilter       = ArrayProto.filter,\n    nativeEvery        = ArrayProto.every,\n    nativeSome         = ArrayProto.some,\n    nativeIndexOf      = ArrayProto.indexOf,\n    nativeLastIndexOf  = ArrayProto.lastIndexOf,\n    nativeIsArray      = Array.isArray,\n    nativeKeys         = Object.keys,\n    nativeBind         = FuncProto.bind;\n\n  // Create a safe reference to the Underscore object for use below.\n  var _ = function(obj) {\n    if (obj instanceof _) return obj;\n    if (!(this instanceof _)) return new _(obj);\n    this._wrapped = obj;\n  };\n\n  // Export the Underscore object for **Node.js**, with\n  // backwards-compatibility for the old `require()` API. If we're in\n  // the browser, add `_` as a global object via a string identifier,\n  // for Closure Compiler \"advanced\" mode.\n  if (typeof exports !== 'undefined') {\n    if (typeof module !== 'undefined' && module.exports) {\n      exports = module.exports = _;\n    }\n    exports._ = _;\n  } else {\n    root._ = _;\n  }\n\n  // Current version.\n  _.VERSION = '1.4.4';\n\n  // Collection Functions\n  // --------------------\n\n  // The cornerstone, an `each` implementation, aka `forEach`.\n  // Handles objects with the built-in `forEach`, arrays, and raw objects.\n  // Delegates to **ECMAScript 5**'s native `forEach` if available.\n  var each = _.each = _.forEach = function(obj, iterator, context) {\n    if (obj == null) return;\n    if (nativeForEach && obj.forEach === nativeForEach) {\n      obj.forEach(iterator, context);\n    } else if (obj.length === +obj.length) {\n      for (var i = 0, l = obj.length; i < l; i++) {\n        if (iterator.call(context, obj[i], i, obj) === breaker) return;\n      }\n    } else {\n      for (var key in obj) {\n        if (_.has(obj, key)) {\n          if (iterator.call(context, obj[key], key, obj) === breaker) return;\n        }\n      }\n    }\n  };\n\n  // Return the results of applying the iterator to each element.\n  // Delegates to **ECMAScript 5**'s native `map` if available.\n  _.map = _.collect = function(obj, iterator, context) {\n    var results = [];\n    if (obj == null) return results;\n    if (nativeMap && obj.map === nativeMap) return obj.map(iterator, context);\n    each(obj, function(value, index, list) {\n      results[results.length] = iterator.call(context, value, index, list);\n    });\n    return results;\n  };\n\n  var reduceError = 'Reduce of empty array with no initial value';\n\n  // **Reduce** builds up a single result from a list of values, aka `inject`,\n  // or `foldl`. Delegates to **ECMAScript 5**'s native `reduce` if available.\n  _.reduce = _.foldl = _.inject = function(obj, iterator, memo, context) {\n    var initial = arguments.length > 2;\n    if (obj == null) obj = [];\n    if (nativeReduce && obj.reduce === nativeReduce) {\n      if (context) iterator = _.bind(iterator, context);\n      return initial ? obj.reduce(iterator, memo) : obj.reduce(iterator);\n    }\n    each(obj, function(value, index, list) {\n      if (!initial) {\n        memo = value;\n        initial = true;\n      } else {\n        memo = iterator.call(context, memo, value, index, list);\n      }\n    });\n    if (!initial) throw new TypeError(reduceError);\n    return memo;\n  };\n\n  // The right-associative version of reduce, also known as `foldr`.\n  // Delegates to **ECMAScript 5**'s native `reduceRight` if available.\n  _.reduceRight = _.foldr = function(obj, iterator, memo, context) {\n    var initial = arguments.length > 2;\n    if (obj == null) obj = [];\n    if (nativeReduceRight && obj.reduceRight === nativeReduceRight) {\n      if (context) iterator = _.bind(iterator, context);\n      return initial ? obj.reduceRight(iterator, memo) : obj.reduceRight(iterator);\n    }\n    var length = obj.length;\n    if (length !== +length) {\n      var keys = _.keys(obj);\n      length = keys.length;\n    }\n    each(obj, function(value, index, list) {\n      index = keys ? keys[--length] : --length;\n      if (!initial) {\n        memo = obj[index];\n        initial = true;\n      } else {\n        memo = iterator.call(context, memo, obj[index], index, list);\n      }\n    });\n    if (!initial) throw new TypeError(reduceError);\n    return memo;\n  };\n\n  // Return the first value which passes a truth test. Aliased as `detect`.\n  _.find = _.detect = function(obj, iterator, context) {\n    var result;\n    any(obj, function(value, index, list) {\n      if (iterator.call(context, value, index, list)) {\n        result = value;\n        return true;\n      }\n    });\n    return result;\n  };\n\n  // Return all the elements that pass a truth test.\n  // Delegates to **ECMAScript 5**'s native `filter` if available.\n  // Aliased as `select`.\n  _.filter = _.select = function(obj, iterator, context) {\n    var results = [];\n    if (obj == null) return results;\n    if (nativeFilter && obj.filter === nativeFilter) return obj.filter(iterator, context);\n    each(obj, function(value, index, list) {\n      if (iterator.call(context, value, index, list)) results[results.length] = value;\n    });\n    return results;\n  };\n\n  // Return all the elements for which a truth test fails.\n  _.reject = function(obj, iterator, context) {\n    return _.filter(obj, function(value, index, list) {\n      return !iterator.call(context, value, index, list);\n    }, context);\n  };\n\n  // Determine whether all of the elements match a truth test.\n  // Delegates to **ECMAScript 5**'s native `every` if available.\n  // Aliased as `all`.\n  _.every = _.all = function(obj, iterator, context) {\n    iterator || (iterator = _.identity);\n    var result = true;\n    if (obj == null) return result;\n    if (nativeEvery && obj.every === nativeEvery) return obj.every(iterator, context);\n    each(obj, function(value, index, list) {\n      if (!(result = result && iterator.call(context, value, index, list))) return breaker;\n    });\n    return !!result;\n  };\n\n  // Determine if at least one element in the object matches a truth test.\n  // Delegates to **ECMAScript 5**'s native `some` if available.\n  // Aliased as `any`.\n  var any = _.some = _.any = function(obj, iterator, context) {\n    iterator || (iterator = _.identity);\n    var result = false;\n    if (obj == null) return result;\n    if (nativeSome && obj.some === nativeSome) return obj.some(iterator, context);\n    each(obj, function(value, index, list) {\n      if (result || (result = iterator.call(context, value, index, list))) return breaker;\n    });\n    return !!result;\n  };\n\n  // Determine if the array or object contains a given value (using `===`).\n  // Aliased as `include`.\n  _.contains = _.include = function(obj, target) {\n    if (obj == null) return false;\n    if (nativeIndexOf && obj.indexOf === nativeIndexOf) return obj.indexOf(target) != -1;\n    return any(obj, function(value) {\n      return value === target;\n    });\n  };\n\n  // Invoke a method (with arguments) on every item in a collection.\n  _.invoke = function(obj, method) {\n    var args = slice.call(arguments, 2);\n    var isFunc = _.isFunction(method);\n    return _.map(obj, function(value) {\n      return (isFunc ? method : value[method]).apply(value, args);\n    });\n  };\n\n  // Convenience version of a common use case of `map`: fetching a property.\n  _.pluck = function(obj, key) {\n    return _.map(obj, function(value){ return value[key]; });\n  };\n\n  // Convenience version of a common use case of `filter`: selecting only objects\n  // containing specific `key:value` pairs.\n  _.where = function(obj, attrs, first) {\n    if (_.isEmpty(attrs)) return first ? null : [];\n    return _[first ? 'find' : 'filter'](obj, function(value) {\n      for (var key in attrs) {\n        if (attrs[key] !== value[key]) return false;\n      }\n      return true;\n    });\n  };\n\n  // Convenience version of a common use case of `find`: getting the first object\n  // containing specific `key:value` pairs.\n  _.findWhere = function(obj, attrs) {\n    return _.where(obj, attrs, true);\n  };\n\n  // Return the maximum element or (element-based computation).\n  // Can't optimize arrays of integers longer than 65,535 elements.\n  // See: https://bugs.webkit.org/show_bug.cgi?id=80797\n  _.max = function(obj, iterator, context) {\n    if (!iterator && _.isArray(obj) && obj[0] === +obj[0] && obj.length < 65535) {\n      return Math.max.apply(Math, obj);\n    }\n    if (!iterator && _.isEmpty(obj)) return -Infinity;\n    var result = {computed : -Infinity, value: -Infinity};\n    each(obj, function(value, index, list) {\n      var computed = iterator ? iterator.call(context, value, index, list) : value;\n      computed >= result.computed && (result = {value : value, computed : computed});\n    });\n    return result.value;\n  };\n\n  // Return the minimum element (or element-based computation).\n  _.min = function(obj, iterator, context) {\n    if (!iterator && _.isArray(obj) && obj[0] === +obj[0] && obj.length < 65535) {\n      return Math.min.apply(Math, obj);\n    }\n    if (!iterator && _.isEmpty(obj)) return Infinity;\n    var result = {computed : Infinity, value: Infinity};\n    each(obj, function(value, index, list) {\n      var computed = iterator ? iterator.call(context, value, index, list) : value;\n      computed < result.computed && (result = {value : value, computed : computed});\n    });\n    return result.value;\n  };\n\n  // Shuffle an array.\n  _.shuffle = function(obj) {\n    var rand;\n    var index = 0;\n    var shuffled = [];\n    each(obj, function(value) {\n      rand = _.random(index++);\n      shuffled[index - 1] = shuffled[rand];\n      shuffled[rand] = value;\n    });\n    return shuffled;\n  };\n\n  // An internal function to generate lookup iterators.\n  var lookupIterator = function(value) {\n    return _.isFunction(value) ? value : function(obj){ return obj[value]; };\n  };\n\n  // Sort the object's values by a criterion produced by an iterator.\n  _.sortBy = function(obj, value, context) {\n    var iterator = lookupIterator(value);\n    return _.pluck(_.map(obj, function(value, index, list) {\n      return {\n        value : value,\n        index : index,\n        criteria : iterator.call(context, value, index, list)\n      };\n    }).sort(function(left, right) {\n      var a = left.criteria;\n      var b = right.criteria;\n      if (a !== b) {\n        if (a > b || a === void 0) return 1;\n        if (a < b || b === void 0) return -1;\n      }\n      return left.index < right.index ? -1 : 1;\n    }), 'value');\n  };\n\n  // An internal function used for aggregate \"group by\" operations.\n  var group = function(obj, value, context, behavior) {\n    var result = {};\n    var iterator = lookupIterator(value || _.identity);\n    each(obj, function(value, index) {\n      var key = iterator.call(context, value, index, obj);\n      behavior(result, key, value);\n    });\n    return result;\n  };\n\n  // Groups the object's values by a criterion. Pass either a string attribute\n  // to group by, or a function that returns the criterion.\n  _.groupBy = function(obj, value, context) {\n    return group(obj, value, context, function(result, key, value) {\n      (_.has(result, key) ? result[key] : (result[key] = [])).push(value);\n    });\n  };\n\n  // Counts instances of an object that group by a certain criterion. Pass\n  // either a string attribute to count by, or a function that returns the\n  // criterion.\n  _.countBy = function(obj, value, context) {\n    return group(obj, value, context, function(result, key) {\n      if (!_.has(result, key)) result[key] = 0;\n      result[key]++;\n    });\n  };\n\n  // Use a comparator function to figure out the smallest index at which\n  // an object should be inserted so as to maintain order. Uses binary search.\n  _.sortedIndex = function(array, obj, iterator, context) {\n    iterator = iterator == null ? _.identity : lookupIterator(iterator);\n    var value = iterator.call(context, obj);\n    var low = 0, high = array.length;\n    while (low < high) {\n      var mid = (low + high) >>> 1;\n      iterator.call(context, array[mid]) < value ? low = mid + 1 : high = mid;\n    }\n    return low;\n  };\n\n  // Safely convert anything iterable into a real, live array.\n  _.toArray = function(obj) {\n    if (!obj) return [];\n    if (_.isArray(obj)) return slice.call(obj);\n    if (obj.length === +obj.length) return _.map(obj, _.identity);\n    return _.values(obj);\n  };\n\n  // Return the number of elements in an object.\n  _.size = function(obj) {\n    if (obj == null) return 0;\n    return (obj.length === +obj.length) ? obj.length : _.keys(obj).length;\n  };\n\n  // Array Functions\n  // ---------------\n\n  // Get the first element of an array. Passing **n** will return the first N\n  // values in the array. Aliased as `head` and `take`. The **guard** check\n  // allows it to work with `_.map`.\n  _.first = _.head = _.take = function(array, n, guard) {\n    if (array == null) return void 0;\n    return (n != null) && !guard ? slice.call(array, 0, n) : array[0];\n  };\n\n  // Returns everything but the last entry of the array. Especially useful on\n  // the arguments object. Passing **n** will return all the values in\n  // the array, excluding the last N. The **guard** check allows it to work with\n  // `_.map`.\n  _.initial = function(array, n, guard) {\n    return slice.call(array, 0, array.length - ((n == null) || guard ? 1 : n));\n  };\n\n  // Get the last element of an array. Passing **n** will return the last N\n  // values in the array. The **guard** check allows it to work with `_.map`.\n  _.last = function(array, n, guard) {\n    if (array == null) return void 0;\n    if ((n != null) && !guard) {\n      return slice.call(array, Math.max(array.length - n, 0));\n    } else {\n      return array[array.length - 1];\n    }\n  };\n\n  // Returns everything but the first entry of the array. Aliased as `tail` and `drop`.\n  // Especially useful on the arguments object. Passing an **n** will return\n  // the rest N values in the array. The **guard**\n  // check allows it to work with `_.map`.\n  _.rest = _.tail = _.drop = function(array, n, guard) {\n    return slice.call(array, (n == null) || guard ? 1 : n);\n  };\n\n  // Trim out all falsy values from an array.\n  _.compact = function(array) {\n    return _.filter(array, _.identity);\n  };\n\n  // Internal implementation of a recursive `flatten` function.\n  var flatten = function(input, shallow, output) {\n    each(input, function(value) {\n      if (_.isArray(value)) {\n        shallow ? push.apply(output, value) : flatten(value, shallow, output);\n      } else {\n        output.push(value);\n      }\n    });\n    return output;\n  };\n\n  // Return a completely flattened version of an array.\n  _.flatten = function(array, shallow) {\n    return flatten(array, shallow, []);\n  };\n\n  // Return a version of the array that does not contain the specified value(s).\n  _.without = function(array) {\n    return _.difference(array, slice.call(arguments, 1));\n  };\n\n  // Produce a duplicate-free version of the array. If the array has already\n  // been sorted, you have the option of using a faster algorithm.\n  // Aliased as `unique`.\n  _.uniq = _.unique = function(array, isSorted, iterator, context) {\n    if (_.isFunction(isSorted)) {\n      context = iterator;\n      iterator = isSorted;\n      isSorted = false;\n    }\n    var initial = iterator ? _.map(array, iterator, context) : array;\n    var results = [];\n    var seen = [];\n    each(initial, function(value, index) {\n      if (isSorted ? (!index || seen[seen.length - 1] !== value) : !_.contains(seen, value)) {\n        seen.push(value);\n        results.push(array[index]);\n      }\n    });\n    return results;\n  };\n\n  // Produce an array that contains the union: each distinct element from all of\n  // the passed-in arrays.\n  _.union = function() {\n    return _.uniq(concat.apply(ArrayProto, arguments));\n  };\n\n  // Produce an array that contains every item shared between all the\n  // passed-in arrays.\n  _.intersection = function(array) {\n    var rest = slice.call(arguments, 1);\n    return _.filter(_.uniq(array), function(item) {\n      return _.every(rest, function(other) {\n        return _.indexOf(other, item) >= 0;\n      });\n    });\n  };\n\n  // Take the difference between one array and a number of other arrays.\n  // Only the elements present in just the first array will remain.\n  _.difference = function(array) {\n    var rest = concat.apply(ArrayProto, slice.call(arguments, 1));\n    return _.filter(array, function(value){ return !_.contains(rest, value); });\n  };\n\n  // Zip together multiple lists into a single array -- elements that share\n  // an index go together.\n  _.zip = function() {\n    var args = slice.call(arguments);\n    var length = _.max(_.pluck(args, 'length'));\n    var results = new Array(length);\n    for (var i = 0; i < length; i++) {\n      results[i] = _.pluck(args, \"\" + i);\n    }\n    return results;\n  };\n\n  // Converts lists into objects. Pass either a single array of `[key, value]`\n  // pairs, or two parallel arrays of the same length -- one of keys, and one of\n  // the corresponding values.\n  _.object = function(list, values) {\n    if (list == null) return {};\n    var result = {};\n    for (var i = 0, l = list.length; i < l; i++) {\n      if (values) {\n        result[list[i]] = values[i];\n      } else {\n        result[list[i][0]] = list[i][1];\n      }\n    }\n    return result;\n  };\n\n  // If the browser doesn't supply us with indexOf (I'm looking at you, **MSIE**),\n  // we need this function. Return the position of the first occurrence of an\n  // item in an array, or -1 if the item is not included in the array.\n  // Delegates to **ECMAScript 5**'s native `indexOf` if available.\n  // If the array is large and already in sort order, pass `true`\n  // for **isSorted** to use binary search.\n  _.indexOf = function(array, item, isSorted) {\n    if (array == null) return -1;\n    var i = 0, l = array.length;\n    if (isSorted) {\n      if (typeof isSorted == 'number') {\n        i = (isSorted < 0 ? Math.max(0, l + isSorted) : isSorted);\n      } else {\n        i = _.sortedIndex(array, item);\n        return array[i] === item ? i : -1;\n      }\n    }\n    if (nativeIndexOf && array.indexOf === nativeIndexOf) return array.indexOf(item, isSorted);\n    for (; i < l; i++) if (array[i] === item) return i;\n    return -1;\n  };\n\n  // Delegates to **ECMAScript 5**'s native `lastIndexOf` if available.\n  _.lastIndexOf = function(array, item, from) {\n    if (array == null) return -1;\n    var hasIndex = from != null;\n    if (nativeLastIndexOf && array.lastIndexOf === nativeLastIndexOf) {\n      return hasIndex ? array.lastIndexOf(item, from) : array.lastIndexOf(item);\n    }\n    var i = (hasIndex ? from : array.length);\n    while (i--) if (array[i] === item) return i;\n    return -1;\n  };\n\n  // Generate an integer Array containing an arithmetic progression. A port of\n  // the native Python `range()` function. See\n  // [the Python documentation](http://docs.python.org/library/functions.html#range).\n  _.range = function(start, stop, step) {\n    if (arguments.length <= 1) {\n      stop = start || 0;\n      start = 0;\n    }\n    step = arguments[2] || 1;\n\n    var len = Math.max(Math.ceil((stop - start) / step), 0);\n    var idx = 0;\n    var range = new Array(len);\n\n    while(idx < len) {\n      range[idx++] = start;\n      start += step;\n    }\n\n    return range;\n  };\n\n  // Function (ahem) Functions\n  // ------------------\n\n  // Create a function bound to a given object (assigning `this`, and arguments,\n  // optionally). Delegates to **ECMAScript 5**'s native `Function.bind` if\n  // available.\n  _.bind = function(func, context) {\n    if (func.bind === nativeBind && nativeBind) return nativeBind.apply(func, slice.call(arguments, 1));\n    var args = slice.call(arguments, 2);\n    return function() {\n      return func.apply(context, args.concat(slice.call(arguments)));\n    };\n  };\n\n  // Partially apply a function by creating a version that has had some of its\n  // arguments pre-filled, without changing its dynamic `this` context.\n  _.partial = function(func) {\n    var args = slice.call(arguments, 1);\n    return function() {\n      return func.apply(this, args.concat(slice.call(arguments)));\n    };\n  };\n\n  // Bind all of an object's methods to that object. Useful for ensuring that\n  // all callbacks defined on an object belong to it.\n  _.bindAll = function(obj) {\n    var funcs = slice.call(arguments, 1);\n    if (funcs.length === 0) funcs = _.functions(obj);\n    each(funcs, function(f) { obj[f] = _.bind(obj[f], obj); });\n    return obj;\n  };\n\n  // Memoize an expensive function by storing its results.\n  _.memoize = function(func, hasher) {\n    var memo = {};\n    hasher || (hasher = _.identity);\n    return function() {\n      var key = hasher.apply(this, arguments);\n      return _.has(memo, key) ? memo[key] : (memo[key] = func.apply(this, arguments));\n    };\n  };\n\n  // Delays a function for the given number of milliseconds, and then calls\n  // it with the arguments supplied.\n  _.delay = function(func, wait) {\n    var args = slice.call(arguments, 2);\n    return setTimeout(function(){ return func.apply(null, args); }, wait);\n  };\n\n  // Defers a function, scheduling it to run after the current call stack has\n  // cleared.\n  _.defer = function(func) {\n    return _.delay.apply(_, [func, 1].concat(slice.call(arguments, 1)));\n  };\n\n  // Returns a function, that, when invoked, will only be triggered at most once\n  // during a given window of time.\n  _.throttle = function(func, wait) {\n    var context, args, timeout, result;\n    var previous = 0;\n    var later = function() {\n      previous = new Date;\n      timeout = null;\n      result = func.apply(context, args);\n    };\n    return function() {\n      var now = new Date;\n      var remaining = wait - (now - previous);\n      context = this;\n      args = arguments;\n      if (remaining <= 0) {\n        clearTimeout(timeout);\n        timeout = null;\n        previous = now;\n        result = func.apply(context, args);\n      } else if (!timeout) {\n        timeout = setTimeout(later, remaining);\n      }\n      return result;\n    };\n  };\n\n  // Returns a function, that, as long as it continues to be invoked, will not\n  // be triggered. The function will be called after it stops being called for\n  // N milliseconds. If `immediate` is passed, trigger the function on the\n  // leading edge, instead of the trailing.\n  _.debounce = function(func, wait, immediate) {\n    var timeout, result;\n    return function() {\n      var context = this, args = arguments;\n      var later = function() {\n        timeout = null;\n        if (!immediate) result = func.apply(context, args);\n      };\n      var callNow = immediate && !timeout;\n      clearTimeout(timeout);\n      timeout = setTimeout(later, wait);\n      if (callNow) result = func.apply(context, args);\n      return result;\n    };\n  };\n\n  // Returns a function that will be executed at most one time, no matter how\n  // often you call it. Useful for lazy initialization.\n  _.once = function(func) {\n    var ran = false, memo;\n    return function() {\n      if (ran) return memo;\n      ran = true;\n      memo = func.apply(this, arguments);\n      func = null;\n      return memo;\n    };\n  };\n\n  // Returns the first function passed as an argument to the second,\n  // allowing you to adjust arguments, run code before and after, and\n  // conditionally execute the original function.\n  _.wrap = function(func, wrapper) {\n    return function() {\n      var args = [func];\n      push.apply(args, arguments);\n      return wrapper.apply(this, args);\n    };\n  };\n\n  // Returns a function that is the composition of a list of functions, each\n  // consuming the return value of the function that follows.\n  _.compose = function() {\n    var funcs = arguments;\n    return function() {\n      var args = arguments;\n      for (var i = funcs.length - 1; i >= 0; i--) {\n        args = [funcs[i].apply(this, args)];\n      }\n      return args[0];\n    };\n  };\n\n  // Returns a function that will only be executed after being called N times.\n  _.after = function(times, func) {\n    if (times <= 0) return func();\n    return function() {\n      if (--times < 1) {\n        return func.apply(this, arguments);\n      }\n    };\n  };\n\n  // Object Functions\n  // ----------------\n\n  // Retrieve the names of an object's properties.\n  // Delegates to **ECMAScript 5**'s native `Object.keys`\n  _.keys = nativeKeys || function(obj) {\n    if (obj !== Object(obj)) throw new TypeError('Invalid object');\n    var keys = [];\n    for (var key in obj) if (_.has(obj, key)) keys[keys.length] = key;\n    return keys;\n  };\n\n  // Retrieve the values of an object's properties.\n  _.values = function(obj) {\n    var values = [];\n    for (var key in obj) if (_.has(obj, key)) values.push(obj[key]);\n    return values;\n  };\n\n  // Convert an object into a list of `[key, value]` pairs.\n  _.pairs = function(obj) {\n    var pairs = [];\n    for (var key in obj) if (_.has(obj, key)) pairs.push([key, obj[key]]);\n    return pairs;\n  };\n\n  // Invert the keys and values of an object. The values must be serializable.\n  _.invert = function(obj) {\n    var result = {};\n    for (var key in obj) if (_.has(obj, key)) result[obj[key]] = key;\n    return result;\n  };\n\n  // Return a sorted list of the function names available on the object.\n  // Aliased as `methods`\n  _.functions = _.methods = function(obj) {\n    var names = [];\n    for (var key in obj) {\n      if (_.isFunction(obj[key])) names.push(key);\n    }\n    return names.sort();\n  };\n\n  // Extend a given object with all the properties in passed-in object(s).\n  _.extend = function(obj) {\n    each(slice.call(arguments, 1), function(source) {\n      if (source) {\n        for (var prop in source) {\n          obj[prop] = source[prop];\n        }\n      }\n    });\n    return obj;\n  };\n\n  // Return a copy of the object only containing the whitelisted properties.\n  _.pick = function(obj) {\n    var copy = {};\n    var keys = concat.apply(ArrayProto, slice.call(arguments, 1));\n    each(keys, function(key) {\n      if (key in obj) copy[key] = obj[key];\n    });\n    return copy;\n  };\n\n   // Return a copy of the object without the blacklisted properties.\n  _.omit = function(obj) {\n    var copy = {};\n    var keys = concat.apply(ArrayProto, slice.call(arguments, 1));\n    for (var key in obj) {\n      if (!_.contains(keys, key)) copy[key] = obj[key];\n    }\n    return copy;\n  };\n\n  // Fill in a given object with default properties.\n  _.defaults = function(obj) {\n    each(slice.call(arguments, 1), function(source) {\n      if (source) {\n        for (var prop in source) {\n          if (obj[prop] == null) obj[prop] = source[prop];\n        }\n      }\n    });\n    return obj;\n  };\n\n  // Create a (shallow-cloned) duplicate of an object.\n  _.clone = function(obj) {\n    if (!_.isObject(obj)) return obj;\n    return _.isArray(obj) ? obj.slice() : _.extend({}, obj);\n  };\n\n  // Invokes interceptor with the obj, and then returns obj.\n  // The primary purpose of this method is to \"tap into\" a method chain, in\n  // order to perform operations on intermediate results within the chain.\n  _.tap = function(obj, interceptor) {\n    interceptor(obj);\n    return obj;\n  };\n\n  // Internal recursive comparison function for `isEqual`.\n  var eq = function(a, b, aStack, bStack) {\n    // Identical objects are equal. `0 === -0`, but they aren't identical.\n    // See the Harmony `egal` proposal: http://wiki.ecmascript.org/doku.php?id=harmony:egal.\n    if (a === b) return a !== 0 || 1 / a == 1 / b;\n    // A strict comparison is necessary because `null == undefined`.\n    if (a == null || b == null) return a === b;\n    // Unwrap any wrapped objects.\n    if (a instanceof _) a = a._wrapped;\n    if (b instanceof _) b = b._wrapped;\n    // Compare `[[Class]]` names.\n    var className = toString.call(a);\n    if (className != toString.call(b)) return false;\n    switch (className) {\n      // Strings, numbers, dates, and booleans are compared by value.\n      case '[object String]':\n        // Primitives and their corresponding object wrappers are equivalent; thus, `\"5\"` is\n        // equivalent to `new String(\"5\")`.\n        return a == String(b);\n      case '[object Number]':\n        // `NaN`s are equivalent, but non-reflexive. An `egal` comparison is performed for\n        // other numeric values.\n        return a != +a ? b != +b : (a == 0 ? 1 / a == 1 / b : a == +b);\n      case '[object Date]':\n      case '[object Boolean]':\n        // Coerce dates and booleans to numeric primitive values. Dates are compared by their\n        // millisecond representations. Note that invalid dates with millisecond representations\n        // of `NaN` are not equivalent.\n        return +a == +b;\n      // RegExps are compared by their source patterns and flags.\n      case '[object RegExp]':\n        return a.source == b.source &&\n               a.global == b.global &&\n               a.multiline == b.multiline &&\n               a.ignoreCase == b.ignoreCase;\n    }\n    if (typeof a != 'object' || typeof b != 'object') return false;\n    // Assume equality for cyclic structures. The algorithm for detecting cyclic\n    // structures is adapted from ES 5.1 section 15.12.3, abstract operation `JO`.\n    var length = aStack.length;\n    while (length--) {\n      // Linear search. Performance is inversely proportional to the number of\n      // unique nested structures.\n      if (aStack[length] == a) return bStack[length] == b;\n    }\n    // Add the first object to the stack of traversed objects.\n    aStack.push(a);\n    bStack.push(b);\n    var size = 0, result = true;\n    // Recursively compare objects and arrays.\n    if (className == '[object Array]') {\n      // Compare array lengths to determine if a deep comparison is necessary.\n      size = a.length;\n      result = size == b.length;\n      if (result) {\n        // Deep compare the contents, ignoring non-numeric properties.\n        while (size--) {\n          if (!(result = eq(a[size], b[size], aStack, bStack))) break;\n        }\n      }\n    } else {\n      // Objects with different constructors are not equivalent, but `Object`s\n      // from different frames are.\n      var aCtor = a.constructor, bCtor = b.constructor;\n      if (aCtor !== bCtor && !(_.isFunction(aCtor) && (aCtor instanceof aCtor) &&\n                               _.isFunction(bCtor) && (bCtor instanceof bCtor))) {\n        return false;\n      }\n      // Deep compare objects.\n      for (var key in a) {\n        if (_.has(a, key)) {\n          // Count the expected number of properties.\n          size++;\n          // Deep compare each member.\n          if (!(result = _.has(b, key) && eq(a[key], b[key], aStack, bStack))) break;\n        }\n      }\n      // Ensure that both objects contain the same number of properties.\n      if (result) {\n        for (key in b) {\n          if (_.has(b, key) && !(size--)) break;\n        }\n        result = !size;\n      }\n    }\n    // Remove the first object from the stack of traversed objects.\n    aStack.pop();\n    bStack.pop();\n    return result;\n  };\n\n  // Perform a deep comparison to check if two objects are equal.\n  _.isEqual = function(a, b) {\n    return eq(a, b, [], []);\n  };\n\n  // Is a given array, string, or object empty?\n  // An \"empty\" object has no enumerable own-properties.\n  _.isEmpty = function(obj) {\n    if (obj == null) return true;\n    if (_.isArray(obj) || _.isString(obj)) return obj.length === 0;\n    for (var key in obj) if (_.has(obj, key)) return false;\n    return true;\n  };\n\n  // Is a given value a DOM element?\n  _.isElement = function(obj) {\n    return !!(obj && obj.nodeType === 1);\n  };\n\n  // Is a given value an array?\n  // Delegates to ECMA5's native Array.isArray\n  _.isArray = nativeIsArray || function(obj) {\n    return toString.call(obj) == '[object Array]';\n  };\n\n  // Is a given variable an object?\n  _.isObject = function(obj) {\n    return obj === Object(obj);\n  };\n\n  // Add some isType methods: isArguments, isFunction, isString, isNumber, isDate, isRegExp.\n  each(['Arguments', 'Function', 'String', 'Number', 'Date', 'RegExp'], function(name) {\n    _['is' + name] = function(obj) {\n      return toString.call(obj) == '[object ' + name + ']';\n    };\n  });\n\n  // Define a fallback version of the method in browsers (ahem, IE), where\n  // there isn't any inspectable \"Arguments\" type.\n  if (!_.isArguments(arguments)) {\n    _.isArguments = function(obj) {\n      return !!(obj && _.has(obj, 'callee'));\n    };\n  }\n\n  // Optimize `isFunction` if appropriate.\n  if (typeof (/./) !== 'function') {\n    _.isFunction = function(obj) {\n      return typeof obj === 'function';\n    };\n  }\n\n  // Is a given object a finite number?\n  _.isFinite = function(obj) {\n    return isFinite(obj) && !isNaN(parseFloat(obj));\n  };\n\n  // Is the given value `NaN`? (NaN is the only number which does not equal itself).\n  _.isNaN = function(obj) {\n    return _.isNumber(obj) && obj != +obj;\n  };\n\n  // Is a given value a boolean?\n  _.isBoolean = function(obj) {\n    return obj === true || obj === false || toString.call(obj) == '[object Boolean]';\n  };\n\n  // Is a given value equal to null?\n  _.isNull = function(obj) {\n    return obj === null;\n  };\n\n  // Is a given variable undefined?\n  _.isUndefined = function(obj) {\n    return obj === void 0;\n  };\n\n  // Shortcut function for checking if an object has a given property directly\n  // on itself (in other words, not on a prototype).\n  _.has = function(obj, key) {\n    return hasOwnProperty.call(obj, key);\n  };\n\n  // Utility Functions\n  // -----------------\n\n  // Run Underscore.js in *noConflict* mode, returning the `_` variable to its\n  // previous owner. Returns a reference to the Underscore object.\n  _.noConflict = function() {\n    root._ = previousUnderscore;\n    return this;\n  };\n\n  // Keep the identity function around for default iterators.\n  _.identity = function(value) {\n    return value;\n  };\n\n  // Run a function **n** times.\n  _.times = function(n, iterator, context) {\n    var accum = Array(n);\n    for (var i = 0; i < n; i++) accum[i] = iterator.call(context, i);\n    return accum;\n  };\n\n  // Return a random integer between min and max (inclusive).\n  _.random = function(min, max) {\n    if (max == null) {\n      max = min;\n      min = 0;\n    }\n    return min + Math.floor(Math.random() * (max - min + 1));\n  };\n\n  // List of HTML entities for escaping.\n  var entityMap = {\n    escape: {\n      '&': '&amp;',\n      '<': '&lt;',\n      '>': '&gt;',\n      '\"': '&quot;',\n      \"'\": '&#x27;',\n      '/': '&#x2F;'\n    }\n  };\n  entityMap.unescape = _.invert(entityMap.escape);\n\n  // Regexes containing the keys and values listed immediately above.\n  var entityRegexes = {\n    escape:   new RegExp('[' + _.keys(entityMap.escape).join('') + ']', 'g'),\n    unescape: new RegExp('(' + _.keys(entityMap.unescape).join('|') + ')', 'g')\n  };\n\n  // Functions for escaping and unescaping strings to/from HTML interpolation.\n  _.each(['escape', 'unescape'], function(method) {\n    _[method] = function(string) {\n      if (string == null) return '';\n      return ('' + string).replace(entityRegexes[method], function(match) {\n        return entityMap[method][match];\n      });\n    };\n  });\n\n  // If the value of the named property is a function then invoke it;\n  // otherwise, return it.\n  _.result = function(object, property) {\n    if (object == null) return null;\n    var value = object[property];\n    return _.isFunction(value) ? value.call(object) : value;\n  };\n\n  // Add your own custom functions to the Underscore object.\n  _.mixin = function(obj) {\n    each(_.functions(obj), function(name){\n      var func = _[name] = obj[name];\n      _.prototype[name] = function() {\n        var args = [this._wrapped];\n        push.apply(args, arguments);\n        return result.call(this, func.apply(_, args));\n      };\n    });\n  };\n\n  // Generate a unique integer id (unique within the entire client session).\n  // Useful for temporary DOM ids.\n  var idCounter = 0;\n  _.uniqueId = function(prefix) {\n    var id = ++idCounter + '';\n    return prefix ? prefix + id : id;\n  };\n\n  // By default, Underscore uses ERB-style template delimiters, change the\n  // following template settings to use alternative delimiters.\n  _.templateSettings = {\n    evaluate    : /<%([\\s\\S]+?)%>/g,\n    interpolate : /<%=([\\s\\S]+?)%>/g,\n    escape      : /<%-([\\s\\S]+?)%>/g\n  };\n\n  // When customizing `templateSettings`, if you don't want to define an\n  // interpolation, evaluation or escaping regex, we need one that is\n  // guaranteed not to match.\n  var noMatch = /(.)^/;\n\n  // Certain characters need to be escaped so that they can be put into a\n  // string literal.\n  var escapes = {\n    \"'\":      \"'\",\n    '\\\\':     '\\\\',\n    '\\r':     'r',\n    '\\n':     'n',\n    '\\t':     't',\n    '\\u2028': 'u2028',\n    '\\u2029': 'u2029'\n  };\n\n  var escaper = /\\\\|'|\\r|\\n|\\t|\\u2028|\\u2029/g;\n\n  // JavaScript micro-templating, similar to John Resig's implementation.\n  // Underscore templating handles arbitrary delimiters, preserves whitespace,\n  // and correctly escapes quotes within interpolated code.\n  _.template = function(text, data, settings) {\n    var render;\n    settings = _.defaults({}, settings, _.templateSettings);\n\n    // Combine delimiters into one regular expression via alternation.\n    var matcher = new RegExp([\n      (settings.escape || noMatch).source,\n      (settings.interpolate || noMatch).source,\n      (settings.evaluate || noMatch).source\n    ].join('|') + '|$', 'g');\n\n    // Compile the template source, escaping string literals appropriately.\n    var index = 0;\n    var source = \"__p+='\";\n    text.replace(matcher, function(match, escape, interpolate, evaluate, offset) {\n      source += text.slice(index, offset)\n        .replace(escaper, function(match) { return '\\\\' + escapes[match]; });\n\n      if (escape) {\n        source += \"'+\\n((__t=(\" + escape + \"))==null?'':_.escape(__t))+\\n'\";\n      }\n      if (interpolate) {\n        source += \"'+\\n((__t=(\" + interpolate + \"))==null?'':__t)+\\n'\";\n      }\n      if (evaluate) {\n        source += \"';\\n\" + evaluate + \"\\n__p+='\";\n      }\n      index = offset + match.length;\n      return match;\n    });\n    source += \"';\\n\";\n\n    // If a variable is not specified, place data values in local scope.\n    if (!settings.variable) source = 'with(obj||{}){\\n' + source + '}\\n';\n\n    source = \"var __t,__p='',__j=Array.prototype.join,\" +\n      \"print=function(){__p+=__j.call(arguments,'');};\\n\" +\n      source + \"return __p;\\n\";\n\n    try {\n      render = new Function(settings.variable || 'obj', '_', source);\n    } catch (e) {\n      e.source = source;\n      throw e;\n    }\n\n    if (data) return render(data, _);\n    var template = function(data) {\n      return render.call(this, data, _);\n    };\n\n    // Provide the compiled function source as a convenience for precompilation.\n    template.source = 'function(' + (settings.variable || 'obj') + '){\\n' + source + '}';\n\n    return template;\n  };\n\n  // Add a \"chain\" function, which will delegate to the wrapper.\n  _.chain = function(obj) {\n    return _(obj).chain();\n  };\n\n  // OOP\n  // ---------------\n  // If Underscore is called as a function, it returns a wrapped object that\n  // can be used OO-style. This wrapper holds altered versions of all the\n  // underscore functions. Wrapped objects may be chained.\n\n  // Helper function to continue chaining intermediate results.\n  var result = function(obj) {\n    return this._chain ? _(obj).chain() : obj;\n  };\n\n  // Add all of the Underscore functions to the wrapper object.\n  _.mixin(_);\n\n  // Add all mutator Array functions to the wrapper.\n  each(['pop', 'push', 'reverse', 'shift', 'sort', 'splice', 'unshift'], function(name) {\n    var method = ArrayProto[name];\n    _.prototype[name] = function() {\n      var obj = this._wrapped;\n      method.apply(obj, arguments);\n      if ((name == 'shift' || name == 'splice') && obj.length === 0) delete obj[0];\n      return result.call(this, obj);\n    };\n  });\n\n  // Add all accessor Array functions to the wrapper.\n  each(['concat', 'join', 'slice'], function(name) {\n    var method = ArrayProto[name];\n    _.prototype[name] = function() {\n      return result.call(this, method.apply(this._wrapped, arguments));\n    };\n  });\n\n  _.extend(_.prototype, {\n\n    // Start chaining a wrapped Underscore object.\n    chain: function() {\n      this._chain = true;\n      return this;\n    },\n\n    // Extracts the result from a wrapped and chained object.\n    value: function() {\n      return this._wrapped;\n    }\n\n  });\n\n}).call(this);\n","/**\n * Handle models (i.e. docs)\n * Serialization/deserialization\n * Copying\n * Querying, update\n */\n\nvar util = require('util')\n  , _ = require('underscore')\n  , modifierFunctions = {}\n  , lastStepModifierFunctions = {}\n  , comparisonFunctions = {}\n  , logicalOperators = {}\n  , arrayComparisonFunctions = {}\n  ;\n\n\n/**\n * Check a key, throw an error if the key is non valid\n * @param {String} k key\n * @param {Model} v value, needed to treat the Date edge case\n * Non-treatable edge cases here: if part of the object if of the form { $$date: number } or { $$deleted: true }\n * Its serialized-then-deserialized version it will transformed into a Date object\n * But you really need to want it to trigger such behaviour, even when warned not to use '$' at the beginning of the field names...\n */\nfunction checkKey (k, v) {\n  if (typeof k === 'number') {\n    k = k.toString();\n  }\n\n  if (k[0] === '$' && !(k === '$$date' && typeof v === 'number') && !(k === '$$deleted' && v === true) && !(k === '$$indexCreated') && !(k === '$$indexRemoved')) {\n    throw new Error('Field names cannot begin with the $ character');\n  }\n\n  if (k.indexOf('.') !== -1) {\n    throw new Error('Field names cannot contain a .');\n  }\n}\n\n\n/**\n * Check a DB object and throw an error if it's not valid\n * Works by applying the above checkKey function to all fields recursively\n */\nfunction checkObject (obj) {\n  if (util.isArray(obj)) {\n    obj.forEach(function (o) {\n      checkObject(o);\n    });\n  }\n\n  if (typeof obj === 'object' && obj !== null) {\n    Object.keys(obj).forEach(function (k) {\n      checkKey(k, obj[k]);\n      checkObject(obj[k]);\n    });\n  }\n}\n\n\n/**\n * Serialize an object to be persisted to a one-line string\n * For serialization/deserialization, we use the native JSON parser and not eval or Function\n * That gives us less freedom but data entered in the database may come from users\n * so eval and the like are not safe\n * Accepted primitive types: Number, String, Boolean, Date, null\n * Accepted secondary types: Objects, Arrays\n */\nfunction serialize (obj) {\n  var res;\n\n  res = JSON.stringify(obj, function (k, v) {\n    checkKey(k, v);\n\n    if (v === undefined) { return undefined; }\n    if (v === null) { return null; }\n\n    // Hackish way of checking if object is Date (this way it works between execution contexts in node-webkit).\n    // We can't use value directly because for dates it is already string in this function (date.toJSON was already called), so we use this\n    if (typeof this[k].getTime === 'function') { return { $$date: this[k].getTime() }; }\n\n    return v;\n  });\n\n  return res;\n}\n\n\n/**\n * From a one-line representation of an object generate by the serialize function\n * Return the object itself\n */\nfunction deserialize (rawData) {\n  return JSON.parse(rawData, function (k, v) {\n    if (k === '$$date') { return new Date(v); }\n    if (typeof v === 'string' || typeof v === 'number' || typeof v === 'boolean' || v === null) { return v; }\n    if (v && v.$$date) { return v.$$date; }\n\n    return v;\n  });\n}\n\n\n/**\n * Deep copy a DB object\n * The optional strictKeys flag (defaulting to false) indicates whether to copy everything or only fields\n * where the keys are valid, i.e. don't begin with $ and don't contain a .\n */\nfunction deepCopy (obj, strictKeys) {\n  var res;\n\n  if ( typeof obj === 'boolean' ||\n       typeof obj === 'number' ||\n       typeof obj === 'string' ||\n       obj === null ||\n       (util.isDate(obj)) ) {\n    return obj;\n  }\n\n  if (util.isArray(obj)) {\n    res = [];\n    obj.forEach(function (o) { res.push(deepCopy(o, strictKeys)); });\n    return res;\n  }\n\n  if (typeof obj === 'object') {\n    res = {};\n    Object.keys(obj).forEach(function (k) {\n      if (!strictKeys || (k[0] !== '$' && k.indexOf('.') === -1)) {\n        res[k] = deepCopy(obj[k], strictKeys);\n      }\n    });\n    return res;\n  }\n\n  return undefined;   // For now everything else is undefined. We should probably throw an error instead\n}\n\n\n/**\n * Tells if an object is a primitive type or a \"real\" object\n * Arrays are considered primitive\n */\nfunction isPrimitiveType (obj) {\n  return ( typeof obj === 'boolean' ||\n       typeof obj === 'number' ||\n       typeof obj === 'string' ||\n       obj === null ||\n       util.isDate(obj) ||\n       util.isArray(obj));\n}\n\n\n/**\n * Utility functions for comparing things\n * Assumes type checking was already done (a and b already have the same type)\n * compareNSB works for numbers, strings and booleans\n */\nfunction compareNSB (a, b) {\n  if (a < b) { return -1; }\n  if (a > b) { return 1; }\n  return 0;\n}\n\nfunction compareArrays (a, b) {\n  var i, comp;\n\n  for (i = 0; i < Math.min(a.length, b.length); i += 1) {\n    comp = compareThings(a[i], b[i]);\n\n    if (comp !== 0) { return comp; }\n  }\n\n  // Common section was identical, longest one wins\n  return compareNSB(a.length, b.length);\n}\n\n\n/**\n * Compare { things U undefined }\n * Things are defined as any native types (string, number, boolean, null, date) and objects\n * We need to compare with undefined as it will be used in indexes\n * In the case of objects and arrays, we deep-compare\n * If two objects dont have the same type, the (arbitrary) type hierarchy is: undefined, null, number, strings, boolean, dates, arrays, objects\n * Return -1 if a < b, 1 if a > b and 0 if a = b (note that equality here is NOT the same as defined in areThingsEqual!)\n *\n * @param {Function} _compareStrings String comparing function, returning -1, 0 or 1, overriding default string comparison (useful for languages with accented letters)\n */\nfunction compareThings (a, b, _compareStrings) {\n  var aKeys, bKeys, comp, i\n    , compareStrings = _compareStrings || compareNSB;\n\n  // undefined\n  if (a === undefined) { return b === undefined ? 0 : -1; }\n  if (b === undefined) { return a === undefined ? 0 : 1; }\n\n  // null\n  if (a === null) { return b === null ? 0 : -1; }\n  if (b === null) { return a === null ? 0 : 1; }\n\n  // Numbers\n  if (typeof a === 'number') { return typeof b === 'number' ? compareNSB(a, b) : -1; }\n  if (typeof b === 'number') { return typeof a === 'number' ? compareNSB(a, b) : 1; }\n\n  // Strings\n  if (typeof a === 'string') { return typeof b === 'string' ? compareStrings(a, b) : -1; }\n  if (typeof b === 'string') { return typeof a === 'string' ? compareStrings(a, b) : 1; }\n\n  // Booleans\n  if (typeof a === 'boolean') { return typeof b === 'boolean' ? compareNSB(a, b) : -1; }\n  if (typeof b === 'boolean') { return typeof a === 'boolean' ? compareNSB(a, b) : 1; }\n\n  // Dates\n  if (util.isDate(a)) { return util.isDate(b) ? compareNSB(a.getTime(), b.getTime()) : -1; }\n  if (util.isDate(b)) { return util.isDate(a) ? compareNSB(a.getTime(), b.getTime()) : 1; }\n\n  // Arrays (first element is most significant and so on)\n  if (util.isArray(a)) { return util.isArray(b) ? compareArrays(a, b) : -1; }\n  if (util.isArray(b)) { return util.isArray(a) ? compareArrays(a, b) : 1; }\n\n  // Objects\n  aKeys = Object.keys(a).sort();\n  bKeys = Object.keys(b).sort();\n\n  for (i = 0; i < Math.min(aKeys.length, bKeys.length); i += 1) {\n    comp = compareThings(a[aKeys[i]], b[bKeys[i]]);\n\n    if (comp !== 0) { return comp; }\n  }\n\n  return compareNSB(aKeys.length, bKeys.length);\n}\n\n\n\n// ==============================================================\n// Updating documents\n// ==============================================================\n\n/**\n * The signature of modifier functions is as follows\n * Their structure is always the same: recursively follow the dot notation while creating\n * the nested documents if needed, then apply the \"last step modifier\"\n * @param {Object} obj The model to modify\n * @param {String} field Can contain dots, in that case that means we will set a subfield recursively\n * @param {Model} value\n */\n\n/**\n * Set a field to a new value\n */\nlastStepModifierFunctions.$set = function (obj, field, value) {\n  obj[field] = value;\n};\n\n\n/**\n * Unset a field\n */\nlastStepModifierFunctions.$unset = function (obj, field, value) {\n  delete obj[field];\n};\n\n\n/**\n * Push an element to the end of an array field\n * Optional modifier $each instead of value to push several values\n * Optional modifier $slice to slice the resulting array, see https://docs.mongodb.org/manual/reference/operator/update/slice/\n * Diffreence with MongoDB: if $slice is specified and not $each, we act as if value is an empty array\n */\nlastStepModifierFunctions.$push = function (obj, field, value) {\n  // Create the array if it doesn't exist\n  if (!obj.hasOwnProperty(field)) { obj[field] = []; }\n\n  if (!util.isArray(obj[field])) { throw new Error(\"Can't $push an element on non-array values\"); }\n\n  if (value !== null && typeof value === 'object' && value.$slice && value.$each === undefined) {\n    value.$each = [];\n  }\n\n  if (value !== null && typeof value === 'object' && value.$each) {\n    if (Object.keys(value).length >= 3 || (Object.keys(value).length === 2 && value.$slice === undefined)) { throw new Error(\"Can only use $slice in cunjunction with $each when $push to array\"); }\n    if (!util.isArray(value.$each)) { throw new Error(\"$each requires an array value\"); }\n\n    value.$each.forEach(function (v) {\n      obj[field].push(v);\n    });\n\n    if (value.$slice === undefined || typeof value.$slice !== 'number') { return; }\n\n    if (value.$slice === 0) {\n      obj[field] = [];\n    } else {\n      var start, end, n = obj[field].length;\n      if (value.$slice < 0) {\n        start = Math.max(0, n + value.$slice);\n        end = n;\n      } else if (value.$slice > 0) {\n        start = 0;\n        end = Math.min(n, value.$slice);\n      }\n      obj[field] = obj[field].slice(start, end);\n    }\n  } else {\n    obj[field].push(value);\n  }\n};\n\n\n/**\n * Add an element to an array field only if it is not already in it\n * No modification if the element is already in the array\n * Note that it doesn't check whether the original array contains duplicates\n */\nlastStepModifierFunctions.$addToSet = function (obj, field, value) {\n  var addToSet = true;\n\n  // Create the array if it doesn't exist\n  if (!obj.hasOwnProperty(field)) { obj[field] = []; }\n\n  if (!util.isArray(obj[field])) { throw new Error(\"Can't $addToSet an element on non-array values\"); }\n\n  if (value !== null && typeof value === 'object' && value.$each) {\n    if (Object.keys(value).length > 1) { throw new Error(\"Can't use another field in conjunction with $each\"); }\n    if (!util.isArray(value.$each)) { throw new Error(\"$each requires an array value\"); }\n\n    value.$each.forEach(function (v) {\n      lastStepModifierFunctions.$addToSet(obj, field, v);\n    });\n  } else {\n    obj[field].forEach(function (v) {\n      if (compareThings(v, value) === 0) { addToSet = false; }\n    });\n    if (addToSet) { obj[field].push(value); }\n  }\n};\n\n\n/**\n * Remove the first or last element of an array\n */\nlastStepModifierFunctions.$pop = function (obj, field, value) {\n  if (!util.isArray(obj[field])) { throw new Error(\"Can't $pop an element from non-array values\"); }\n  if (typeof value !== 'number') { throw new Error(value + \" isn't an integer, can't use it with $pop\"); }\n  if (value === 0) { return; }\n\n  if (value > 0) {\n    obj[field] = obj[field].slice(0, obj[field].length - 1);\n  } else {\n    obj[field] = obj[field].slice(1);\n  }\n};\n\n\n/**\n * Removes all instances of a value from an existing array\n */\nlastStepModifierFunctions.$pull = function (obj, field, value) {\n  var arr, i;\n\n  if (!util.isArray(obj[field])) { throw new Error(\"Can't $pull an element from non-array values\"); }\n\n  arr = obj[field];\n  for (i = arr.length - 1; i >= 0; i -= 1) {\n    if (match(arr[i], value)) {\n      arr.splice(i, 1);\n    }\n  }\n};\n\n\n/**\n * Increment a numeric field's value\n */\nlastStepModifierFunctions.$inc = function (obj, field, value) {\n  if (typeof value !== 'number') { throw new Error(value + \" must be a number\"); }\n\n  if (typeof obj[field] !== 'number') {\n    if (!_.has(obj, field)) {\n      obj[field] = value;\n    } else {\n      throw new Error(\"Don't use the $inc modifier on non-number fields\");\n    }\n  } else {\n    obj[field] += value;\n  }\n};\n\n/**\n * Updates the value of the field, only if specified field is greater than the current value of the field\n */\nlastStepModifierFunctions.$max = function (obj, field, value) {\n  if (typeof obj[field] === 'undefined') {\n    obj[field] = value;\n  } else if (value > obj[field]) {\n    obj[field] = value;\n  }\n};\n\n/**\n * Updates the value of the field, only if specified field is smaller than the current value of the field\n */\nlastStepModifierFunctions.$min = function (obj, field, value) {\n  if (typeof obj[field] === 'undefined') {\n    obj[field] = value;\n  } else if (value < obj[field]) {\n    obj[field] = value;\n  }\n};\n\n// Given its name, create the complete modifier function\nfunction createModifierFunction (modifier) {\n  return function (obj, field, value) {\n    var fieldParts = typeof field === 'string' ? field.split('.') : field;\n\n    if (fieldParts.length === 1) {\n      lastStepModifierFunctions[modifier](obj, field, value);\n    } else {\n      if (obj[fieldParts[0]] === undefined) {\n        if (modifier === '$unset') { return; }   // Bad looking specific fix, needs to be generalized modifiers that behave like $unset are implemented\n        obj[fieldParts[0]] = {};\n      }\n      modifierFunctions[modifier](obj[fieldParts[0]], fieldParts.slice(1), value);\n    }\n  };\n}\n\n// Actually create all modifier functions\nObject.keys(lastStepModifierFunctions).forEach(function (modifier) {\n  modifierFunctions[modifier] = createModifierFunction(modifier);\n});\n\n\n/**\n * Modify a DB object according to an update query\n */\nfunction modify (obj, updateQuery) {\n  var keys = Object.keys(updateQuery)\n    , firstChars = _.map(keys, function (item) { return item[0]; })\n    , dollarFirstChars = _.filter(firstChars, function (c) { return c === '$'; })\n    , newDoc, modifiers\n    ;\n\n  if (keys.indexOf('_id') !== -1 && updateQuery._id !== obj._id) { throw new Error(\"You cannot change a document's _id\"); }\n\n  if (dollarFirstChars.length !== 0 && dollarFirstChars.length !== firstChars.length) {\n    throw new Error(\"You cannot mix modifiers and normal fields\");\n  }\n\n  if (dollarFirstChars.length === 0) {\n    // Simply replace the object with the update query contents\n    newDoc = deepCopy(updateQuery);\n    newDoc._id = obj._id;\n  } else {\n    // Apply modifiers\n    modifiers = _.uniq(keys);\n    newDoc = deepCopy(obj);\n    modifiers.forEach(function (m) {\n      var keys;\n\n      if (!modifierFunctions[m]) { throw new Error(\"Unknown modifier \" + m); }\n\n      // Can't rely on Object.keys throwing on non objects since ES6\n      // Not 100% satisfying as non objects can be interpreted as objects but no false negatives so we can live with it\n      if (typeof updateQuery[m] !== 'object') {\n        throw new Error(\"Modifier \" + m + \"'s argument must be an object\");\n      }\n\n      keys = Object.keys(updateQuery[m]);\n      keys.forEach(function (k) {\n        modifierFunctions[m](newDoc, k, updateQuery[m][k]);\n      });\n    });\n  }\n\n  // Check result is valid and return it\n  checkObject(newDoc);\n\n  if (obj._id !== newDoc._id) { throw new Error(\"You can't change a document's _id\"); }\n  return newDoc;\n};\n\n\n// ==============================================================\n// Finding documents\n// ==============================================================\n\n/**\n * Get a value from object with dot notation\n * @param {Object} obj\n * @param {String} field\n */\nfunction getDotValue (obj, field) {\n  var fieldParts = typeof field === 'string' ? field.split('.') : field\n    , i, objs;\n\n  if (!obj) { return undefined; }   // field cannot be empty so that means we should return undefined so that nothing can match\n\n  if (fieldParts.length === 0) { return obj; }\n\n  if (fieldParts.length === 1) { return obj[fieldParts[0]]; }\n\n  if (util.isArray(obj[fieldParts[0]])) {\n    // If the next field is an integer, return only this item of the array\n    i = parseInt(fieldParts[1], 10);\n    if (typeof i === 'number' && !isNaN(i)) {\n      return getDotValue(obj[fieldParts[0]][i], fieldParts.slice(2))\n    }\n\n    // Return the array of values\n    objs = new Array();\n    for (i = 0; i < obj[fieldParts[0]].length; i += 1) {\n       objs.push(getDotValue(obj[fieldParts[0]][i], fieldParts.slice(1)));\n    }\n    return objs;\n  } else {\n    return getDotValue(obj[fieldParts[0]], fieldParts.slice(1));\n  }\n}\n\n\n/**\n * Check whether 'things' are equal\n * Things are defined as any native types (string, number, boolean, null, date) and objects\n * In the case of object, we check deep equality\n * Returns true if they are, false otherwise\n */\nfunction areThingsEqual (a, b) {\n  var aKeys , bKeys , i;\n\n  // Strings, booleans, numbers, null\n  if (a === null || typeof a === 'string' || typeof a === 'boolean' || typeof a === 'number' ||\n      b === null || typeof b === 'string' || typeof b === 'boolean' || typeof b === 'number') { return a === b; }\n\n  // Dates\n  if (util.isDate(a) || util.isDate(b)) { return util.isDate(a) && util.isDate(b) && a.getTime() === b.getTime(); }\n\n  // Arrays (no match since arrays are used as a $in)\n  // undefined (no match since they mean field doesn't exist and can't be serialized)\n  if ((!(util.isArray(a) && util.isArray(b)) && (util.isArray(a) || util.isArray(b))) || a === undefined || b === undefined) { return false; }\n\n  // General objects (check for deep equality)\n  // a and b should be objects at this point\n  try {\n    aKeys = Object.keys(a);\n    bKeys = Object.keys(b);\n  } catch (e) {\n    return false;\n  }\n\n  if (aKeys.length !== bKeys.length) { return false; }\n  for (i = 0; i < aKeys.length; i += 1) {\n    if (bKeys.indexOf(aKeys[i]) === -1) { return false; }\n    if (!areThingsEqual(a[aKeys[i]], b[aKeys[i]])) { return false; }\n  }\n  return true;\n}\n\n\n/**\n * Check that two values are comparable\n */\nfunction areComparable (a, b) {\n  if (typeof a !== 'string' && typeof a !== 'number' && !util.isDate(a) &&\n      typeof b !== 'string' && typeof b !== 'number' && !util.isDate(b)) {\n    return false;\n  }\n\n  if (typeof a !== typeof b) { return false; }\n\n  return true;\n}\n\n\n/**\n * Arithmetic and comparison operators\n * @param {Native value} a Value in the object\n * @param {Native value} b Value in the query\n */\ncomparisonFunctions.$lt = function (a, b) {\n  return areComparable(a, b) && a < b;\n};\n\ncomparisonFunctions.$lte = function (a, b) {\n  return areComparable(a, b) && a <= b;\n};\n\ncomparisonFunctions.$gt = function (a, b) {\n  return areComparable(a, b) && a > b;\n};\n\ncomparisonFunctions.$gte = function (a, b) {\n  return areComparable(a, b) && a >= b;\n};\n\ncomparisonFunctions.$ne = function (a, b) {\n  if (a === undefined) { return true; }\n  return !areThingsEqual(a, b);\n};\n\ncomparisonFunctions.$in = function (a, b) {\n  var i;\n\n  if (!util.isArray(b)) { throw new Error(\"$in operator called with a non-array\"); }\n\n  for (i = 0; i < b.length; i += 1) {\n    if (areThingsEqual(a, b[i])) { return true; }\n  }\n\n  return false;\n};\n\ncomparisonFunctions.$nin = function (a, b) {\n  if (!util.isArray(b)) { throw new Error(\"$nin operator called with a non-array\"); }\n\n  return !comparisonFunctions.$in(a, b);\n};\n\ncomparisonFunctions.$regex = function (a, b) {\n  if (!util.isRegExp(b)) { throw new Error(\"$regex operator called with non regular expression\"); }\n\n  if (typeof a !== 'string') {\n    return false\n  } else {\n    return b.test(a);\n  }\n};\n\ncomparisonFunctions.$exists = function (value, exists) {\n  if (exists || exists === '') {   // This will be true for all values of exists except false, null, undefined and 0\n    exists = true;                 // That's strange behaviour (we should only use true/false) but that's the way Mongo does it...\n  } else {\n    exists = false;\n  }\n\n  if (value === undefined) {\n    return !exists\n  } else {\n    return exists;\n  }\n};\n\n// Specific to arrays\ncomparisonFunctions.$size = function (obj, value) {\n    if (!util.isArray(obj)) { return false; }\n    if (value % 1 !== 0) { throw new Error(\"$size operator called without an integer\"); }\n\n    return (obj.length == value);\n};\ncomparisonFunctions.$elemMatch = function (obj, value) {\n  if (!util.isArray(obj)) { return false; }\n  var i = obj.length;\n  var result = false;   // Initialize result\n  while (i--) {\n    if (match(obj[i], value)) {   // If match for array element, return true\n      result = true;\n      break;\n    }\n  }\n  return result;\n};\narrayComparisonFunctions.$size = true;\narrayComparisonFunctions.$elemMatch = true;\n\n\n/**\n * Match any of the subqueries\n * @param {Model} obj\n * @param {Array of Queries} query\n */\nlogicalOperators.$or = function (obj, query) {\n  var i;\n\n  if (!util.isArray(query)) { throw new Error(\"$or operator used without an array\"); }\n\n  for (i = 0; i < query.length; i += 1) {\n    if (match(obj, query[i])) { return true; }\n  }\n\n  return false;\n};\n\n\n/**\n * Match all of the subqueries\n * @param {Model} obj\n * @param {Array of Queries} query\n */\nlogicalOperators.$and = function (obj, query) {\n  var i;\n\n  if (!util.isArray(query)) { throw new Error(\"$and operator used without an array\"); }\n\n  for (i = 0; i < query.length; i += 1) {\n    if (!match(obj, query[i])) { return false; }\n  }\n\n  return true;\n};\n\n\n/**\n * Inverted match of the query\n * @param {Model} obj\n * @param {Query} query\n */\nlogicalOperators.$not = function (obj, query) {\n  return !match(obj, query);\n};\n\n\n/**\n * Use a function to match\n * @param {Model} obj\n * @param {Query} query\n */\nlogicalOperators.$where = function (obj, fn) {\n  var result;\n\n  if (!_.isFunction(fn)) { throw new Error(\"$where operator used without a function\"); }\n\n  result = fn.call(obj);\n  if (!_.isBoolean(result)) { throw new Error(\"$where function must return boolean\"); }\n\n  return result;\n};\n\n\n/**\n * Tell if a given document matches a query\n * @param {Object} obj Document to check\n * @param {Object} query\n */\nfunction match (obj, query) {\n  var queryKeys, queryKey, queryValue, i;\n\n  // Primitive query against a primitive type\n  // This is a bit of a hack since we construct an object with an arbitrary key only to dereference it later\n  // But I don't have time for a cleaner implementation now\n  if (isPrimitiveType(obj) || isPrimitiveType(query)) {\n    return matchQueryPart({ needAKey: obj }, 'needAKey', query);\n  }\n\n  // Normal query\n  queryKeys = Object.keys(query);\n  for (i = 0; i < queryKeys.length; i += 1) {\n    queryKey = queryKeys[i];\n    queryValue = query[queryKey];\n\n    if (queryKey[0] === '$') {\n      if (!logicalOperators[queryKey]) { throw new Error(\"Unknown logical operator \" + queryKey); }\n      if (!logicalOperators[queryKey](obj, queryValue)) { return false; }\n    } else {\n      if (!matchQueryPart(obj, queryKey, queryValue)) { return false; }\n    }\n  }\n\n  return true;\n};\n\n\n/**\n * Match an object against a specific { key: value } part of a query\n * if the treatObjAsValue flag is set, don't try to match every part separately, but the array as a whole\n */\nfunction matchQueryPart (obj, queryKey, queryValue, treatObjAsValue) {\n  var objValue = getDotValue(obj, queryKey)\n    , i, keys, firstChars, dollarFirstChars;\n\n  // Check if the value is an array if we don't force a treatment as value\n  if (util.isArray(objValue) && !treatObjAsValue) {\n    // If the queryValue is an array, try to perform an exact match\n    if (util.isArray(queryValue)) {\n      return matchQueryPart(obj, queryKey, queryValue, true);\n    }\n\n    // Check if we are using an array-specific comparison function\n    if (queryValue !== null && typeof queryValue === 'object' && !util.isRegExp(queryValue)) {\n      keys = Object.keys(queryValue);\n      for (i = 0; i < keys.length; i += 1) {\n        if (arrayComparisonFunctions[keys[i]]) { return matchQueryPart(obj, queryKey, queryValue, true); }\n      }\n    }\n\n    // If not, treat it as an array of { obj, query } where there needs to be at least one match\n    for (i = 0; i < objValue.length; i += 1) {\n      if (matchQueryPart({ k: objValue[i] }, 'k', queryValue)) { return true; }   // k here could be any string\n    }\n    return false;\n  }\n\n  // queryValue is an actual object. Determine whether it contains comparison operators\n  // or only normal fields. Mixed objects are not allowed\n  if (queryValue !== null && typeof queryValue === 'object' && !util.isRegExp(queryValue) && !util.isArray(queryValue)) {\n    keys = Object.keys(queryValue);\n    firstChars = _.map(keys, function (item) { return item[0]; });\n    dollarFirstChars = _.filter(firstChars, function (c) { return c === '$'; });\n\n    if (dollarFirstChars.length !== 0 && dollarFirstChars.length !== firstChars.length) {\n      throw new Error(\"You cannot mix operators and normal fields\");\n    }\n\n    // queryValue is an object of this form: { $comparisonOperator1: value1, ... }\n    if (dollarFirstChars.length > 0) {\n      for (i = 0; i < keys.length; i += 1) {\n        if (!comparisonFunctions[keys[i]]) { throw new Error(\"Unknown comparison function \" + keys[i]); }\n\n        if (!comparisonFunctions[keys[i]](objValue, queryValue[keys[i]])) { return false; }\n      }\n      return true;\n    }\n  }\n\n  // Using regular expressions with basic querying\n  if (util.isRegExp(queryValue)) { return comparisonFunctions.$regex(objValue, queryValue); }\n\n  // queryValue is either a native value or a normal object\n  // Basic matching is possible\n  if (!areThingsEqual(objValue, queryValue)) { return false; }\n\n  return true;\n}\n\n\n// Interface\nmodule.exports.serialize = serialize;\nmodule.exports.deserialize = deserialize;\nmodule.exports.deepCopy = deepCopy;\nmodule.exports.checkObject = checkObject;\nmodule.exports.isPrimitiveType = isPrimitiveType;\nmodule.exports.modify = modify;\nmodule.exports.getDotValue = getDotValue;\nmodule.exports.match = match;\nmodule.exports.areThingsEqual = areThingsEqual;\nmodule.exports.compareThings = compareThings;\n","/*global setImmediate: false, setTimeout: false, console: false */\n(function () {\n\n    var async = {};\n\n    // global on the server, window in the browser\n    var root, previous_async;\n\n    root = this;\n    if (root != null) {\n      previous_async = root.async;\n    }\n\n    async.noConflict = function () {\n        root.async = previous_async;\n        return async;\n    };\n\n    function only_once(fn) {\n        var called = false;\n        return function() {\n            if (called) throw new Error(\"Callback was already called.\");\n            called = true;\n            fn.apply(root, arguments);\n        }\n    }\n\n    //// cross-browser compatiblity functions ////\n\n    var _each = function (arr, iterator) {\n        if (arr.forEach) {\n            return arr.forEach(iterator);\n        }\n        for (var i = 0; i < arr.length; i += 1) {\n            iterator(arr[i], i, arr);\n        }\n    };\n\n    var _map = function (arr, iterator) {\n        if (arr.map) {\n            return arr.map(iterator);\n        }\n        var results = [];\n        _each(arr, function (x, i, a) {\n            results.push(iterator(x, i, a));\n        });\n        return results;\n    };\n\n    var _reduce = function (arr, iterator, memo) {\n        if (arr.reduce) {\n            return arr.reduce(iterator, memo);\n        }\n        _each(arr, function (x, i, a) {\n            memo = iterator(memo, x, i, a);\n        });\n        return memo;\n    };\n\n    var _keys = function (obj) {\n        if (Object.keys) {\n            return Object.keys(obj);\n        }\n        var keys = [];\n        for (var k in obj) {\n            if (obj.hasOwnProperty(k)) {\n                keys.push(k);\n            }\n        }\n        return keys;\n    };\n\n    //// exported async module functions ////\n\n    //// nextTick implementation with browser-compatible fallback ////\n    if (typeof process === 'undefined' || !(process.nextTick)) {\n        if (typeof setImmediate === 'function') {\n            async.nextTick = function (fn) {\n                // not a direct alias for IE10 compatibility\n                setImmediate(fn);\n            };\n            async.setImmediate = async.nextTick;\n        }\n        else {\n            async.nextTick = function (fn) {\n                setTimeout(fn, 0);\n            };\n            async.setImmediate = async.nextTick;\n        }\n    }\n    else {\n        async.nextTick = process.nextTick;\n        if (typeof setImmediate !== 'undefined') {\n            async.setImmediate = function (fn) {\n              // not a direct alias for IE10 compatibility\n              setImmediate(fn);\n            };\n        }\n        else {\n            async.setImmediate = async.nextTick;\n        }\n    }\n\n    async.each = function (arr, iterator, callback) {\n        callback = callback || function () {};\n        if (!arr.length) {\n            return callback();\n        }\n        var completed = 0;\n        _each(arr, function (x) {\n            iterator(x, only_once(function (err) {\n                if (err) {\n                    callback(err);\n                    callback = function () {};\n                }\n                else {\n                    completed += 1;\n                    if (completed >= arr.length) {\n                        callback(null);\n                    }\n                }\n            }));\n        });\n    };\n    async.forEach = async.each;\n\n    async.eachSeries = function (arr, iterator, callback) {\n        callback = callback || function () {};\n        if (!arr.length) {\n            return callback();\n        }\n        var completed = 0;\n        var iterate = function () {\n            iterator(arr[completed], function (err) {\n                if (err) {\n                    callback(err);\n                    callback = function () {};\n                }\n                else {\n                    completed += 1;\n                    if (completed >= arr.length) {\n                        callback(null);\n                    }\n                    else {\n                        iterate();\n                    }\n                }\n            });\n        };\n        iterate();\n    };\n    async.forEachSeries = async.eachSeries;\n\n    async.eachLimit = function (arr, limit, iterator, callback) {\n        var fn = _eachLimit(limit);\n        fn.apply(null, [arr, iterator, callback]);\n    };\n    async.forEachLimit = async.eachLimit;\n\n    var _eachLimit = function (limit) {\n\n        return function (arr, iterator, callback) {\n            callback = callback || function () {};\n            if (!arr.length || limit <= 0) {\n                return callback();\n            }\n            var completed = 0;\n            var started = 0;\n            var running = 0;\n\n            (function replenish () {\n                if (completed >= arr.length) {\n                    return callback();\n                }\n\n                while (running < limit && started < arr.length) {\n                    started += 1;\n                    running += 1;\n                    iterator(arr[started - 1], function (err) {\n                        if (err) {\n                            callback(err);\n                            callback = function () {};\n                        }\n                        else {\n                            completed += 1;\n                            running -= 1;\n                            if (completed >= arr.length) {\n                                callback();\n                            }\n                            else {\n                                replenish();\n                            }\n                        }\n                    });\n                }\n            })();\n        };\n    };\n\n\n    var doParallel = function (fn) {\n        return function () {\n            var args = Array.prototype.slice.call(arguments);\n            return fn.apply(null, [async.each].concat(args));\n        };\n    };\n    var doParallelLimit = function(limit, fn) {\n        return function () {\n            var args = Array.prototype.slice.call(arguments);\n            return fn.apply(null, [_eachLimit(limit)].concat(args));\n        };\n    };\n    var doSeries = function (fn) {\n        return function () {\n            var args = Array.prototype.slice.call(arguments);\n            return fn.apply(null, [async.eachSeries].concat(args));\n        };\n    };\n\n\n    var _asyncMap = function (eachfn, arr, iterator, callback) {\n        var results = [];\n        arr = _map(arr, function (x, i) {\n            return {index: i, value: x};\n        });\n        eachfn(arr, function (x, callback) {\n            iterator(x.value, function (err, v) {\n                results[x.index] = v;\n                callback(err);\n            });\n        }, function (err) {\n            callback(err, results);\n        });\n    };\n    async.map = doParallel(_asyncMap);\n    async.mapSeries = doSeries(_asyncMap);\n    async.mapLimit = function (arr, limit, iterator, callback) {\n        return _mapLimit(limit)(arr, iterator, callback);\n    };\n\n    var _mapLimit = function(limit) {\n        return doParallelLimit(limit, _asyncMap);\n    };\n\n    // reduce only has a series version, as doing reduce in parallel won't\n    // work in many situations.\n    async.reduce = function (arr, memo, iterator, callback) {\n        async.eachSeries(arr, function (x, callback) {\n            iterator(memo, x, function (err, v) {\n                memo = v;\n                callback(err);\n            });\n        }, function (err) {\n            callback(err, memo);\n        });\n    };\n    // inject alias\n    async.inject = async.reduce;\n    // foldl alias\n    async.foldl = async.reduce;\n\n    async.reduceRight = function (arr, memo, iterator, callback) {\n        var reversed = _map(arr, function (x) {\n            return x;\n        }).reverse();\n        async.reduce(reversed, memo, iterator, callback);\n    };\n    // foldr alias\n    async.foldr = async.reduceRight;\n\n    var _filter = function (eachfn, arr, iterator, callback) {\n        var results = [];\n        arr = _map(arr, function (x, i) {\n            return {index: i, value: x};\n        });\n        eachfn(arr, function (x, callback) {\n            iterator(x.value, function (v) {\n                if (v) {\n                    results.push(x);\n                }\n                callback();\n            });\n        }, function (err) {\n            callback(_map(results.sort(function (a, b) {\n                return a.index - b.index;\n            }), function (x) {\n                return x.value;\n            }));\n        });\n    };\n    async.filter = doParallel(_filter);\n    async.filterSeries = doSeries(_filter);\n    // select alias\n    async.select = async.filter;\n    async.selectSeries = async.filterSeries;\n\n    var _reject = function (eachfn, arr, iterator, callback) {\n        var results = [];\n        arr = _map(arr, function (x, i) {\n            return {index: i, value: x};\n        });\n        eachfn(arr, function (x, callback) {\n            iterator(x.value, function (v) {\n                if (!v) {\n                    results.push(x);\n                }\n                callback();\n            });\n        }, function (err) {\n            callback(_map(results.sort(function (a, b) {\n                return a.index - b.index;\n            }), function (x) {\n                return x.value;\n            }));\n        });\n    };\n    async.reject = doParallel(_reject);\n    async.rejectSeries = doSeries(_reject);\n\n    var _detect = function (eachfn, arr, iterator, main_callback) {\n        eachfn(arr, function (x, callback) {\n            iterator(x, function (result) {\n                if (result) {\n                    main_callback(x);\n                    main_callback = function () {};\n                }\n                else {\n                    callback();\n                }\n            });\n        }, function (err) {\n            main_callback();\n        });\n    };\n    async.detect = doParallel(_detect);\n    async.detectSeries = doSeries(_detect);\n\n    async.some = function (arr, iterator, main_callback) {\n        async.each(arr, function (x, callback) {\n            iterator(x, function (v) {\n                if (v) {\n                    main_callback(true);\n                    main_callback = function () {};\n                }\n                callback();\n            });\n        }, function (err) {\n            main_callback(false);\n        });\n    };\n    // any alias\n    async.any = async.some;\n\n    async.every = function (arr, iterator, main_callback) {\n        async.each(arr, function (x, callback) {\n            iterator(x, function (v) {\n                if (!v) {\n                    main_callback(false);\n                    main_callback = function () {};\n                }\n                callback();\n            });\n        }, function (err) {\n            main_callback(true);\n        });\n    };\n    // all alias\n    async.all = async.every;\n\n    async.sortBy = function (arr, iterator, callback) {\n        async.map(arr, function (x, callback) {\n            iterator(x, function (err, criteria) {\n                if (err) {\n                    callback(err);\n                }\n                else {\n                    callback(null, {value: x, criteria: criteria});\n                }\n            });\n        }, function (err, results) {\n            if (err) {\n                return callback(err);\n            }\n            else {\n                var fn = function (left, right) {\n                    var a = left.criteria, b = right.criteria;\n                    return a < b ? -1 : a > b ? 1 : 0;\n                };\n                callback(null, _map(results.sort(fn), function (x) {\n                    return x.value;\n                }));\n            }\n        });\n    };\n\n    async.auto = function (tasks, callback) {\n        callback = callback || function () {};\n        var keys = _keys(tasks);\n        if (!keys.length) {\n            return callback(null);\n        }\n\n        var results = {};\n\n        var listeners = [];\n        var addListener = function (fn) {\n            listeners.unshift(fn);\n        };\n        var removeListener = function (fn) {\n            for (var i = 0; i < listeners.length; i += 1) {\n                if (listeners[i] === fn) {\n                    listeners.splice(i, 1);\n                    return;\n                }\n            }\n        };\n        var taskComplete = function () {\n            _each(listeners.slice(0), function (fn) {\n                fn();\n            });\n        };\n\n        addListener(function () {\n            if (_keys(results).length === keys.length) {\n                callback(null, results);\n                callback = function () {};\n            }\n        });\n\n        _each(keys, function (k) {\n            var task = (tasks[k] instanceof Function) ? [tasks[k]]: tasks[k];\n            var taskCallback = function (err) {\n                var args = Array.prototype.slice.call(arguments, 1);\n                if (args.length <= 1) {\n                    args = args[0];\n                }\n                if (err) {\n                    var safeResults = {};\n                    _each(_keys(results), function(rkey) {\n                        safeResults[rkey] = results[rkey];\n                    });\n                    safeResults[k] = args;\n                    callback(err, safeResults);\n                    // stop subsequent errors hitting callback multiple times\n                    callback = function () {};\n                }\n                else {\n                    results[k] = args;\n                    async.setImmediate(taskComplete);\n                }\n            };\n            var requires = task.slice(0, Math.abs(task.length - 1)) || [];\n            var ready = function () {\n                return _reduce(requires, function (a, x) {\n                    return (a && results.hasOwnProperty(x));\n                }, true) && !results.hasOwnProperty(k);\n            };\n            if (ready()) {\n                task[task.length - 1](taskCallback, results);\n            }\n            else {\n                var listener = function () {\n                    if (ready()) {\n                        removeListener(listener);\n                        task[task.length - 1](taskCallback, results);\n                    }\n                };\n                addListener(listener);\n            }\n        });\n    };\n\n    async.waterfall = function (tasks, callback) {\n        callback = callback || function () {};\n        if (tasks.constructor !== Array) {\n          var err = new Error('First argument to waterfall must be an array of functions');\n          return callback(err);\n        }\n        if (!tasks.length) {\n            return callback();\n        }\n        var wrapIterator = function (iterator) {\n            return function (err) {\n                if (err) {\n                    callback.apply(null, arguments);\n                    callback = function () {};\n                }\n                else {\n                    var args = Array.prototype.slice.call(arguments, 1);\n                    var next = iterator.next();\n                    if (next) {\n                        args.push(wrapIterator(next));\n                    }\n                    else {\n                        args.push(callback);\n                    }\n                    async.setImmediate(function () {\n                        iterator.apply(null, args);\n                    });\n                }\n            };\n        };\n        wrapIterator(async.iterator(tasks))();\n    };\n\n    var _parallel = function(eachfn, tasks, callback) {\n        callback = callback || function () {};\n        if (tasks.constructor === Array) {\n            eachfn.map(tasks, function (fn, callback) {\n                if (fn) {\n                    fn(function (err) {\n                        var args = Array.prototype.slice.call(arguments, 1);\n                        if (args.length <= 1) {\n                            args = args[0];\n                        }\n                        callback.call(null, err, args);\n                    });\n                }\n            }, callback);\n        }\n        else {\n            var results = {};\n            eachfn.each(_keys(tasks), function (k, callback) {\n                tasks[k](function (err) {\n                    var args = Array.prototype.slice.call(arguments, 1);\n                    if (args.length <= 1) {\n                        args = args[0];\n                    }\n                    results[k] = args;\n                    callback(err);\n                });\n            }, function (err) {\n                callback(err, results);\n            });\n        }\n    };\n\n    async.parallel = function (tasks, callback) {\n        _parallel({ map: async.map, each: async.each }, tasks, callback);\n    };\n\n    async.parallelLimit = function(tasks, limit, callback) {\n        _parallel({ map: _mapLimit(limit), each: _eachLimit(limit) }, tasks, callback);\n    };\n\n    async.series = function (tasks, callback) {\n        callback = callback || function () {};\n        if (tasks.constructor === Array) {\n            async.mapSeries(tasks, function (fn, callback) {\n                if (fn) {\n                    fn(function (err) {\n                        var args = Array.prototype.slice.call(arguments, 1);\n                        if (args.length <= 1) {\n                            args = args[0];\n                        }\n                        callback.call(null, err, args);\n                    });\n                }\n            }, callback);\n        }\n        else {\n            var results = {};\n            async.eachSeries(_keys(tasks), function (k, callback) {\n                tasks[k](function (err) {\n                    var args = Array.prototype.slice.call(arguments, 1);\n                    if (args.length <= 1) {\n                        args = args[0];\n                    }\n                    results[k] = args;\n                    callback(err);\n                });\n            }, function (err) {\n                callback(err, results);\n            });\n        }\n    };\n\n    async.iterator = function (tasks) {\n        var makeCallback = function (index) {\n            var fn = function () {\n                if (tasks.length) {\n                    tasks[index].apply(null, arguments);\n                }\n                return fn.next();\n            };\n            fn.next = function () {\n                return (index < tasks.length - 1) ? makeCallback(index + 1): null;\n            };\n            return fn;\n        };\n        return makeCallback(0);\n    };\n\n    async.apply = function (fn) {\n        var args = Array.prototype.slice.call(arguments, 1);\n        return function () {\n            return fn.apply(\n                null, args.concat(Array.prototype.slice.call(arguments))\n            );\n        };\n    };\n\n    var _concat = function (eachfn, arr, fn, callback) {\n        var r = [];\n        eachfn(arr, function (x, cb) {\n            fn(x, function (err, y) {\n                r = r.concat(y || []);\n                cb(err);\n            });\n        }, function (err) {\n            callback(err, r);\n        });\n    };\n    async.concat = doParallel(_concat);\n    async.concatSeries = doSeries(_concat);\n\n    async.whilst = function (test, iterator, callback) {\n        if (test()) {\n            iterator(function (err) {\n                if (err) {\n                    return callback(err);\n                }\n                async.whilst(test, iterator, callback);\n            });\n        }\n        else {\n            callback();\n        }\n    };\n\n    async.doWhilst = function (iterator, test, callback) {\n        iterator(function (err) {\n            if (err) {\n                return callback(err);\n            }\n            if (test()) {\n                async.doWhilst(iterator, test, callback);\n            }\n            else {\n                callback();\n            }\n        });\n    };\n\n    async.until = function (test, iterator, callback) {\n        if (!test()) {\n            iterator(function (err) {\n                if (err) {\n                    return callback(err);\n                }\n                async.until(test, iterator, callback);\n            });\n        }\n        else {\n            callback();\n        }\n    };\n\n    async.doUntil = function (iterator, test, callback) {\n        iterator(function (err) {\n            if (err) {\n                return callback(err);\n            }\n            if (!test()) {\n                async.doUntil(iterator, test, callback);\n            }\n            else {\n                callback();\n            }\n        });\n    };\n\n    async.queue = function (worker, concurrency) {\n        if (concurrency === undefined) {\n            concurrency = 1;\n        }\n        function _insert(q, data, pos, callback) {\n          if(data.constructor !== Array) {\n              data = [data];\n          }\n          _each(data, function(task) {\n              var item = {\n                  data: task,\n                  callback: typeof callback === 'function' ? callback : null\n              };\n\n              if (pos) {\n                q.tasks.unshift(item);\n              } else {\n                q.tasks.push(item);\n              }\n\n              if (q.saturated && q.tasks.length === concurrency) {\n                  q.saturated();\n              }\n              async.setImmediate(q.process);\n          });\n        }\n\n        var workers = 0;\n        var q = {\n            tasks: [],\n            concurrency: concurrency,\n            saturated: null,\n            empty: null,\n            drain: null,\n            push: function (data, callback) {\n              _insert(q, data, false, callback);\n            },\n            unshift: function (data, callback) {\n              _insert(q, data, true, callback);\n            },\n            process: function () {\n                if (workers < q.concurrency && q.tasks.length) {\n                    var task = q.tasks.shift();\n                    if (q.empty && q.tasks.length === 0) {\n                        q.empty();\n                    }\n                    workers += 1;\n                    var next = function () {\n                        workers -= 1;\n                        if (task.callback) {\n                            task.callback.apply(task, arguments);\n                        }\n                        if (q.drain && q.tasks.length + workers === 0) {\n                            q.drain();\n                        }\n                        q.process();\n                    };\n                    var cb = only_once(next);\n                    worker(task.data, cb);\n                }\n            },\n            length: function () {\n                return q.tasks.length;\n            },\n            running: function () {\n                return workers;\n            }\n        };\n        return q;\n    };\n\n    async.cargo = function (worker, payload) {\n        var working     = false,\n            tasks       = [];\n\n        var cargo = {\n            tasks: tasks,\n            payload: payload,\n            saturated: null,\n            empty: null,\n            drain: null,\n            push: function (data, callback) {\n                if(data.constructor !== Array) {\n                    data = [data];\n                }\n                _each(data, function(task) {\n                    tasks.push({\n                        data: task,\n                        callback: typeof callback === 'function' ? callback : null\n                    });\n                    if (cargo.saturated && tasks.length === payload) {\n                        cargo.saturated();\n                    }\n                });\n                async.setImmediate(cargo.process);\n            },\n            process: function process() {\n                if (working) return;\n                if (tasks.length === 0) {\n                    if(cargo.drain) cargo.drain();\n                    return;\n                }\n\n                var ts = typeof payload === 'number'\n                            ? tasks.splice(0, payload)\n                            : tasks.splice(0);\n\n                var ds = _map(ts, function (task) {\n                    return task.data;\n                });\n\n                if(cargo.empty) cargo.empty();\n                working = true;\n                worker(ds, function () {\n                    working = false;\n\n                    var args = arguments;\n                    _each(ts, function (data) {\n                        if (data.callback) {\n                            data.callback.apply(null, args);\n                        }\n                    });\n\n                    process();\n                });\n            },\n            length: function () {\n                return tasks.length;\n            },\n            running: function () {\n                return working;\n            }\n        };\n        return cargo;\n    };\n\n    var _console_fn = function (name) {\n        return function (fn) {\n            var args = Array.prototype.slice.call(arguments, 1);\n            fn.apply(null, args.concat([function (err) {\n                var args = Array.prototype.slice.call(arguments, 1);\n                if (typeof console !== 'undefined') {\n                    if (err) {\n                        if (console.error) {\n                            console.error(err);\n                        }\n                    }\n                    else if (console[name]) {\n                        _each(args, function (x) {\n                            console[name](x);\n                        });\n                    }\n                }\n            }]));\n        };\n    };\n    async.log = _console_fn('log');\n    async.dir = _console_fn('dir');\n    /*async.info = _console_fn('info');\n    async.warn = _console_fn('warn');\n    async.error = _console_fn('error');*/\n\n    async.memoize = function (fn, hasher) {\n        var memo = {};\n        var queues = {};\n        hasher = hasher || function (x) {\n            return x;\n        };\n        var memoized = function () {\n            var args = Array.prototype.slice.call(arguments);\n            var callback = args.pop();\n            var key = hasher.apply(null, args);\n            if (key in memo) {\n                callback.apply(null, memo[key]);\n            }\n            else if (key in queues) {\n                queues[key].push(callback);\n            }\n            else {\n                queues[key] = [callback];\n                fn.apply(null, args.concat([function () {\n                    memo[key] = arguments;\n                    var q = queues[key];\n                    delete queues[key];\n                    for (var i = 0, l = q.length; i < l; i++) {\n                      q[i].apply(null, arguments);\n                    }\n                }]));\n            }\n        };\n        memoized.memo = memo;\n        memoized.unmemoized = fn;\n        return memoized;\n    };\n\n    async.unmemoize = function (fn) {\n      return function () {\n        return (fn.unmemoized || fn).apply(null, arguments);\n      };\n    };\n\n    async.times = function (count, iterator, callback) {\n        var counter = [];\n        for (var i = 0; i < count; i++) {\n            counter.push(i);\n        }\n        return async.map(counter, iterator, callback);\n    };\n\n    async.timesSeries = function (count, iterator, callback) {\n        var counter = [];\n        for (var i = 0; i < count; i++) {\n            counter.push(i);\n        }\n        return async.mapSeries(counter, iterator, callback);\n    };\n\n    async.compose = function (/* functions... */) {\n        var fns = Array.prototype.reverse.call(arguments);\n        return function () {\n            var that = this;\n            var args = Array.prototype.slice.call(arguments);\n            var callback = args.pop();\n            async.reduce(fns, args, function (newargs, fn, cb) {\n                fn.apply(that, newargs.concat([function () {\n                    var err = arguments[0];\n                    var nextargs = Array.prototype.slice.call(arguments, 1);\n                    cb(err, nextargs);\n                }]))\n            },\n            function (err, results) {\n                callback.apply(that, [err].concat(results));\n            });\n        };\n    };\n\n    var _applyEach = function (eachfn, fns /*args...*/) {\n        var go = function () {\n            var that = this;\n            var args = Array.prototype.slice.call(arguments);\n            var callback = args.pop();\n            return eachfn(fns, function (fn, cb) {\n                fn.apply(that, args.concat([cb]));\n            },\n            callback);\n        };\n        if (arguments.length > 2) {\n            var args = Array.prototype.slice.call(arguments, 2);\n            return go.apply(this, args);\n        }\n        else {\n            return go;\n        }\n    };\n    async.applyEach = doParallel(_applyEach);\n    async.applyEachSeries = doSeries(_applyEach);\n\n    async.forever = function (fn, callback) {\n        function next(err) {\n            if (err) {\n                if (callback) {\n                    return callback(err);\n                }\n                throw err;\n            }\n            fn(next);\n        }\n        next();\n    };\n\n    // AMD / RequireJS\n    if (typeof define !== 'undefined' && define.amd) {\n        define([], function () {\n            return async;\n        });\n    }\n    // Node.js\n    else if (typeof module !== 'undefined' && module.exports) {\n        module.exports = async;\n    }\n    // included directly via <script> tag\n    else {\n        root.async = async;\n    }\n\n}());\n","/*---------------------------------------------------------\r\n * Copyright (C) Xored Software Inc. All rights reserved.\r\n * Licensed under the MIT License. See LICENSE in the project root for license information.\r\n *--------------------------------------------------------*/\r\n\r\n'use strict';\r\n\r\nimport vscode = require('vscode');\r\n\r\nexport const NIM_MODE: vscode.DocumentFilter = { language: 'nim', scheme: 'file' };","module.exports = require(\"os\");","/*---------------------------------------------------------\r\n * Copyright (C) Xored Software Inc. All rights reserved.\r\n * Licensed under the MIT License. See LICENSE in the project root for license information.\r\n *--------------------------------------------------------*/\r\n\r\n'use strict';\r\n\r\nimport vscode = require('vscode');\r\nimport cp = require('child_process');\r\nimport fs = require('fs');\r\nimport path = require('path');\r\nimport { getNimExecPath, getProjects, isProjectMode, getNimbleExecPath } from './nimUtils';\r\n\r\nclass NimbleModuleInfo {\r\n    name!: string;\r\n    author?: string;\r\n    description?: string;\r\n    version?: string;\r\n}\r\n\r\nclass NimModuleInfo {\r\n    name!: string;\r\n    fullName!: string;\r\n    path!: string;\r\n}\r\n\r\nvar nimbleModules: NimbleModuleInfo[] = [];\r\nvar nimModules: { [project: string]: NimModuleInfo[] } = {};\r\n\r\nfunction getNimDirectories(projectDir: string, projectFile: string): Promise<string[]> {\r\n    return new Promise<string[]>((resolve, reject) => {\r\n        cp.exec(getNimExecPath() + ' dump ' + projectFile, { cwd: projectDir },\r\n            (error, stdout: string, stderr: string) => {\r\n                var res: string[] = [];\r\n                let parts = stderr.split('\\n');\r\n                for (const part of parts) {\r\n                    let p = part.trim();\r\n                    if (p.indexOf('Hint: ') !== 0 && p.length > 0) {\r\n                        res.push(p);\r\n                    }\r\n                }\r\n                resolve(res);\r\n            }\r\n        );\r\n    });\r\n}\r\n\r\nfunction createNimModule(projectDir: string, rootDir: string, dir: string, file: string): NimModuleInfo {\r\n    let fullPath = path.join(dir, file);\r\n    var nimModule = new NimModuleInfo();\r\n    nimModule.name = file.substr(0, file.length - 4);\r\n    if (dir.length > rootDir.length) {\r\n        let moduleDir = dir.substr(rootDir.length + 1).replace(path.sep, '.');\r\n        nimModule.fullName = moduleDir + '.' + nimModule.name;\r\n    } else {\r\n        nimModule.fullName = nimModule.name;\r\n    }\r\n    nimModule.path = fullPath;\r\n    return nimModule;\r\n}\r\n\r\nfunction walkDir(projectDir: string, rootDir: string, dir: string, singlePass: boolean) {\r\n    fs.readdir(dir, (err, files) => {\r\n        if (files) {\r\n            for (const file of files) {\r\n                let fullPath = path.join(dir, file);\r\n                if (fs.statSync(fullPath).isDirectory()) {\r\n                    if (!singlePass) {\r\n                        walkDir(projectDir, rootDir, fullPath, false);\r\n                    }\r\n                } else if (file.toLowerCase().endsWith('.nim')) {\r\n                    nimModules[projectDir].push(createNimModule(projectDir, rootDir, dir, file));\r\n                }\r\n            }\r\n        }\r\n    });\r\n}\r\n\r\nasync function initNimDirectories(projectDir: string, projectFile: string) {\r\n    if (!nimModules[projectDir]) {\r\n        nimModules[projectDir] = [];\r\n        let nimDirectories = await getNimDirectories(projectDir, projectFile);\r\n        let nimRoot = path.dirname(path.dirname(getNimExecPath()));\r\n        for (const dirPath of nimDirectories) {\r\n            walkDir(projectDir, dirPath, dirPath, dirPath.startsWith(nimRoot));\r\n        }\r\n    }\r\n}\r\n\r\nfunction getNimbleModules(rootDir: string): Promise<string[]> {\r\n    return new Promise<string[]>((resolve, reject) => {\r\n        cp.exec(getNimbleExecPath() + ' list -i', { cwd: rootDir },\r\n            (error, stdout: string, stderr: string) => {\r\n                var res: string[] = [];\r\n                let parts = stdout.split('\\n');\r\n                for (const part of parts) {\r\n                    let p = part.split('[')[0].trim();\r\n                    if (p.length > 0 && p !== 'compiler') {\r\n                        res.push(p);\r\n                    }\r\n                }\r\n                resolve(res);\r\n            }\r\n        );\r\n    });\r\n}\r\n\r\nasync function initNimbleModules(rootDir: string) {\r\n    let nimbleModuleNames = await getNimbleModules(rootDir);\r\n    for (const moduleName of nimbleModuleNames) {\r\n        try {\r\n            let out = cp.execSync(getNimbleExecPath() + ' --y dump ' + moduleName, { cwd: rootDir }).toString();\r\n            var nimbleModule = new NimbleModuleInfo();\r\n            nimbleModule.name = moduleName;\r\n            for (const line of out.split(/\\n/)) {\r\n                let pairs = line.trim().split(': \"');\r\n                if (pairs.length === 2) {\r\n                    let value = pairs[1].substring(0, pairs[1].length - 1);\r\n                    if (pairs[0] === 'author') {\r\n                        nimbleModule.author = value;\r\n                    } else if (pairs[0] === 'version') {\r\n                        nimbleModule.version = value;\r\n                    } else if (pairs[0] === 'desc') {\r\n                        nimbleModule.description = value;\r\n                    }\r\n                }\r\n            }\r\n            nimbleModules.push(nimbleModule);\r\n        } catch {\r\n            console.log('Module incorrect ' + moduleName);\r\n        }\r\n    }\r\n}\r\n\r\nexport function getImports(prefix: string | undefined, projectDir: string): vscode.CompletionItem[] {\r\n    var suggestions: vscode.CompletionItem[] = [];\r\n    for (const nimbleModule of nimbleModules) {\r\n        if (!prefix || nimbleModule.name.startsWith(prefix)) {\r\n            var suggestion = new vscode.CompletionItem(nimbleModule.name);\r\n            suggestion.kind = vscode.CompletionItemKind.Module;\r\n            if (nimbleModule.version) {\r\n                suggestion.detail = nimbleModule.name + ' [' + nimbleModule.version + ']';\r\n            } else {\r\n                suggestion.detail = nimbleModule.name;\r\n            }\r\n            suggestion.detail += ' (Nimble)';\r\n            var doc = '**Name**: ' + nimbleModule.name;\r\n            if (nimbleModule.version) {\r\n                doc += '\\n\\n**Version**: ' + nimbleModule.version;\r\n            }\r\n            if (nimbleModule.author) {\r\n                doc += '\\n\\n**Author**: ' + nimbleModule.author;\r\n            }\r\n            if (nimbleModule.description) {\r\n                doc += '\\n\\n**Description**: ' + nimbleModule.description;\r\n            }\r\n            suggestion.documentation = new vscode.MarkdownString(doc);\r\n            suggestions.push(suggestion);\r\n        }\r\n        if (suggestions.length >= 20) {\r\n            return suggestions;\r\n        }\r\n    }\r\n    if (nimModules[projectDir]) {\r\n        for (const nimModule of nimModules[projectDir]) {\r\n            if (!prefix || nimModule.name.startsWith(prefix)) {\r\n                var suggest = new vscode.CompletionItem(nimModule.name);\r\n                suggest.kind = vscode.CompletionItemKind.Module;\r\n                suggest.insertText = nimModule.fullName;\r\n                suggest.detail = nimModule.fullName;\r\n                suggest.documentation = nimModule.path;\r\n                suggestions.push(suggest);\r\n            }\r\n            if (suggestions.length >= 100) {\r\n                return suggestions;\r\n            }\r\n        }\r\n    }\r\n    return suggestions;\r\n}\r\n\r\nexport async function initImports() {\r\n    if (vscode.workspace.workspaceFolders) {\r\n        await await initNimbleModules(vscode.workspace.workspaceFolders[0].uri.fsPath);\r\n    }\r\n\r\n    if (isProjectMode()) {\r\n        for (const project of getProjects()) {\r\n            await initNimDirectories(project.wsFolder.uri.fsPath, project.filePath);\r\n        }\r\n    } else {\r\n        if (vscode.workspace.workspaceFolders) {\r\n            await initNimDirectories(vscode.workspace.workspaceFolders[0].uri.fsPath, '');\r\n        }\r\n    }\r\n}\r\n\r\nexport async function addFileToImports(file: string) {\r\n    if (isProjectMode()) {\r\n        for (const project of getProjects()) {\r\n            let projectDir = project.wsFolder.uri.fsPath;\r\n            if (file.startsWith(projectDir)) {\r\n                if (!nimModules[projectDir]) {\r\n                    nimModules[projectDir] = [];\r\n                }\r\n                nimModules[projectDir].push(createNimModule(projectDir, projectDir, path.dirname(file), path.basename(file)));\r\n            }\r\n        }\r\n    } else {\r\n        if (vscode.workspace.workspaceFolders) {\r\n            let projectDir = vscode.workspace.workspaceFolders[0].uri.fsPath;\r\n            if (!nimModules[projectDir]) {\r\n                nimModules[projectDir] = [];\r\n            }\r\n            nimModules[projectDir].push(createNimModule(projectDir, projectDir, path.dirname(file), path.basename(file)));\r\n        }\r\n    }\r\n}\r\n\r\nexport async function removeFileFromImports(file: string) {\r\n    for (const key in nimModules) {\r\n        const items = nimModules[key];\r\n        var i = 0;\r\n        while (i < items.length) {\r\n            if (items[i].path === file) {\r\n                items.splice(i);\r\n            } else {\r\n                i++;\r\n            }\r\n        }\r\n    }\r\n}","/*---------------------------------------------------------\r\n * Copyright (C) Xored Software Inc. All rights reserved.\r\n * Licensed under the MIT License. See LICENSE in the project root for license information.\r\n *--------------------------------------------------------*/\r\n\r\n'use strict';\r\n\r\nimport vscode = require('vscode');\r\nimport Datastore = require('nedb');\r\nimport path = require('path');\r\nimport fs = require('fs');\r\n\r\nimport { getNimSuggestPath, execNimSuggest, NimSuggestType } from './nimSuggestExec';\r\nimport { showNimProgress, hideNimProgress, updateNimProgress } from './nimStatus';\r\n\r\nlet dbVersion: number = 4;\r\n\r\nvar dbFiles: Datastore;\r\nvar dbTypes: Datastore;\r\n\r\n/**\r\n * Returns workspace path from lowercase version of worspace path.\r\n * It is required for pathes in different cases,\r\n * because nim compiler on windows system returns all pathes converted in lowercase.\r\n * @param file lowercase workspace path\r\n */\r\nexport function addWorkspaceFile(file: string): void {\r\n    indexFile(file);\r\n}\r\n\r\nexport function removeWorkspaceFile(file: string): void {\r\n    removeFromIndex(file);\r\n}\r\n\r\nexport function changeWorkspaceFile(file: string): void {\r\n    indexFile(file);\r\n}\r\n\r\nexport async function initWorkspace(extensionPath: string): Promise<void> {\r\n    // remove old version of indexes\r\n    cleanOldDb(extensionPath, 'files');\r\n    cleanOldDb(extensionPath, 'types');\r\n\r\n    dbTypes = new Datastore({ filename: path.join(extensionPath, getDbName('types', dbVersion)), autoload: true });\r\n    dbTypes.persistence.setAutocompactionInterval(600000); // compact each 10 munites\r\n    dbTypes.ensureIndex({ fieldName: 'workspace' });\r\n    dbTypes.ensureIndex({ fieldName: 'file' });\r\n    dbTypes.ensureIndex({ fieldName: 'timestamp' });\r\n    dbTypes.ensureIndex({ fieldName: 'type' });\r\n\r\n    dbFiles = new Datastore({ filename: path.join(extensionPath, getDbName('files', dbVersion)), autoload: true });\r\n    dbFiles.persistence.setAutocompactionInterval(600000); // compact each 10 munites\r\n    dbFiles.ensureIndex({ fieldName: 'file' });\r\n    dbFiles.ensureIndex({ fieldName: 'timestamp' });\r\n\r\n    if (!getNimSuggestPath()) {\r\n        return;\r\n    }\r\n\r\n    let urls = await vscode.workspace.findFiles('**/*.nim', '');\r\n\r\n    showNimProgress(`Indexing: ${urls.length}`);\r\n    for (var i = 0; i < urls.length; i++) {\r\n        let url = urls[i];\r\n        let file = url.fsPath;\r\n        let cnt = urls.length - i;\r\n\r\n        if (cnt % 10 === 0) {\r\n            updateNimProgress(`Indexing: ${cnt} of ${urls.length}`);\r\n        }\r\n\r\n        await indexFile(file);\r\n    }\r\n    hideNimProgress();\r\n}\r\n\r\nexport function findWorkspaceSymbols(query: string): Promise<vscode.SymbolInformation[]> {\r\n    return new Promise<vscode.SymbolInformation[]>((resolve, reject) => {\r\n        try {\r\n            let reg = new RegExp(query, 'i');\r\n            dbTypes.find<any>({ ws: vscode.workspace.rootPath, type: reg }).limit(100).exec((err, docs) => {\r\n                let symbols: vscode.SymbolInformation[] = [];\r\n                docs.forEach(doc => {\r\n                    symbols.push(\r\n                        new vscode.SymbolInformation(\r\n                            doc.type, doc.kind,\r\n                            new vscode.Range(new vscode.Position(doc.range_start._line, doc.range_start._character),\r\n                                new vscode.Position(doc.range_end._line, doc.range_end._character)),\r\n                            vscode.Uri.file(doc.file), doc.container));\r\n                });\r\n                resolve(symbols);\r\n            });\r\n        } catch (e) {\r\n            resolve([]);\r\n        }\r\n    });\r\n}\r\n\r\nexport function getFileSymbols(file: string, dirtyFile?: string): Promise<vscode.SymbolInformation[]> {\r\n    return new Promise<vscode.SymbolInformation[]>((resolve, reject) => {\r\n        execNimSuggest(NimSuggestType.outline, file, 0, 0, dirtyFile)\r\n            .then(result => {\r\n                var symbols: vscode.SymbolInformation[] = [];\r\n                var exists: string[] = [];\r\n                if (result) {\r\n                    result.forEach(item => {\r\n\r\n                        // skip let and var in proc and methods\r\n                        if ((item.suggest === 'skLet' || item.suggest === 'skVar') && item.containerName.indexOf('.') > 0) {\r\n                            return;\r\n                        }\r\n\r\n                        if (exists.indexOf(item.column + ':' + item.line) === -1) {\r\n                            exists.push(item.column + ':' + item.line);\r\n                            let symbolInfo = new vscode.SymbolInformation(\r\n                                item.symbolName, vscodeKindFromNimSym(item.suggest),\r\n                                item.range, item.uri, item.containerName);\r\n                            symbols.push(symbolInfo);\r\n                        }\r\n                    });\r\n                }\r\n\r\n                resolve(symbols);\r\n            })\r\n            .catch(reason => reject(reason));\r\n    });\r\n}\r\n\r\nasync function findFile(file: string, timestamp: number): Promise<any> {\r\n    return new Promise<any>((resolve, reject) => {\r\n        dbFiles.findOne({ file: file, timestamp: timestamp }, function (err, doc) { resolve(doc); });\r\n    });\r\n}\r\n\r\nasync function indexFile(file: string): Promise<void> {\r\n    let timestamp = fs.statSync(file).mtime.getTime();\r\n    let doc = await findFile(file, timestamp);\r\n    if (!doc) {\r\n        // console.log(\"index: \" + file);\r\n        let infos = await getFileSymbols(file, '');\r\n        if (infos && infos.length > 0) {\r\n            dbFiles.remove({ file: file }, { multi: true }, (err, n) => {\r\n                dbFiles.insert({ file: file, timestamp: timestamp });\r\n            });\r\n            dbTypes.remove({ file: file }, { multi: true }, (err, n) => {\r\n                infos.forEach((value) => {\r\n                    dbTypes.insert({\r\n                        ws: vscode.workspace.rootPath,\r\n                        file: value.location.uri.fsPath,\r\n                        range_start: value.location.range.start,\r\n                        range_end: value.location.range.end,\r\n                        type: value.name,\r\n                        container: value.containerName,\r\n                        kind: value.kind\r\n                    });\r\n                });\r\n            });\r\n        }\r\n    }\r\n    return;\r\n}\r\n\r\nfunction vscodeKindFromNimSym(kind: string): vscode.SymbolKind {\r\n    switch (kind) {\r\n        case 'skConst':\r\n            return vscode.SymbolKind.Constant;\r\n        case 'skEnumField':\r\n            return vscode.SymbolKind.Enum;\r\n        case 'skForVar':\r\n            return vscode.SymbolKind.Variable;\r\n        case 'skIterator':\r\n            return vscode.SymbolKind.Array;\r\n        case 'skLabel':\r\n            return vscode.SymbolKind.String;\r\n        case 'skLet':\r\n            return vscode.SymbolKind.Variable;\r\n        case 'skMacro':\r\n            return vscode.SymbolKind.Function;\r\n        case 'skMethod':\r\n            return vscode.SymbolKind.Method;\r\n        case 'skParam':\r\n            return vscode.SymbolKind.Variable;\r\n        case 'skProc':\r\n            return vscode.SymbolKind.Function;\r\n        case 'skResult':\r\n            return vscode.SymbolKind.Function;\r\n        case 'skTemplate':\r\n            return vscode.SymbolKind.Interface;\r\n        case 'skType':\r\n            return vscode.SymbolKind.Class;\r\n        case 'skVar':\r\n            return vscode.SymbolKind.Variable;\r\n        case 'skFunc':\r\n            return vscode.SymbolKind.Function;\r\n    }\r\n    return vscode.SymbolKind.Property;\r\n}\r\n\r\nfunction removeFromIndex(file: string): void {\r\n    dbFiles.remove({ file: file }, { multi: true }, function (err, doc) {\r\n        dbTypes.remove({ file: file }, { multi: true });\r\n    });\r\n}\r\n\r\nfunction cleanOldDb(basePath: string, name: string): void {\r\n    let dbPath = path.join(basePath, `${name}.db`);\r\n    if (fs.existsSync(dbPath)) {\r\n        fs.unlinkSync(dbPath);\r\n    }\r\n    for (var i = 0; i < dbVersion; ++i) {\r\n        let dbPath = path.join(basePath, getDbName(name, i));\r\n        if (fs.existsSync(dbPath)) {\r\n            fs.unlinkSync(dbPath);\r\n        }\r\n    }\r\n}\r\n\r\nfunction getDbName(name: string, version: number): string {\r\n    return `${name}_${version}.db`;\r\n}\r\n","var crypto = require('crypto')\n  ;\n\n/**\n * Return a random alphanumerical string of length len\n * There is a very small probability (less than 1/1,000,000) for the length to be less than len\n * (il the base64 conversion yields too many pluses and slashes) but\n * that's not an issue here\n * The probability of a collision is extremely small (need 3*10^12 documents to have one chance in a million of a collision)\n * See http://en.wikipedia.org/wiki/Birthday_problem\n */\nfunction uid (len) {\n  return crypto.randomBytes(Math.ceil(Math.max(8, len * 2)))\n    .toString('base64')\n    .replace(/[+\\/]/g, '')\n    .slice(0, len);\n}\n\n\n// Interface\nmodule.exports.uid = uid;\n\n","var BinarySearchTree = require('binary-search-tree').AVLTree\n  , model = require('./model')\n  , _ = require('underscore')\n  , util = require('util')\n  ;\n\n/**\n * Two indexed pointers are equal iif they point to the same place\n */\nfunction checkValueEquality (a, b) {\n  return a === b;\n}\n\n/**\n * Type-aware projection\n */\nfunction projectForUnique (elt) {\n  if (elt === null) { return '$null'; }\n  if (typeof elt === 'string') { return '$string' + elt; }\n  if (typeof elt === 'boolean') { return '$boolean' + elt; }\n  if (typeof elt === 'number') { return '$number' + elt; }\n  if (util.isArray(elt)) { return '$date' + elt.getTime(); }\n\n  return elt;   // Arrays and objects, will check for pointer equality\n}\n\n\n/**\n * Create a new index\n * All methods on an index guarantee that either the whole operation was successful and the index changed\n * or the operation was unsuccessful and an error is thrown while the index is unchanged\n * @param {String} options.fieldName On which field should the index apply (can use dot notation to index on sub fields)\n * @param {Boolean} options.unique Optional, enforce a unique constraint (default: false)\n * @param {Boolean} options.sparse Optional, allow a sparse index (we can have documents for which fieldName is undefined) (default: false)\n */\nfunction Index (options) {\n  this.fieldName = options.fieldName;\n  this.unique = options.unique || false;\n  this.sparse = options.sparse || false;\n\n  this.treeOptions = { unique: this.unique, compareKeys: model.compareThings, checkValueEquality: checkValueEquality };\n\n  this.reset();   // No data in the beginning\n}\n\n\n/**\n * Reset an index\n * @param {Document or Array of documents} newData Optional, data to initialize the index with\n *                                                 If an error is thrown during insertion, the index is not modified\n */\nIndex.prototype.reset = function (newData) {\n  this.tree = new BinarySearchTree(this.treeOptions);\n\n  if (newData) { this.insert(newData); }\n};\n\n\n/**\n * Insert a new document in the index\n * If an array is passed, we insert all its elements (if one insertion fails the index is not modified)\n * O(log(n))\n */\nIndex.prototype.insert = function (doc) {\n  var key, self = this\n    , keys, i, failingI, error\n    ;\n\n  if (util.isArray(doc)) { this.insertMultipleDocs(doc); return; }\n\n  key = model.getDotValue(doc, this.fieldName);\n\n  // We don't index documents that don't contain the field if the index is sparse\n  if (key === undefined && this.sparse) { return; }\n\n  if (!util.isArray(key)) {\n    this.tree.insert(key, doc);\n  } else {\n    // If an insert fails due to a unique constraint, roll back all inserts before it\n    keys = _.uniq(key, projectForUnique);\n\n    for (i = 0; i < keys.length; i += 1) {\n      try {\n        this.tree.insert(keys[i], doc);\n      } catch (e) {\n        error = e;\n        failingI = i;\n        break;\n      }\n    }\n\n    if (error) {\n      for (i = 0; i < failingI; i += 1) {\n        this.tree.delete(keys[i], doc);\n      }\n\n      throw error;\n    }\n  }\n};\n\n\n/**\n * Insert an array of documents in the index\n * If a constraint is violated, the changes should be rolled back and an error thrown\n *\n * @API private\n */\nIndex.prototype.insertMultipleDocs = function (docs) {\n  var i, error, failingI;\n\n  for (i = 0; i < docs.length; i += 1) {\n    try {\n      this.insert(docs[i]);\n    } catch (e) {\n      error = e;\n      failingI = i;\n      break;\n    }\n  }\n\n  if (error) {\n    for (i = 0; i < failingI; i += 1) {\n      this.remove(docs[i]);\n    }\n\n    throw error;\n  }\n};\n\n\n/**\n * Remove a document from the index\n * If an array is passed, we remove all its elements\n * The remove operation is safe with regards to the 'unique' constraint\n * O(log(n))\n */\nIndex.prototype.remove = function (doc) {\n  var key, self = this;\n\n  if (util.isArray(doc)) { doc.forEach(function (d) { self.remove(d); }); return; }\n\n  key = model.getDotValue(doc, this.fieldName);\n\n  if (key === undefined && this.sparse) { return; }\n\n  if (!util.isArray(key)) {\n    this.tree.delete(key, doc);\n  } else {\n    _.uniq(key, projectForUnique).forEach(function (_key) {\n      self.tree.delete(_key, doc);\n    });\n  }\n};\n\n\n/**\n * Update a document in the index\n * If a constraint is violated, changes are rolled back and an error thrown\n * Naive implementation, still in O(log(n))\n */\nIndex.prototype.update = function (oldDoc, newDoc) {\n  if (util.isArray(oldDoc)) { this.updateMultipleDocs(oldDoc); return; }\n\n  this.remove(oldDoc);\n\n  try {\n    this.insert(newDoc);\n  } catch (e) {\n    this.insert(oldDoc);\n    throw e;\n  }\n};\n\n\n/**\n * Update multiple documents in the index\n * If a constraint is violated, the changes need to be rolled back\n * and an error thrown\n * @param {Array of oldDoc, newDoc pairs} pairs\n *\n * @API private\n */\nIndex.prototype.updateMultipleDocs = function (pairs) {\n  var i, failingI, error;\n\n  for (i = 0; i < pairs.length; i += 1) {\n    this.remove(pairs[i].oldDoc);\n  }\n\n  for (i = 0; i < pairs.length; i += 1) {\n    try {\n      this.insert(pairs[i].newDoc);\n    } catch (e) {\n      error = e;\n      failingI = i;\n      break;\n    }\n  }\n\n  // If an error was raised, roll back changes in the inverse order\n  if (error) {\n    for (i = 0; i < failingI; i += 1) {\n      this.remove(pairs[i].newDoc);\n    }\n\n    for (i = 0; i < pairs.length; i += 1) {\n      this.insert(pairs[i].oldDoc);\n    }\n\n    throw error;\n  }\n};\n\n\n/**\n * Revert an update\n */\nIndex.prototype.revertUpdate = function (oldDoc, newDoc) {\n  var revert = [];\n\n  if (!util.isArray(oldDoc)) {\n    this.update(newDoc, oldDoc);\n  } else {\n    oldDoc.forEach(function (pair) {\n      revert.push({ oldDoc: pair.newDoc, newDoc: pair.oldDoc });\n    });\n    this.update(revert);\n  }\n};\n\n\n/**\n * Get all documents in index whose key match value (if it is a Thing) or one of the elements of value (if it is an array of Things)\n * @param {Thing} value Value to match the key against\n * @return {Array of documents}\n */\nIndex.prototype.getMatching = function (value) {\n  var self = this;\n\n  if (!util.isArray(value)) {\n    return self.tree.search(value);\n  } else {\n    var _res = {}, res = [];\n\n    value.forEach(function (v) {\n      self.getMatching(v).forEach(function (doc) {\n        _res[doc._id] = doc;\n      });\n    });\n\n    Object.keys(_res).forEach(function (_id) {\n      res.push(_res[_id]);\n    });\n\n    return res;\n  }\n};\n\n\n/**\n * Get all documents in index whose key is between bounds are they are defined by query\n * Documents are sorted by key\n * @param {Query} query\n * @return {Array of documents}\n */\nIndex.prototype.getBetweenBounds = function (query) {\n  return this.tree.betweenBounds(query);\n};\n\n\n/**\n * Get all elements in the index\n * @return {Array of documents}\n */\nIndex.prototype.getAll = function () {\n  var res = [];\n\n  this.tree.executeOnEveryNode(function (node) {\n    var i;\n\n    for (i = 0; i < node.data.length; i += 1) {\n      res.push(node.data[i]);\n    }\n  });\n\n  return res;\n};\n\n\n\n\n// Interface\nmodule.exports = Index;\n","/**\n * Simple binary search tree\n */\nvar customUtils = require('./customUtils');\n\n\n/**\n * Constructor\n * @param {Object} options Optional\n * @param {Boolean}  options.unique Whether to enforce a 'unique' constraint on the key or not\n * @param {Key}      options.key Initialize this BST's key with key\n * @param {Value}    options.value Initialize this BST's data with [value]\n * @param {Function} options.compareKeys Initialize this BST's compareKeys\n */\nfunction BinarySearchTree (options) {\n  options = options || {};\n\n  this.left = null;\n  this.right = null;\n  this.parent = options.parent !== undefined ? options.parent : null;\n  if (options.hasOwnProperty('key')) { this.key = options.key; }\n  this.data = options.hasOwnProperty('value') ? [options.value] : [];\n  this.unique = options.unique || false;\n\n  this.compareKeys = options.compareKeys || customUtils.defaultCompareKeysFunction;\n  this.checkValueEquality = options.checkValueEquality || customUtils.defaultCheckValueEquality;\n}\n\n\n// ================================\n// Methods used to test the tree\n// ================================\n\n\n/**\n * Get the descendant with max key\n */\nBinarySearchTree.prototype.getMaxKeyDescendant = function () {\n  if (this.right) {\n    return this.right.getMaxKeyDescendant();\n  } else {\n    return this;\n  }\n};\n\n\n/**\n * Get the maximum key\n */\nBinarySearchTree.prototype.getMaxKey = function () {\n  return this.getMaxKeyDescendant().key;\n};\n\n\n/**\n * Get the descendant with min key\n */\nBinarySearchTree.prototype.getMinKeyDescendant = function () {\n  if (this.left) {\n    return this.left.getMinKeyDescendant()\n  } else {\n    return this;\n  }\n};\n\n\n/**\n * Get the minimum key\n */\nBinarySearchTree.prototype.getMinKey = function () {\n  return this.getMinKeyDescendant().key;\n};\n\n\n/**\n * Check that all nodes (incl. leaves) fullfil condition given by fn\n * test is a function passed every (key, data) and which throws if the condition is not met\n */\nBinarySearchTree.prototype.checkAllNodesFullfillCondition = function (test) {\n  if (!this.hasOwnProperty('key')) { return; }\n\n  test(this.key, this.data);\n  if (this.left) { this.left.checkAllNodesFullfillCondition(test); }\n  if (this.right) { this.right.checkAllNodesFullfillCondition(test); }\n};\n\n\n/**\n * Check that the core BST properties on node ordering are verified\n * Throw if they aren't\n */\nBinarySearchTree.prototype.checkNodeOrdering = function () {\n  var self = this;\n\n  if (!this.hasOwnProperty('key')) { return; }\n\n  if (this.left) {\n    this.left.checkAllNodesFullfillCondition(function (k) {\n      if (self.compareKeys(k, self.key) >= 0) {\n        throw new Error('Tree with root ' + self.key + ' is not a binary search tree');\n      }\n    });\n    this.left.checkNodeOrdering();\n  }\n\n  if (this.right) {\n    this.right.checkAllNodesFullfillCondition(function (k) {\n      if (self.compareKeys(k, self.key) <= 0) {\n        throw new Error('Tree with root ' + self.key + ' is not a binary search tree');\n      }\n    });\n    this.right.checkNodeOrdering();\n  }\n};\n\n\n/**\n * Check that all pointers are coherent in this tree\n */\nBinarySearchTree.prototype.checkInternalPointers = function () {\n  if (this.left) {\n    if (this.left.parent !== this) { throw new Error('Parent pointer broken for key ' + this.key); }\n    this.left.checkInternalPointers();\n  }\n\n  if (this.right) {\n    if (this.right.parent !== this) { throw new Error('Parent pointer broken for key ' + this.key); }\n    this.right.checkInternalPointers();\n  }\n};\n\n\n/**\n * Check that a tree is a BST as defined here (node ordering and pointer references)\n */\nBinarySearchTree.prototype.checkIsBST = function () {\n  this.checkNodeOrdering();\n  this.checkInternalPointers();\n  if (this.parent) { throw new Error(\"The root shouldn't have a parent\"); }\n};\n\n\n/**\n * Get number of keys inserted\n */\nBinarySearchTree.prototype.getNumberOfKeys = function () {\n  var res;\n\n  if (!this.hasOwnProperty('key')) { return 0; }\n\n  res = 1;\n  if (this.left) { res += this.left.getNumberOfKeys(); }\n  if (this.right) { res += this.right.getNumberOfKeys(); }\n\n  return res;\n};\n\n\n\n// ============================================\n// Methods used to actually work on the tree\n// ============================================\n\n/**\n * Create a BST similar (i.e. same options except for key and value) to the current one\n * Use the same constructor (i.e. BinarySearchTree, AVLTree etc)\n * @param {Object} options see constructor\n */\nBinarySearchTree.prototype.createSimilar = function (options) {\n  options = options || {};\n  options.unique = this.unique;\n  options.compareKeys = this.compareKeys;\n  options.checkValueEquality = this.checkValueEquality;\n\n  return new this.constructor(options);\n};\n\n\n/**\n * Create the left child of this BST and return it\n */\nBinarySearchTree.prototype.createLeftChild = function (options) {\n  var leftChild = this.createSimilar(options);\n  leftChild.parent = this;\n  this.left = leftChild;\n\n  return leftChild;\n};\n\n\n/**\n * Create the right child of this BST and return it\n */\nBinarySearchTree.prototype.createRightChild = function (options) {\n  var rightChild = this.createSimilar(options);\n  rightChild.parent = this;\n  this.right = rightChild;\n\n  return rightChild;\n};\n\n\n/**\n * Insert a new element\n */\nBinarySearchTree.prototype.insert = function (key, value) {\n  // Empty tree, insert as root\n  if (!this.hasOwnProperty('key')) {\n    this.key = key;\n    this.data.push(value);\n    return;\n  }\n\n  // Same key as root\n  if (this.compareKeys(this.key, key) === 0) {\n    if (this.unique) {\n      var err = new Error(\"Can't insert key \" + key + \", it violates the unique constraint\");\n      err.key = key;\n      err.errorType = 'uniqueViolated';\n      throw err;\n    } else {\n      this.data.push(value);\n    }\n    return;\n  }\n\n  if (this.compareKeys(key, this.key) < 0) {\n    // Insert in left subtree\n    if (this.left) {\n      this.left.insert(key, value);\n    } else {\n      this.createLeftChild({ key: key, value: value });\n    }\n  } else {\n    // Insert in right subtree\n    if (this.right) {\n      this.right.insert(key, value);\n    } else {\n      this.createRightChild({ key: key, value: value });\n    }\n  }\n};\n\n\n/**\n * Search for all data corresponding to a key\n */\nBinarySearchTree.prototype.search = function (key) {\n  if (!this.hasOwnProperty('key')) { return []; }\n\n  if (this.compareKeys(this.key, key) === 0) { return this.data; }\n\n  if (this.compareKeys(key, this.key) < 0) {\n    if (this.left) {\n      return this.left.search(key);\n    } else {\n      return [];\n    }\n  } else {\n    if (this.right) {\n      return this.right.search(key);\n    } else {\n      return [];\n    }\n  }\n};\n\n\n/**\n * Return a function that tells whether a given key matches a lower bound\n */\nBinarySearchTree.prototype.getLowerBoundMatcher = function (query) {\n  var self = this;\n\n  // No lower bound\n  if (!query.hasOwnProperty('$gt') && !query.hasOwnProperty('$gte')) {\n    return function () { return true; };\n  }\n\n  if (query.hasOwnProperty('$gt') && query.hasOwnProperty('$gte')) {\n    if (self.compareKeys(query.$gte, query.$gt) === 0) {\n      return function (key) { return self.compareKeys(key, query.$gt) > 0; };\n    }\n\n    if (self.compareKeys(query.$gte, query.$gt) > 0) {\n      return function (key) { return self.compareKeys(key, query.$gte) >= 0; };\n    } else {\n      return function (key) { return self.compareKeys(key, query.$gt) > 0; };\n    }\n  }\n\n  if (query.hasOwnProperty('$gt')) {\n    return function (key) { return self.compareKeys(key, query.$gt) > 0; };\n  } else {\n    return function (key) { return self.compareKeys(key, query.$gte) >= 0; };\n  }\n};\n\n\n/**\n * Return a function that tells whether a given key matches an upper bound\n */\nBinarySearchTree.prototype.getUpperBoundMatcher = function (query) {\n  var self = this;\n\n  // No lower bound\n  if (!query.hasOwnProperty('$lt') && !query.hasOwnProperty('$lte')) {\n    return function () { return true; };\n  }\n\n  if (query.hasOwnProperty('$lt') && query.hasOwnProperty('$lte')) {\n    if (self.compareKeys(query.$lte, query.$lt) === 0) {\n      return function (key) { return self.compareKeys(key, query.$lt) < 0; };\n    }\n\n    if (self.compareKeys(query.$lte, query.$lt) < 0) {\n      return function (key) { return self.compareKeys(key, query.$lte) <= 0; };\n    } else {\n      return function (key) { return self.compareKeys(key, query.$lt) < 0; };\n    }\n  }\n\n  if (query.hasOwnProperty('$lt')) {\n    return function (key) { return self.compareKeys(key, query.$lt) < 0; };\n  } else {\n    return function (key) { return self.compareKeys(key, query.$lte) <= 0; };\n  }\n};\n\n\n// Append all elements in toAppend to array\nfunction append (array, toAppend) {\n  var i;\n\n  for (i = 0; i < toAppend.length; i += 1) {\n    array.push(toAppend[i]);\n  }\n}\n\n\n/**\n * Get all data for a key between bounds\n * Return it in key order\n * @param {Object} query Mongo-style query where keys are $lt, $lte, $gt or $gte (other keys are not considered)\n * @param {Functions} lbm/ubm matching functions calculated at the first recursive step\n */\nBinarySearchTree.prototype.betweenBounds = function (query, lbm, ubm) {\n  var res = [];\n\n  if (!this.hasOwnProperty('key')) { return []; }   // Empty tree\n\n  lbm = lbm || this.getLowerBoundMatcher(query);\n  ubm = ubm || this.getUpperBoundMatcher(query);\n\n  if (lbm(this.key) && this.left) { append(res, this.left.betweenBounds(query, lbm, ubm)); }\n  if (lbm(this.key) && ubm(this.key)) { append(res, this.data); }\n  if (ubm(this.key) && this.right) { append(res, this.right.betweenBounds(query, lbm, ubm)); }\n\n  return res;\n};\n\n\n/**\n * Delete the current node if it is a leaf\n * Return true if it was deleted\n */\nBinarySearchTree.prototype.deleteIfLeaf = function () {\n  if (this.left || this.right) { return false; }\n\n  // The leaf is itself a root\n  if (!this.parent) {\n    delete this.key;\n    this.data = [];\n    return true;\n  }\n\n  if (this.parent.left === this) {\n    this.parent.left = null;\n  } else {\n    this.parent.right = null;\n  }\n\n  return true;\n};\n\n\n/**\n * Delete the current node if it has only one child\n * Return true if it was deleted\n */\nBinarySearchTree.prototype.deleteIfOnlyOneChild = function () {\n  var child;\n\n  if (this.left && !this.right) { child = this.left; }\n  if (!this.left && this.right) { child = this.right; }\n  if (!child) { return false; }\n\n  // Root\n  if (!this.parent) {\n    this.key = child.key;\n    this.data = child.data;\n\n    this.left = null;\n    if (child.left) {\n      this.left = child.left;\n      child.left.parent = this;\n    }\n\n    this.right = null;\n    if (child.right) {\n      this.right = child.right;\n      child.right.parent = this;\n    }\n\n    return true;\n  }\n\n  if (this.parent.left === this) {\n    this.parent.left = child;\n    child.parent = this.parent;\n  } else {\n    this.parent.right = child;\n    child.parent = this.parent;\n  }\n\n  return true;\n};\n\n\n/**\n * Delete a key or just a value\n * @param {Key} key\n * @param {Value} value Optional. If not set, the whole key is deleted. If set, only this value is deleted\n */\nBinarySearchTree.prototype.delete = function (key, value) {\n  var newData = [], replaceWith\n    , self = this\n    ;\n\n  if (!this.hasOwnProperty('key')) { return; }\n\n  if (this.compareKeys(key, this.key) < 0) {\n    if (this.left) { this.left.delete(key, value); }\n    return;\n  }\n\n  if (this.compareKeys(key, this.key) > 0) {\n    if (this.right) { this.right.delete(key, value); }\n    return;\n  }\n\n  if (!this.compareKeys(key, this.key) === 0) { return; }\n\n  // Delete only a value\n  if (this.data.length > 1 && value !== undefined) {\n    this.data.forEach(function (d) {\n      if (!self.checkValueEquality(d, value)) { newData.push(d); }\n    });\n    self.data = newData;\n    return;\n  }\n\n  // Delete the whole node\n  if (this.deleteIfLeaf()) {\n    return;\n  }\n  if (this.deleteIfOnlyOneChild()) {\n    return;\n  }\n\n  // We are in the case where the node to delete has two children\n  if (Math.random() >= 0.5) {   // Randomize replacement to avoid unbalancing the tree too much\n    // Use the in-order predecessor\n    replaceWith = this.left.getMaxKeyDescendant();\n\n    this.key = replaceWith.key;\n    this.data = replaceWith.data;\n\n    if (this === replaceWith.parent) {   // Special case\n      this.left = replaceWith.left;\n      if (replaceWith.left) { replaceWith.left.parent = replaceWith.parent; }\n    } else {\n      replaceWith.parent.right = replaceWith.left;\n      if (replaceWith.left) { replaceWith.left.parent = replaceWith.parent; }\n    }\n  } else {\n    // Use the in-order successor\n    replaceWith = this.right.getMinKeyDescendant();\n\n    this.key = replaceWith.key;\n    this.data = replaceWith.data;\n\n    if (this === replaceWith.parent) {   // Special case\n      this.right = replaceWith.right;\n      if (replaceWith.right) { replaceWith.right.parent = replaceWith.parent; }\n    } else {\n      replaceWith.parent.left = replaceWith.right;\n      if (replaceWith.right) { replaceWith.right.parent = replaceWith.parent; }\n    }\n  }\n};\n\n\n/**\n * Execute a function on every node of the tree, in key order\n * @param {Function} fn Signature: node. Most useful will probably be node.key and node.data\n */\nBinarySearchTree.prototype.executeOnEveryNode = function (fn) {\n  if (this.left) { this.left.executeOnEveryNode(fn); }\n  fn(this);\n  if (this.right) { this.right.executeOnEveryNode(fn); }\n};\n\n\n/**\n * Pretty print a tree\n * @param {Boolean} printData To print the nodes' data along with the key\n */\nBinarySearchTree.prototype.prettyPrint = function (printData, spacing) {\n  spacing = spacing || \"\";\n\n  console.log(spacing + \"* \" + this.key);\n  if (printData) { console.log(spacing + \"* \" + this.data); }\n\n  if (!this.left && !this.right) { return; }\n\n  if (this.left) {\n    this.left.prettyPrint(printData, spacing + \"  \");\n  } else {\n    console.log(spacing + \"  *\");\n  }\n  if (this.right) {\n    this.right.prettyPrint(printData, spacing + \"  \");\n  } else {\n    console.log(spacing + \"  *\");\n  }\n};\n\n\n\n\n// Interface\nmodule.exports = BinarySearchTree;\n","/**\n * Return an array with the numbers from 0 to n-1, in a random order\n */\nfunction getRandomArray (n) {\n  var res, next;\n\n  if (n === 0) { return []; }\n  if (n === 1) { return [0]; }\n\n  res = getRandomArray(n - 1);\n  next = Math.floor(Math.random() * n);\n  res.splice(next, 0, n - 1);   // Add n-1 at a random position in the array\n\n  return res;\n};\nmodule.exports.getRandomArray = getRandomArray;\n\n\n/*\n * Default compareKeys function will work for numbers, strings and dates\n */\nfunction defaultCompareKeysFunction (a, b) {\n  if (a < b) { return -1; }\n  if (a > b) { return 1; }\n  if (a === b) { return 0; }\n\n  var err = new Error(\"Couldn't compare elements\");\n  err.a = a;\n  err.b = b;\n  throw err;\n}\nmodule.exports.defaultCompareKeysFunction = defaultCompareKeysFunction;\n\n\n/**\n * Check whether two values are equal (used in non-unique deletion)\n */\nfunction defaultCheckValueEquality (a, b) {\n  return a === b;\n}\nmodule.exports.defaultCheckValueEquality = defaultCheckValueEquality;\n","/*---------------------------------------------------------\r\n * Copyright (C) Xored Software Inc. All rights reserved.\r\n * Licensed under the MIT License. See LICENSE in the project root for license information.\r\n *--------------------------------------------------------*/\r\n\r\n'use strict';\r\n\r\nimport { NIM_MODE } from './nimMode';\r\nimport vscode = require('vscode');\r\n\r\nlet statusBarEntry: vscode.StatusBarItem;\r\nlet progressBarEntry: vscode.StatusBarItem;\r\n\r\nexport function showHideStatus() {\r\n  if (!statusBarEntry) {\r\n    return;\r\n  }\r\n  if (!vscode.window.activeTextEditor) {\r\n    statusBarEntry.hide();\r\n    return;\r\n  }\r\n  if (vscode.languages.match(NIM_MODE, vscode.window.activeTextEditor.document)) {\r\n    statusBarEntry.show();\r\n    return;\r\n  }\r\n  statusBarEntry.hide();\r\n}\r\n\r\nexport function hideNimStatus() {\r\n  statusBarEntry.dispose();\r\n}\r\n\r\nexport function hideNimProgress() {\r\n  progressBarEntry.dispose();\r\n}\r\n\r\nexport function showNimStatus(message: string, command: string, tooltip?: string) {\r\n  statusBarEntry = vscode.window.createStatusBarItem(vscode.StatusBarAlignment.Right, Number.MIN_VALUE);\r\n  statusBarEntry.text = message;\r\n  statusBarEntry.command = command;\r\n  statusBarEntry.color = 'yellow';\r\n  statusBarEntry.tooltip = tooltip;\r\n  statusBarEntry.show();\r\n}\r\n\r\nexport function showNimProgress(message: string) {\r\n  progressBarEntry = vscode.window.createStatusBarItem(vscode.StatusBarAlignment.Right, Number.MIN_VALUE);\r\n  console.log(message);\r\n  progressBarEntry.text = message;\r\n  progressBarEntry.tooltip = message;\r\n  progressBarEntry.show();\r\n}\r\n\r\nexport function updateNimProgress(message: string) {\r\n    progressBarEntry.text = message;\r\n}","/*---------------------------------------------------------\r\n * Copyright (C) Xored Software Inc. All rights reserved.\r\n * Licensed under the MIT License. See LICENSE in the project root for license information.\r\n *--------------------------------------------------------*/\r\n\r\n'use strict';\r\n\r\nimport vscode = require('vscode');\r\nimport fs = require('fs');\r\nimport path = require('path');\r\n\r\nimport { initNimSuggest, closeAllNimSuggestProcesses } from './nimSuggestExec';\r\nimport { NimCompletionItemProvider } from './nimSuggest';\r\nimport { NimDefinitionProvider } from './nimDeclaration';\r\nimport { NimReferenceProvider } from './nimReferences';\r\nimport { NimHoverProvider } from './nimHover';\r\nimport { NimRenameProvider } from './nimRename';\r\nimport { NimDocumentSymbolProvider, NimWorkspaceSymbolProvider } from './nimOutline';\r\nimport * as indexer from './nimIndexer';\r\nimport { NimSignatureHelpProvider } from './nimSignature';\r\nimport { NimFormattingProvider } from './nimFormatting';\r\nimport { check, execSelectionInTerminal, activateEvalConsole } from './nimBuild';\r\nimport { NIM_MODE } from './nimMode';\r\nimport { showHideStatus } from './nimStatus';\r\nimport { getDirtyFile, outputLine } from './nimUtils';\r\nimport { ProgressLocation } from 'vscode';\r\nimport { initImports, removeFileFromImports, addFileToImports } from './nimImports';\r\n\r\nlet diagnosticCollection: vscode.DiagnosticCollection;\r\nvar fileWatcher: vscode.FileSystemWatcher;\r\nvar terminal: vscode.Terminal | undefined;\r\n\r\nexport function activate(ctx: vscode.ExtensionContext): void {\r\n    let config = vscode.workspace.getConfiguration('nim');\r\n\r\n    vscode.commands.registerCommand('nim.run.file', runFile);\r\n    vscode.commands.registerCommand('nim.check', runCheck);\r\n    vscode.commands.registerCommand('nim.execSelectionInTerminal', execSelectionInTerminal);\r\n\r\n    if (vscode.workspace.getConfiguration('nim').get('enableNimsuggest') as boolean) {\r\n        initNimSuggest();\r\n        ctx.subscriptions.push(vscode.languages.registerCompletionItemProvider(NIM_MODE, new NimCompletionItemProvider(), '.', ' '));\r\n        ctx.subscriptions.push(vscode.languages.registerDefinitionProvider(NIM_MODE, new NimDefinitionProvider()));\r\n        ctx.subscriptions.push(vscode.languages.registerReferenceProvider(NIM_MODE, new NimReferenceProvider()));\r\n        ctx.subscriptions.push(vscode.languages.registerRenameProvider(NIM_MODE, new NimRenameProvider()));\r\n        ctx.subscriptions.push(vscode.languages.registerDocumentSymbolProvider(NIM_MODE, new NimDocumentSymbolProvider()));\r\n        ctx.subscriptions.push(vscode.languages.registerSignatureHelpProvider(NIM_MODE, new NimSignatureHelpProvider(), '(', ','));\r\n        ctx.subscriptions.push(vscode.languages.registerHoverProvider(NIM_MODE, new NimHoverProvider()));\r\n        ctx.subscriptions.push(vscode.languages.registerDocumentFormattingEditProvider(NIM_MODE, new NimFormattingProvider()));\r\n    }\r\n\r\n    diagnosticCollection = vscode.languages.createDiagnosticCollection('nim');\r\n    ctx.subscriptions.push(diagnosticCollection);\r\n\r\n    vscode.languages.setLanguageConfiguration(NIM_MODE.language as string, {\r\n        // @Note Literal whitespace in below regexps is removed\r\n        onEnterRules: [\r\n            {\r\n                beforeText: /^(\\s)*## /,\r\n                action: { indentAction: vscode.IndentAction.None, appendText: '## '}\r\n            },\r\n            {\r\n                beforeText: new RegExp(String.raw`\r\n                    ^\\s*\r\n                    (\r\n                        (case) \\b .* :\r\n                    )\r\n                    \\s*$\r\n                `.replace(/\\s+?/g, '')),\r\n                action: {\r\n                    indentAction: vscode.IndentAction.None\r\n                }\r\n            },\r\n            {\r\n                beforeText: new RegExp(String.raw`\r\n                    ^\\s*\r\n                    (\r\n                        (\r\n                            (proc|macro|iterator|template|converter|func) \\b .*=\r\n                        )|(\r\n                            (import|export|let|var|const|type) \\b\r\n                        )|(\r\n                            [^:]+:\r\n                        )\r\n                    )\r\n                    \\s*$\r\n                `.replace(/\\s+?/g, '')),\r\n                action: {\r\n                    indentAction: vscode.IndentAction.Indent\r\n                }\r\n            },\r\n            {\r\n                beforeText: new RegExp(String.raw`\r\n                ^\\s*\r\n                    (\r\n                        (\r\n                            (return|raise|break|continue) \\b .*\r\n                        )|(\r\n                            (discard) \\b\r\n                        )\r\n                    )\r\n                    \\s*\r\n                `.replace(/\\s+?/g, '')),\r\n                action: {\r\n                    indentAction: vscode.IndentAction.Outdent\r\n                }\r\n            }\r\n        ],\r\n\r\n        wordPattern: /(-?\\d*\\.\\d\\w*)|([^\\`\\~\\!\\@\\#\\%\\^\\&\\*\\(\\)\\-\\=\\+\\[\\{\\]\\}\\\\\\|\\;\\:\\'\\\"\\,\\.\\<\\>\\/\\?\\s]+)/g,\r\n    });\r\n\r\n    vscode.window.onDidChangeActiveTextEditor(showHideStatus, null, ctx.subscriptions);\r\n\r\n    vscode.window.onDidCloseTerminal((e: vscode.Terminal) => {\r\n        if (terminal && e.processId === terminal.processId) {\r\n            terminal = undefined;\r\n        }\r\n    });\r\n\r\n    console.log(ctx.extensionPath);\r\n    activateEvalConsole();\r\n    indexer.initWorkspace(ctx.extensionPath);\r\n    fileWatcher = vscode.workspace.createFileSystemWatcher('**/*.nim');\r\n    fileWatcher.onDidCreate((uri) => {\r\n        if (config.has('licenseString')) {\r\n            let path = uri.fsPath.toLowerCase();\r\n            if (path.endsWith('.nim') || path.endsWith('.nims')) {\r\n                fs.stat(uri.fsPath, (err, stats) => {\r\n                    if (stats && stats.size === 0) {\r\n                        let edit = new vscode.WorkspaceEdit();\r\n                        edit.insert(uri, new vscode.Position(0, 0), config['licenseString']);\r\n                        vscode.workspace.applyEdit(edit);\r\n                    }\r\n                });\r\n            }\r\n        }\r\n        addFileToImports(uri.fsPath);\r\n    });\r\n\r\n    fileWatcher.onDidDelete(uri => {\r\n        removeFileFromImports(uri.fsPath);\r\n    });\r\n\r\n    ctx.subscriptions.push(vscode.languages.registerWorkspaceSymbolProvider(new NimWorkspaceSymbolProvider()));\r\n\r\n    startBuildOnSaveWatcher(ctx.subscriptions);\r\n\r\n    if (vscode.window.activeTextEditor && !!vscode.workspace.getConfiguration('nim')['lintOnSave']) {\r\n        runCheck(vscode.window.activeTextEditor.document);\r\n    }\r\n\r\n    if (vscode.workspace.getConfiguration('nim').get('enableNimsuggest') as boolean) {\r\n        if (config.has('nimsuggestRestartTimeout')) {\r\n            let timeout = config['nimsuggestRestartTimeout'] as number;\r\n            if (timeout > 0) {\r\n                console.log('Reset nimsuggest process each ' + timeout + ' minutes');\r\n                global.setInterval(() => closeAllNimSuggestProcesses(), timeout * 60000);\r\n            }\r\n        }\r\n    }\r\n\r\n    initImports();\r\n    outputLine('[info] Extension Activated');\r\n}\r\n\r\n\r\nexport function deactivate(): void {\r\n    closeAllNimSuggestProcesses();\r\n    fileWatcher.dispose();\r\n}\r\n\r\nfunction runCheck(document?: vscode.TextDocument) {\r\n    let config = vscode.workspace.getConfiguration('nim');\r\n    if (!document && vscode.window.activeTextEditor) {\r\n        document = vscode.window.activeTextEditor.document;\r\n    }\r\n\r\n    function mapSeverityToVSCodeSeverity(sev: string) {\r\n        switch (sev) {\r\n            case 'Hint': return vscode.DiagnosticSeverity.Warning;\r\n            case 'Error': return vscode.DiagnosticSeverity.Error;\r\n            case 'Warning': return vscode.DiagnosticSeverity.Warning;\r\n            default: return vscode.DiagnosticSeverity.Error;\r\n        }\r\n    }\r\n\r\n    if (!document || document.languageId !== 'nim' || document.fileName.endsWith('nim.cfg')) {\r\n        return;\r\n    }\r\n\r\n    var uri = document.uri;\r\n\r\n    vscode.window.withProgress(\r\n        {location: ProgressLocation.Window, cancellable: false, title: 'Nim: check project...'},\r\n        (progress) => check(uri.fsPath, config)\r\n    ).then(errors => {\r\n        diagnosticCollection.clear();\r\n\r\n        let diagnosticMap: Map<string, vscode.Diagnostic[]> = new Map();\r\n        var err: { [key: string]: boolean; } = {};\r\n        errors.forEach(error => {\r\n            if (!err[error.file + error.line + error.column + error.msg]) {\r\n                let targetUri = error.file;\r\n                let endColumn = error.column;\r\n                if (error.msg.indexOf('\\'') >= 0) {\r\n                    endColumn += error.msg.lastIndexOf('\\'') - error.msg.indexOf('\\'') - 2;\r\n                }\r\n                let line = Math.max(0, error.line - 1);\r\n                let range = new vscode.Range(line, Math.max(0, error.column - 1), line, Math.max(0, endColumn));\r\n                let diagnostic = new vscode.Diagnostic(range, error.msg, mapSeverityToVSCodeSeverity(error.severity));\r\n                let diagnostics = diagnosticMap.get(targetUri);\r\n                if (!diagnostics) {\r\n                    diagnostics = [];\r\n                }\r\n                diagnosticMap.set(targetUri, diagnostics);\r\n                diagnostics.push(diagnostic);\r\n                err[error.file + error.line + error.column + error.msg] = true;\r\n            }\r\n        });\r\n\r\n        let entries: [vscode.Uri, vscode.Diagnostic[]][] = [];\r\n        diagnosticMap.forEach((diags, uri) => {\r\n            entries.push([vscode.Uri.file(uri), diags]);\r\n        });\r\n        diagnosticCollection.set(entries);\r\n    });\r\n}\r\n\r\nfunction startBuildOnSaveWatcher(subscriptions: vscode.Disposable[]) {\r\n    vscode.workspace.onDidSaveTextDocument(document => {\r\n        if (document.languageId !== 'nim') {\r\n            return;\r\n        }\r\n        if (!!vscode.workspace.getConfiguration('nim')['lintOnSave']) {\r\n            runCheck(document);\r\n        }\r\n        if (!!vscode.workspace.getConfiguration('nim')['buildOnSave']) {\r\n            vscode.commands.executeCommand('workbench.action.tasks.build');\r\n        }\r\n    }, null, subscriptions);\r\n}\r\n\r\nfunction runFile() {\r\n    let editor = vscode.window.activeTextEditor;\r\n    if (editor) {\r\n        if (!terminal) {\r\n            terminal = vscode.window.createTerminal('Nim');\r\n        }\r\n        terminal.show(true);\r\n        if (editor.document.isUntitled) {\r\n            terminal.sendText('nim ' + vscode.workspace.getConfiguration('nim')['buildCommand'] +\r\n                ' -r \"' + getDirtyFile(editor.document) + '\"', true);\r\n        } else {\r\n            let outputDirConfig = vscode.workspace.getConfiguration('nim')['runOutputDirectory'];\r\n            var outputParams = '';\r\n            if (!!outputDirConfig) {\r\n                if (vscode.workspace.workspaceFolders) {\r\n                    var rootPath = '';\r\n                    for (const folder of vscode.workspace.workspaceFolders) {\r\n                        if (folder.uri.scheme === 'file') {\r\n                            rootPath = folder.uri.fsPath;\r\n                            break;\r\n                        }\r\n                    }\r\n                    if (rootPath !== '') {\r\n                        if (!fs.existsSync(path.join(rootPath, outputDirConfig))) {\r\n                            fs.mkdirSync(path.join(rootPath, outputDirConfig));\r\n                        }\r\n                        outputParams = ' --out:\"' + path.join(outputDirConfig, path.basename(editor.document.fileName, '.nim')) + '\"';\r\n                    }\r\n                }\r\n            }\r\n            if (editor && editor.document.isDirty) {\r\n                editor.document.save().then((success: boolean) => {\r\n                    if (terminal && editor && success) {\r\n                        terminal.sendText('nim ' + vscode.workspace.getConfiguration('nim')['buildCommand'] +\r\n                            outputParams + ' -r \"' + editor.document.fileName + '\"', true);\r\n                    }\r\n                });\r\n            } else {\r\n                terminal.sendText('nim ' + vscode.workspace.getConfiguration('nim')['buildCommand'] +\r\n                    outputParams + ' -r \"' + editor.document.fileName + '\"', true);\r\n            }\r\n        }\r\n    }\r\n}\r\n","/*---------------------------------------------------------\r\n * Copyright (C) Xored Software Inc., RSDuck All rights reserved.\r\n * Licensed under the MIT License. See LICENSE in the project root for license information.\r\n *--------------------------------------------------------*/\r\nimport net = require('net');\r\nimport util = require('util');\r\nimport sexp = require('./sexp');\r\n\r\nfunction envelope(content: string): string {\r\n    return ('000000' + (new util.TextEncoder().encode(content).length).toString(16)).slice(-6) + content;\r\n}\r\n\r\nfunction generateUID(): number {\r\n    return Math.floor(Math.random() * 10000);\r\n}\r\n\r\nexport class EPCPeer {\r\n    private socket: net.Socket;\r\n\r\n    private receivedBuffer: Buffer;\r\n    private sessions = new Map<number, (data: any) => void>();\r\n\r\n    private socketClosed = false;\r\n\r\n    constructor(socket: net.Socket) {\r\n        this.socket = socket;\r\n        this.receivedBuffer = new Buffer(0);\r\n        this.socket.on('data', data => {\r\n            this.receivedBuffer = Buffer.concat([this.receivedBuffer, data]);\r\n            while (this.receivedBuffer.length > 0) {\r\n                if (this.receivedBuffer.length >= 6) {\r\n                    let length = parseInt(this.receivedBuffer.toString('utf8', 0, 6), 16);\r\n                    if (this.receivedBuffer.length >= length + 6) {\r\n                        let content = <any[]>sexp.parseSExp(this.receivedBuffer.toString('utf8', 6, 6 + length));\r\n                        if (content) {\r\n                            let guid = <number>(content[0][1]);\r\n                            let handle = this.sessions.get(guid) as ((data: any) => void);\r\n                            handle(content[0]);\r\n                            this.sessions.delete(guid);\r\n                        } else {\r\n                            this.sessions.forEach(session => {\r\n                                session('Received invalid SExp data');\r\n                            });\r\n                        }\r\n\r\n                        this.receivedBuffer = this.receivedBuffer.slice(6 + length);\r\n                    } else\r\n                        return;\r\n                }\r\n            }\r\n        });\r\n        this.socket.on('close', (error) => {\r\n            console.error('Connection closed' + (error ? ' due to an error' : ''));\r\n            this.sessions.forEach(session => {\r\n                session('Connection closed');\r\n            });\r\n            this.socketClosed = true;\r\n        });\r\n    }\r\n\r\n    callMethod(method: string, ...parameter: sexp.SExp[]): Promise<any[]> {\r\n        return new Promise<any[]>((resolve, reject) => {\r\n            if (this.socketClosed)\r\n                reject('Connection closed');\r\n\r\n            let guid = generateUID();\r\n\r\n            let payload = '(call ' + guid + ' ' + method + ' ' + sexp.toString({ kind: 'list', elements: parameter }) + ')';\r\n\r\n            this.sessions.set(guid, (data: any) => {\r\n                if (!(data instanceof Array)) {\r\n                    reject(data);\r\n                } else {\r\n                    switch (data[0]) {\r\n                        case 'return':\r\n                            resolve(data[2]);\r\n                            break;\r\n                        case 'return-error':\r\n                        case 'epc-error':\r\n                            reject(data[2]);\r\n                            break;\r\n                    }\r\n                }\r\n            });\r\n            this.socket.write(envelope(payload));\r\n        });\r\n    }\r\n\r\n    stop() {\r\n        if (!this.socketClosed)\r\n            this.socket.destroy();\r\n    }\r\n}\r\n\r\nexport function startClient(port: number): Promise<EPCPeer> {\r\n    return new Promise<EPCPeer>((resolve, reject) => {\r\n        try {\r\n            let socket = net.createConnection(port, 'localhost', () => {\r\n                resolve(new EPCPeer(socket));\r\n            });\r\n        } catch (e) {\r\n            reject(e);\r\n        }\r\n    });\r\n}\r\n","module.exports = require(\"net\");","/*---------------------------------------------------------\r\n * Copyright (C) Xored Software Inc., RSDuck All rights reserved.\r\n * Licensed under the MIT License. See LICENSE in the project root for license information.\r\n *--------------------------------------------------------*/\r\nexport interface SExpCons { kind: 'cons'; car: SExp; cdr: SExp; }\r\nexport interface SExpList { kind: 'list'; elements: Array<SExp>; }\r\nexport interface SExpNumber { kind: 'number'; n: number; }\r\nexport interface SExpIdent { kind: 'ident'; ident: string; }\r\nexport interface SExpString { kind: 'string'; str: string; }\r\nexport interface SExpNil { kind: 'nil'; }\r\n\r\nexport type SExp = SExpCons | SExpList | SExpNumber | SExpIdent | SExpString | SExpNil;\r\n\r\nexport function toJS(sexp: SExp): any {\r\n    switch (sexp.kind) {\r\n        case 'cons':\r\n            return [toJS(sexp.car), toJS(sexp.cdr)];\r\n        case 'list':\r\n            return sexp.elements.map(element => toJS(element));\r\n        case 'number':\r\n            return sexp.n;\r\n        case 'ident':\r\n            return sexp.ident;\r\n        case 'string':\r\n            return sexp.str;\r\n        case 'nil':\r\n            return null;\r\n    }\r\n}\r\n\r\nexport function toString(sexp: SExp): any {\r\n    switch (sexp.kind) {\r\n        case 'cons':\r\n            return '(' + toString(sexp.car) + ' . ' + toString(sexp.cdr) + ')';\r\n        case 'list':\r\n            let stringRepr = '(';\r\n            sexp.elements.forEach(element => {\r\n                stringRepr += toString(element) + ' ';\r\n            });\r\n            return stringRepr.substr(0, stringRepr.length - 1) + ')';\r\n        case 'number':\r\n            return sexp.n.toString();\r\n        case 'ident':\r\n            return sexp.ident;\r\n        case 'string':\r\n            return JSON.stringify(sexp.str);\r\n        case 'nil':\r\n            return 'nil';\r\n    }\r\n}\r\n\r\n// outputs the SExp directly as a JS object to reduce the processing time\r\nexport function parseSExp(input: string): /*SExp*/ any[] | string {\r\n    let ptr = 0;\r\n\r\n    function parseSymbol(): /*SExpIdent | SExpNumber | SExpNil*/ string | number | null {\r\n        let symbolStart = ptr;\r\n        while (ptr < input.length && !(input[ptr] === ' ' || input[ptr] === ')')) {\r\n            if (input[ptr] === '\\\\' && input[ptr + 1] === ' ')\r\n                ptr += 2;\r\n            else\r\n                ptr++;\r\n        }\r\n        let sym = input.substring(symbolStart, ptr);\r\n\r\n        if (/^-?\\d+$/.test(sym))\r\n            // return { kind: \"number\", n: parseInt(sym) };\r\n            return parseInt(sym);\r\n        // else if (/^-?\\d+.\\d+$/.test(sym))\r\n        //    return { kind: \"number\", n: parseFloat(sym) };\r\n        else if (sym === 'nil')\r\n            // return { kind: \"nil\" };\r\n            return null;\r\n        // else if (/^#x-?[\\da-fA-F]+$/.test(sym))\r\n        //    return { kind: \"number\", n: parseInt(sym.substr(2), 16) };\r\n        // return { kind: \"ident\", ident: sym };\r\n        return sym;\r\n    }\r\n\r\n    function parseString(): /*SExpString*/ string {\r\n        let hasEscapes = false;\r\n        let startPos = ptr;\r\n        while (ptr < input.length && input[ptr] !== '\\\"') {\r\n            if (input[ptr] === '\\\\') {\r\n                if (ptr + 1 >= input.length)\r\n                    throw 'Expected character after a escape seqence introducing backslash';\r\n                // string += input[ptr] + input[ptr + 1];\r\n                ptr += 2;\r\n                hasEscapes = true;\r\n            } else\r\n                // string += input[ptr++];\r\n                ptr++;\r\n        }\r\n        // let str = input.substring(startPos, ptr);\r\n        // return { kind: \"string\", str: hasEscapes ? JSON.parse(\"\\\"\" + string + \"\\\"\") : string };\r\n        return hasEscapes ? JSON.parse(input.substring(startPos - 1, ptr + 1)) : input.substring(startPos, ptr);\r\n    }\r\n\r\n    function parseListOrCon(root?: boolean): /*SExpList | SExpCons*/ any[] {\r\n        // let items: SExp[] = [];\r\n        let items = [];\r\n        let cons = false;\r\n        while (ptr < input.length) {\r\n            if (input[ptr] !== '(' && input[ptr] !== ')' && input[ptr] !== ' ' && input[ptr] !== '\"') {\r\n                let sym = parseSymbol();\r\n                // if (sym.kind == \"ident\" && sym.ident == \".\") {\r\n                if (sym === '.') {\r\n                    if (items.length === 1)\r\n                        cons = true;\r\n                    else\r\n                        throw 'Invalid cons cell syntax';\r\n                }\r\n                items.push(sym);\r\n            } else if (input[ptr] === '(') {\r\n                ptr++;\r\n                items.push(parseListOrCon());\r\n            } else if (input[ptr] === '\\\"') {\r\n                ptr++;\r\n                items.push(parseString());\r\n            }\r\n            if (input[ptr++] === ')')\r\n                break;\r\n            // ptr++;\r\n        }\r\n        if (input[ptr - 1] !== ')' && !root)\r\n            throw 'Premature end, expected closing bracket';\r\n\r\n        if (cons) {\r\n            if (items.length === 3) {\r\n                // return { kind: \"cons\", car: items[0], cdr: items[2] };\r\n                return [items[0], items[2]];\r\n            } else\r\n                throw 'Invalid cons cell syntax';\r\n        }\r\n\r\n        // return { kind: \"list\", elements: items };\r\n        return items;\r\n    }\r\n\r\n    try {\r\n        return parseListOrCon(true);\r\n    } catch (e) {\r\n        return e;\r\n    }\r\n}\r\n","module.exports = require(\"readline\");","/*---------------------------------------------------------\r\n * Copyright (C) Xored Software Inc. All rights reserved.\r\n * Licensed under the MIT License. See LICENSE in the project root for license information.\r\n *--------------------------------------------------------*/\r\n\r\n'use strict';\r\n\r\nimport vscode = require('vscode');\r\nimport { getDirtyFile, getProjectFileInfo } from './nimUtils';\r\nimport { execNimSuggest, NimSuggestType, NimSuggestResult } from './nimSuggestExec';\r\nimport { getImports } from './nimImports';\r\n\r\nexport class NimCompletionItemProvider implements vscode.CompletionItemProvider {\r\n  public provideCompletionItems(document: vscode.TextDocument, position: vscode.Position, token: vscode.CancellationToken): Thenable<vscode.CompletionItem[]> {\r\n    return new Promise<vscode.CompletionItem[]>((resolve, reject) => {\r\n      var filename = document.fileName;\r\n      let range = document.getWordRangeAtPosition(position);\r\n      let txt = range ? document.getText(range).toLowerCase() : undefined;\r\n      let line = document.lineAt(position).text;\r\n      if (line.startsWith('import ')) {\r\n        let txtPart = txt && range ? document.getText(range.with({end: position})).toLowerCase() : undefined;\r\n        resolve(getImports(txtPart, getProjectFileInfo(filename).wsFolder.uri.fsPath));\r\n      } else {\r\n        execNimSuggest(NimSuggestType.sug, filename, (position.line + 1), position.character, getDirtyFile(document))\r\n          .then(items => {\r\n            var suggestions: vscode.CompletionItem[] = [];\r\n            if (items) {\r\n              items.forEach(item => {\r\n                if (item.answerType === 'sug'\r\n                    &&  (!txt || item.symbolName.toLowerCase().indexOf(txt) >= 0)\r\n                    && /[a-z]/i.test(item.symbolName)) {\r\n                  var suggestion = new vscode.CompletionItem(item.symbolName);\r\n                  suggestion.kind = vscodeKindFromNimSym(item.suggest);\r\n                  suggestion.detail = nimSymDetails(item);\r\n                  suggestion.sortText = ('0000' + suggestions.length).slice(-4);\r\n                  // use predefined text to disable suggest sorting\r\n                  suggestion.documentation = new vscode.MarkdownString(item.documentation);\r\n                  suggestions.push(suggestion);\r\n                }\r\n              });\r\n            }\r\n            if (suggestions.length > 0) {\r\n              resolve(suggestions);\r\n            } else {\r\n              reject();\r\n            }\r\n          }).catch(reason => reject(reason));\r\n      }\r\n    });\r\n  }\r\n}\r\n\r\nfunction vscodeKindFromNimSym(kind: string): vscode.CompletionItemKind {\r\n  switch (kind) {\r\n    case 'skConst':\r\n      return vscode.CompletionItemKind.Value;\r\n    case 'skEnumField':\r\n      return vscode.CompletionItemKind.Enum;\r\n    case 'skForVar':\r\n      return vscode.CompletionItemKind.Variable;\r\n    case 'skIterator':\r\n      return vscode.CompletionItemKind.Keyword;\r\n    case 'skLabel':\r\n      return vscode.CompletionItemKind.Keyword;\r\n    case 'skLet':\r\n      return vscode.CompletionItemKind.Value;\r\n    case 'skMacro':\r\n      return vscode.CompletionItemKind.Snippet;\r\n    case 'skMethod':\r\n      return vscode.CompletionItemKind.Method;\r\n    case 'skParam':\r\n      return vscode.CompletionItemKind.Variable;\r\n    case 'skProc':\r\n      return vscode.CompletionItemKind.Function;\r\n    case 'skResult':\r\n      return vscode.CompletionItemKind.Value;\r\n    case 'skTemplate':\r\n      return vscode.CompletionItemKind.Snippet;\r\n    case 'skType':\r\n      return vscode.CompletionItemKind.Class;\r\n    case 'skVar':\r\n      return vscode.CompletionItemKind.Field;\r\n    case 'skFunc':\r\n      return vscode.CompletionItemKind.Function;\r\n  }\r\n  return vscode.CompletionItemKind.Property;\r\n}\r\n\r\nfunction nimSymDetails(suggest: NimSuggestResult): string {\r\n  switch (suggest.suggest) {\r\n    case 'skConst':\r\n      return 'const ' + suggest.fullName + ': ' + suggest.type;\r\n    case 'skEnumField':\r\n      return 'enum ' + suggest.type;\r\n    case 'skForVar':\r\n      return 'for var of ' + suggest.type;\r\n    case 'skIterator':\r\n      return suggest.type;\r\n    case 'skLabel':\r\n      return 'label';\r\n    case 'skLet':\r\n      return 'let of ' + suggest.type;\r\n    case 'skMacro':\r\n      return 'macro';\r\n    case 'skMethod':\r\n      return suggest.type;\r\n    case 'skParam':\r\n      return 'param';\r\n    case 'skProc':\r\n      return suggest.type;\r\n    case 'skResult':\r\n      return 'result';\r\n    case 'skTemplate':\r\n      return suggest.type;\r\n    case 'skType':\r\n      return 'type ' + suggest.fullName;\r\n    case 'skVar':\r\n      return 'var of ' + suggest.type;\r\n  }\r\n  return suggest.type;\r\n}\r\n","/*---------------------------------------------------------\r\n * Copyright (C) Xored Software Inc. All rights reserved.\r\n * Licensed under the MIT License. See LICENSE in the project root for license information.\r\n *--------------------------------------------------------*/\r\n\r\n'use strict';\r\n\r\nimport vscode = require('vscode');\r\nimport { getDirtyFile } from './nimUtils';\r\nimport { execNimSuggest, NimSuggestType} from './nimSuggestExec';\r\n\r\n\r\nexport class NimDefinitionProvider implements vscode.DefinitionProvider {\r\n\r\n  public provideDefinition(document: vscode.TextDocument, position: vscode.Position,\r\n                           token: vscode.CancellationToken): vscode.ProviderResult<vscode.Definition | vscode.DefinitionLink[]> {\r\n    return new Promise<any>((resolve, reject) => {\r\n      execNimSuggest(NimSuggestType.def, document.fileName, position.line + 1, position.character,\r\n        getDirtyFile(document)).then(result => {\r\n\r\n          if (result && result.length > 0) {\r\n            let def = result.pop();\r\n            if (def) {\r\n              resolve(def.location);\r\n            } else {\r\n              resolve(null);\r\n            }\r\n          } else {\r\n            resolve(null);\r\n          }\r\n        }).catch(reason => reject(reason));\r\n    });\r\n  }\r\n\r\n}","/*---------------------------------------------------------\r\n * Copyright (C) Xored Software Inc. All rights reserved.\r\n * Licensed under the MIT License. See LICENSE in the project root for license information.\r\n *--------------------------------------------------------*/\r\n\r\n'use strict';\r\n\r\nimport vscode = require('vscode');\r\nimport { getDirtyFile } from './nimUtils';\r\nimport { execNimSuggest, NimSuggestType } from './nimSuggestExec';\r\n\r\nexport class NimReferenceProvider implements vscode.ReferenceProvider {\r\n\r\n  public provideReferences(document: vscode.TextDocument, position: vscode.Position, options: { includeDeclaration: boolean }, token: vscode.CancellationToken): Thenable<vscode.Location[]> {\r\n    return new Promise<vscode.Location[]>((resolve, reject) => {\r\n      vscode.workspace.saveAll(false).then(() => {\r\n          execNimSuggest(NimSuggestType.use, document.fileName, position.line + 1, position.character, getDirtyFile(document))\r\n            .then(result => {\r\n              var references: vscode.Location[] = [];\r\n              if (result) {\r\n                result.forEach(item => {\r\n                  references.push(item.location);\r\n                });\r\n                resolve(references);\r\n              } else {\r\n                resolve();\r\n              }\r\n            })\r\n            .catch(reason => reject(reason));\r\n        });\r\n    });\r\n  }\r\n}","/*---------------------------------------------------------\r\n * Copyright (C) Xored Software Inc. All rights reserved.\r\n * Licensed under the MIT License. See LICENSE in the project root for license information.\r\n *--------------------------------------------------------*/\r\n\r\n'use strict';\r\n\r\nimport vscode = require('vscode');\r\nimport { NIM_MODE } from './nimMode';\r\nimport { getDirtyFile } from './nimUtils';\r\nimport { execNimSuggest, NimSuggestType, NimSuggestResult } from './nimSuggestExec';\r\n\r\n\r\nexport class NimHoverProvider implements vscode.HoverProvider {\r\n\r\n  public provideHover(document: vscode.TextDocument, position: vscode.Position, token: vscode.CancellationToken): Thenable<vscode.Hover> {\r\n    return new Promise<vscode.Hover>((resolve, reject) => {\r\n      execNimSuggest(NimSuggestType.def, document.fileName, position.line + 1, position.character,\r\n        getDirtyFile(document)).then(result => {\r\n          if (result && result.length > 0) {\r\n            let def = result.pop() as NimSuggestResult;\r\n\r\n            let label = def.fullName;\r\n            if (def.type !== '')\r\n              label += ': ' + def.type;\r\n            let hoverLabel = { language: NIM_MODE.language as string, value: label };\r\n            if (def.documentation !== '') {\r\n              resolve(new vscode.Hover([hoverLabel, def.documentation]));\r\n            } else {\r\n              resolve(new vscode.Hover(hoverLabel));\r\n            }\r\n          } else {\r\n            resolve();\r\n          }\r\n        }).catch(reason => reject(reason));\r\n    });\r\n  }\r\n\r\n}","'use strict';\r\n\r\nimport vscode = require('vscode');\r\nimport { getDirtyFile } from './nimUtils';\r\nimport { execNimSuggest, NimSuggestType } from './nimSuggestExec';\r\n\r\nexport class NimRenameProvider implements vscode.RenameProvider {\r\n\r\n  public provideRenameEdits(document: vscode.TextDocument, position: vscode.Position, newName: string, token: vscode.CancellationToken): Thenable<vscode.WorkspaceEdit> {\r\n    return new Promise<vscode.WorkspaceEdit>((resolve, reject) => {\r\n      vscode.workspace.saveAll(false).then(() => {\r\n          execNimSuggest(NimSuggestType.use, document.fileName, position.line + 1, position.character, getDirtyFile(document))\r\n            .then(result => {\r\n              var references: vscode.WorkspaceEdit = new vscode.WorkspaceEdit();\r\n              if (result) {\r\n                result.forEach(item => {\r\n                  let endPosition = new vscode.Position(item.range.end.line, item.range.end.character + item.symbolName.length);\r\n                  references.replace(item.uri, new vscode.Range(item.range.start, endPosition), newName);\r\n                });\r\n                resolve(references);\r\n              } else {\r\n                resolve();\r\n              }\r\n            })\r\n            .catch(reason => reject(reason));\r\n        });\r\n    });\r\n  }\r\n}\r\n","/*---------------------------------------------------------\r\n * Copyright (C) Xored Software Inc. All rights reserved.\r\n * Licensed under the MIT License. See LICENSE in the project root for license information.\r\n *--------------------------------------------------------*/\r\n\r\n'use strict';\r\n\r\nimport vscode = require('vscode');\r\n\r\nimport { getDirtyFile } from './nimUtils';\r\nimport { getFileSymbols, findWorkspaceSymbols } from './nimIndexer';\r\n\r\nexport class NimWorkspaceSymbolProvider implements vscode.WorkspaceSymbolProvider {\r\n\r\n    public provideWorkspaceSymbols(query: string, token: vscode.CancellationToken): Thenable<vscode.SymbolInformation[]> {\r\n        return findWorkspaceSymbols(query);\r\n    }\r\n}\r\n\r\nexport class NimDocumentSymbolProvider implements vscode.DocumentSymbolProvider {\r\n    public provideDocumentSymbols(document: vscode.TextDocument, token: vscode.CancellationToken): Thenable<vscode.SymbolInformation[]> {\r\n        return getFileSymbols(document.fileName, getDirtyFile(document));\r\n    }\r\n}\r\n","var Datastore = require('./lib/datastore');\n\nmodule.exports = Datastore;\n","var customUtils = require('./customUtils')\n  , model = require('./model')\n  , async = require('async')\n  , Executor = require('./executor')\n  , Index = require('./indexes')\n  , util = require('util')\n  , _ = require('underscore')\n  , Persistence = require('./persistence')\n  , Cursor = require('./cursor')\n  ;\n\n\n/**\n * Create a new collection\n * @param {String} options.filename Optional, datastore will be in-memory only if not provided\n * @param {Boolean} options.timestampData Optional, defaults to false. If set to true, createdAt and updatedAt will be created and populated automatically (if not specified by user)\n * @param {Boolean} options.inMemoryOnly Optional, defaults to false\n * @param {String} options.nodeWebkitAppName Optional, specify the name of your NW app if you want options.filename to be relative to the directory where\n *                                            Node Webkit stores application data such as cookies and local storage (the best place to store data in my opinion)\n * @param {Boolean} options.autoload Optional, defaults to false\n * @param {Function} options.onload Optional, if autoload is used this will be called after the load database with the error object as parameter. If you don't pass it the error will be thrown\n * @param {Function} options.afterSerialization/options.beforeDeserialization Optional, serialization hooks\n * @param {Number} options.corruptAlertThreshold Optional, threshold after which an alert is thrown if too much data is corrupt\n * @param {Function} options.compareStrings Optional, string comparison function that overrides default for sorting\n *\n * Event Emitter - Events\n * * compaction.done - Fired whenever a compaction operation was finished\n */\nfunction Datastore (options) {\n  var filename;\n\n  // Retrocompatibility with v0.6 and before\n  if (typeof options === 'string') {\n    filename = options;\n    this.inMemoryOnly = false;   // Default\n  } else {\n    options = options || {};\n    filename = options.filename;\n    this.inMemoryOnly = options.inMemoryOnly || false;\n    this.autoload = options.autoload || false;\n    this.timestampData = options.timestampData || false;\n  }\n\n  // Determine whether in memory or persistent\n  if (!filename || typeof filename !== 'string' || filename.length === 0) {\n    this.filename = null;\n    this.inMemoryOnly = true;\n  } else {\n    this.filename = filename;\n  }\n\n  // String comparison function\n  this.compareStrings = options.compareStrings;\n\n  // Persistence handling\n  this.persistence = new Persistence({ db: this, nodeWebkitAppName: options.nodeWebkitAppName\n                                      , afterSerialization: options.afterSerialization\n                                      , beforeDeserialization: options.beforeDeserialization\n                                      , corruptAlertThreshold: options.corruptAlertThreshold\n                                      });\n\n  // This new executor is ready if we don't use persistence\n  // If we do, it will only be ready once loadDatabase is called\n  this.executor = new Executor();\n  if (this.inMemoryOnly) { this.executor.ready = true; }\n\n  // Indexed by field name, dot notation can be used\n  // _id is always indexed and since _ids are generated randomly the underlying\n  // binary is always well-balanced\n  this.indexes = {};\n  this.indexes._id = new Index({ fieldName: '_id', unique: true });\n  this.ttlIndexes = {};\n\n  // Queue a load of the database right away and call the onload handler\n  // By default (no onload handler), if there is an error there, no operation will be possible so warn the user by throwing an exception\n  if (this.autoload) { this.loadDatabase(options.onload || function (err) {\n    if (err) { throw err; }\n  }); }\n}\n\nutil.inherits(Datastore, require('events').EventEmitter);\n\n\n/**\n * Load the database from the datafile, and trigger the execution of buffered commands if any\n */\nDatastore.prototype.loadDatabase = function () {\n  this.executor.push({ this: this.persistence, fn: this.persistence.loadDatabase, arguments: arguments }, true);\n};\n\n\n/**\n * Get an array of all the data in the database\n */\nDatastore.prototype.getAllData = function () {\n  return this.indexes._id.getAll();\n};\n\n\n/**\n * Reset all currently defined indexes\n */\nDatastore.prototype.resetIndexes = function (newData) {\n  var self = this;\n\n  Object.keys(this.indexes).forEach(function (i) {\n    self.indexes[i].reset(newData);\n  });\n};\n\n\n/**\n * Ensure an index is kept for this field. Same parameters as lib/indexes\n * For now this function is synchronous, we need to test how much time it takes\n * We use an async API for consistency with the rest of the code\n * @param {String} options.fieldName\n * @param {Boolean} options.unique\n * @param {Boolean} options.sparse\n * @param {Number} options.expireAfterSeconds - Optional, if set this index becomes a TTL index (only works on Date fields, not arrays of Date)\n * @param {Function} cb Optional callback, signature: err\n */\nDatastore.prototype.ensureIndex = function (options, cb) {\n  var err\n    , callback = cb || function () {};\n\n  options = options || {};\n\n  if (!options.fieldName) {\n    err = new Error(\"Cannot create an index without a fieldName\");\n    err.missingFieldName = true;\n    return callback(err);\n  }\n  if (this.indexes[options.fieldName]) { return callback(null); }\n\n  this.indexes[options.fieldName] = new Index(options);\n  if (options.expireAfterSeconds !== undefined) { this.ttlIndexes[options.fieldName] = options.expireAfterSeconds; }   // With this implementation index creation is not necessary to ensure TTL but we stick with MongoDB's API here\n\n  try {\n    this.indexes[options.fieldName].insert(this.getAllData());\n  } catch (e) {\n    delete this.indexes[options.fieldName];\n    return callback(e);\n  }\n\n  // We may want to force all options to be persisted including defaults, not just the ones passed the index creation function\n  this.persistence.persistNewState([{ $$indexCreated: options }], function (err) {\n    if (err) { return callback(err); }\n    return callback(null);\n  });\n};\n\n\n/**\n * Remove an index\n * @param {String} fieldName\n * @param {Function} cb Optional callback, signature: err\n */\nDatastore.prototype.removeIndex = function (fieldName, cb) {\n  var callback = cb || function () {};\n\n  delete this.indexes[fieldName];\n\n  this.persistence.persistNewState([{ $$indexRemoved: fieldName }], function (err) {\n    if (err) { return callback(err); }\n    return callback(null);\n  });\n};\n\n\n/**\n * Add one or several document(s) to all indexes\n */\nDatastore.prototype.addToIndexes = function (doc) {\n  var i, failingIndex, error\n    , keys = Object.keys(this.indexes)\n    ;\n\n  for (i = 0; i < keys.length; i += 1) {\n    try {\n      this.indexes[keys[i]].insert(doc);\n    } catch (e) {\n      failingIndex = i;\n      error = e;\n      break;\n    }\n  }\n\n  // If an error happened, we need to rollback the insert on all other indexes\n  if (error) {\n    for (i = 0; i < failingIndex; i += 1) {\n      this.indexes[keys[i]].remove(doc);\n    }\n\n    throw error;\n  }\n};\n\n\n/**\n * Remove one or several document(s) from all indexes\n */\nDatastore.prototype.removeFromIndexes = function (doc) {\n  var self = this;\n\n  Object.keys(this.indexes).forEach(function (i) {\n    self.indexes[i].remove(doc);\n  });\n};\n\n\n/**\n * Update one or several documents in all indexes\n * To update multiple documents, oldDoc must be an array of { oldDoc, newDoc } pairs\n * If one update violates a constraint, all changes are rolled back\n */\nDatastore.prototype.updateIndexes = function (oldDoc, newDoc) {\n  var i, failingIndex, error\n    , keys = Object.keys(this.indexes)\n    ;\n\n  for (i = 0; i < keys.length; i += 1) {\n    try {\n      this.indexes[keys[i]].update(oldDoc, newDoc);\n    } catch (e) {\n      failingIndex = i;\n      error = e;\n      break;\n    }\n  }\n\n  // If an error happened, we need to rollback the update on all other indexes\n  if (error) {\n    for (i = 0; i < failingIndex; i += 1) {\n      this.indexes[keys[i]].revertUpdate(oldDoc, newDoc);\n    }\n\n    throw error;\n  }\n};\n\n\n/**\n * Return the list of candidates for a given query\n * Crude implementation for now, we return the candidates given by the first usable index if any\n * We try the following query types, in this order: basic match, $in match, comparison match\n * One way to make it better would be to enable the use of multiple indexes if the first usable index\n * returns too much data. I may do it in the future.\n *\n * Returned candidates will be scanned to find and remove all expired documents\n *\n * @param {Query} query\n * @param {Boolean} dontExpireStaleDocs Optional, defaults to false, if true don't remove stale docs. Useful for the remove function which shouldn't be impacted by expirations\n * @param {Function} callback Signature err, docs\n */\nDatastore.prototype.getCandidates = function (query, dontExpireStaleDocs, callback) {\n  var indexNames = Object.keys(this.indexes)\n    , self = this\n    , usableQueryKeys;\n\n  if (typeof dontExpireStaleDocs === 'function') {\n    callback = dontExpireStaleDocs;\n    dontExpireStaleDocs = false;\n  }\n\n  async.waterfall([\n  // STEP 1: get candidates list by checking indexes from most to least frequent usecase\n  function (cb) {\n    // For a basic match\n    usableQueryKeys = [];\n    Object.keys(query).forEach(function (k) {\n      if (typeof query[k] === 'string' || typeof query[k] === 'number' || typeof query[k] === 'boolean' || util.isDate(query[k]) || query[k] === null) {\n        usableQueryKeys.push(k);\n      }\n    });\n    usableQueryKeys = _.intersection(usableQueryKeys, indexNames);\n    if (usableQueryKeys.length > 0) {\n      return cb(null, self.indexes[usableQueryKeys[0]].getMatching(query[usableQueryKeys[0]]));\n    }\n\n    // For a $in match\n    usableQueryKeys = [];\n    Object.keys(query).forEach(function (k) {\n      if (query[k] && query[k].hasOwnProperty('$in')) {\n        usableQueryKeys.push(k);\n      }\n    });\n    usableQueryKeys = _.intersection(usableQueryKeys, indexNames);\n    if (usableQueryKeys.length > 0) {\n      return cb(null, self.indexes[usableQueryKeys[0]].getMatching(query[usableQueryKeys[0]].$in));\n    }\n\n    // For a comparison match\n    usableQueryKeys = [];\n    Object.keys(query).forEach(function (k) {\n      if (query[k] && (query[k].hasOwnProperty('$lt') || query[k].hasOwnProperty('$lte') || query[k].hasOwnProperty('$gt') || query[k].hasOwnProperty('$gte'))) {\n        usableQueryKeys.push(k);\n      }\n    });\n    usableQueryKeys = _.intersection(usableQueryKeys, indexNames);\n    if (usableQueryKeys.length > 0) {\n      return cb(null, self.indexes[usableQueryKeys[0]].getBetweenBounds(query[usableQueryKeys[0]]));\n    }\n\n    // By default, return all the DB data\n    return cb(null, self.getAllData());\n  }\n  // STEP 2: remove all expired documents\n  , function (docs) {\n    if (dontExpireStaleDocs) { return callback(null, docs); }\n\n    var expiredDocsIds = [], validDocs = [], ttlIndexesFieldNames = Object.keys(self.ttlIndexes);\n\n    docs.forEach(function (doc) {\n      var valid = true;\n      ttlIndexesFieldNames.forEach(function (i) {\n        if (doc[i] !== undefined && util.isDate(doc[i]) && Date.now() > doc[i].getTime() + self.ttlIndexes[i] * 1000){\n          valid = false;\n        }\n      });\n      if (valid) { validDocs.push(doc); } else { expiredDocsIds.push(doc._id); }\n    });\n\n    async.eachSeries(expiredDocsIds, function (_id, cb) {\n      self._remove({ _id: _id }, {}, function (err) {\n        if (err) { return callback(err); }\n        return cb();\n      });\n    }, function (err) {\n      return callback(null, validDocs);\n    });\n  }]);\n};\n\n\n/**\n * Insert a new document\n * @param {Function} cb Optional callback, signature: err, insertedDoc\n *\n * @api private Use Datastore.insert which has the same signature\n */\nDatastore.prototype._insert = function (newDoc, cb) {\n  var callback = cb || function () {}\n    , preparedDoc\n    ;\n\n  try {\n    preparedDoc = this.prepareDocumentForInsertion(newDoc)\n    this._insertInCache(preparedDoc);\n  } catch (e) {\n    return callback(e);\n  }\n\n  this.persistence.persistNewState(util.isArray(preparedDoc) ? preparedDoc : [preparedDoc], function (err) {\n    if (err) { return callback(err); }\n    return callback(null, model.deepCopy(preparedDoc));\n  });\n};\n\n/**\n * Create a new _id that's not already in use\n */\nDatastore.prototype.createNewId = function () {\n  var tentativeId = customUtils.uid(16);\n  // Try as many times as needed to get an unused _id. As explained in customUtils, the probability of this ever happening is extremely small, so this is O(1)\n  if (this.indexes._id.getMatching(tentativeId).length > 0) {\n    tentativeId = this.createNewId();\n  }\n  return tentativeId;\n};\n\n/**\n * Prepare a document (or array of documents) to be inserted in a database\n * Meaning adds _id and timestamps if necessary on a copy of newDoc to avoid any side effect on user input\n * @api private\n */\nDatastore.prototype.prepareDocumentForInsertion = function (newDoc) {\n  var preparedDoc, self = this;\n\n  if (util.isArray(newDoc)) {\n    preparedDoc = [];\n    newDoc.forEach(function (doc) { preparedDoc.push(self.prepareDocumentForInsertion(doc)); });\n  } else {\n    preparedDoc = model.deepCopy(newDoc);\n    if (preparedDoc._id === undefined) { preparedDoc._id = this.createNewId(); }\n    var now = new Date();\n    if (this.timestampData && preparedDoc.createdAt === undefined) { preparedDoc.createdAt = now; }\n    if (this.timestampData && preparedDoc.updatedAt === undefined) { preparedDoc.updatedAt = now; }\n    model.checkObject(preparedDoc);\n  }\n\n  return preparedDoc;\n};\n\n/**\n * If newDoc is an array of documents, this will insert all documents in the cache\n * @api private\n */\nDatastore.prototype._insertInCache = function (preparedDoc) {\n  if (util.isArray(preparedDoc)) {\n    this._insertMultipleDocsInCache(preparedDoc);\n  } else {\n    this.addToIndexes(preparedDoc);\n  }\n};\n\n/**\n * If one insertion fails (e.g. because of a unique constraint), roll back all previous\n * inserts and throws the error\n * @api private\n */\nDatastore.prototype._insertMultipleDocsInCache = function (preparedDocs) {\n  var i, failingI, error;\n\n  for (i = 0; i < preparedDocs.length; i += 1) {\n    try {\n      this.addToIndexes(preparedDocs[i]);\n    } catch (e) {\n      error = e;\n      failingI = i;\n      break;\n    }\n  }\n\n  if (error) {\n    for (i = 0; i < failingI; i += 1) {\n      this.removeFromIndexes(preparedDocs[i]);\n    }\n\n    throw error;\n  }\n};\n\nDatastore.prototype.insert = function () {\n  this.executor.push({ this: this, fn: this._insert, arguments: arguments });\n};\n\n\n/**\n * Count all documents matching the query\n * @param {Object} query MongoDB-style query\n */\nDatastore.prototype.count = function(query, callback) {\n  var cursor = new Cursor(this, query, function(err, docs, callback) {\n    if (err) { return callback(err); }\n    return callback(null, docs.length);\n  });\n\n  if (typeof callback === 'function') {\n    cursor.exec(callback);\n  } else {\n    return cursor;\n  }\n};\n\n\n/**\n * Find all documents matching the query\n * If no callback is passed, we return the cursor so that user can limit, skip and finally exec\n * @param {Object} query MongoDB-style query\n * @param {Object} projection MongoDB-style projection\n */\nDatastore.prototype.find = function (query, projection, callback) {\n  switch (arguments.length) {\n    case 1:\n      projection = {};\n      // callback is undefined, will return a cursor\n      break;\n    case 2:\n      if (typeof projection === 'function') {\n        callback = projection;\n        projection = {};\n      }   // If not assume projection is an object and callback undefined\n      break;\n  }\n\n  var cursor = new Cursor(this, query, function(err, docs, callback) {\n    var res = [], i;\n\n    if (err) { return callback(err); }\n\n    for (i = 0; i < docs.length; i += 1) {\n      res.push(model.deepCopy(docs[i]));\n    }\n    return callback(null, res);\n  });\n\n  cursor.projection(projection);\n  if (typeof callback === 'function') {\n    cursor.exec(callback);\n  } else {\n    return cursor;\n  }\n};\n\n\n/**\n * Find one document matching the query\n * @param {Object} query MongoDB-style query\n * @param {Object} projection MongoDB-style projection\n */\nDatastore.prototype.findOne = function (query, projection, callback) {\n  switch (arguments.length) {\n    case 1:\n      projection = {};\n      // callback is undefined, will return a cursor\n      break;\n    case 2:\n      if (typeof projection === 'function') {\n        callback = projection;\n        projection = {};\n      }   // If not assume projection is an object and callback undefined\n      break;\n  }\n\n  var cursor = new Cursor(this, query, function(err, docs, callback) {\n    if (err) { return callback(err); }\n    if (docs.length === 1) {\n      return callback(null, model.deepCopy(docs[0]));\n    } else {\n      return callback(null, null);\n    }\n  });\n\n  cursor.projection(projection).limit(1);\n  if (typeof callback === 'function') {\n    cursor.exec(callback);\n  } else {\n    return cursor;\n  }\n};\n\n\n/**\n * Update all docs matching query\n * @param {Object} query\n * @param {Object} updateQuery\n * @param {Object} options Optional options\n *                 options.multi If true, can update multiple documents (defaults to false)\n *                 options.upsert If true, document is inserted if the query doesn't match anything\n *                 options.returnUpdatedDocs Defaults to false, if true return as third argument the array of updated matched documents (even if no change actually took place)\n * @param {Function} cb Optional callback, signature: (err, numAffected, affectedDocuments, upsert)\n *                      If update was an upsert, upsert flag is set to true\n *                      affectedDocuments can be one of the following:\n *                        * For an upsert, the upserted document\n *                        * For an update with returnUpdatedDocs option false, null\n *                        * For an update with returnUpdatedDocs true and multi false, the updated document\n *                        * For an update with returnUpdatedDocs true and multi true, the array of updated documents\n *\n * WARNING: The API was changed between v1.7.4 and v1.8, for consistency and readability reasons. Prior and including to v1.7.4,\n *          the callback signature was (err, numAffected, updated) where updated was the updated document in case of an upsert\n *          or the array of updated documents for an update if the returnUpdatedDocs option was true. That meant that the type of\n *          affectedDocuments in a non multi update depended on whether there was an upsert or not, leaving only two ways for the\n *          user to check whether an upsert had occured: checking the type of affectedDocuments or running another find query on\n *          the whole dataset to check its size. Both options being ugly, the breaking change was necessary.\n *\n * @api private Use Datastore.update which has the same signature\n */\nDatastore.prototype._update = function (query, updateQuery, options, cb) {\n  var callback\n    , self = this\n    , numReplaced = 0\n    , multi, upsert\n    , i\n    ;\n\n  if (typeof options === 'function') { cb = options; options = {}; }\n  callback = cb || function () {};\n  multi = options.multi !== undefined ? options.multi : false;\n  upsert = options.upsert !== undefined ? options.upsert : false;\n\n  async.waterfall([\n  function (cb) {   // If upsert option is set, check whether we need to insert the doc\n    if (!upsert) { return cb(); }\n\n    // Need to use an internal function not tied to the executor to avoid deadlock\n    var cursor = new Cursor(self, query);\n    cursor.limit(1)._exec(function (err, docs) {\n      if (err) { return callback(err); }\n      if (docs.length === 1) {\n        return cb();\n      } else {\n        var toBeInserted;\n\n        try {\n          model.checkObject(updateQuery);\n          // updateQuery is a simple object with no modifier, use it as the document to insert\n          toBeInserted = updateQuery;\n        } catch (e) {\n          // updateQuery contains modifiers, use the find query as the base,\n          // strip it from all operators and update it according to updateQuery\n          try {\n            toBeInserted = model.modify(model.deepCopy(query, true), updateQuery);\n          } catch (err) {\n            return callback(err);\n          }\n        }\n\n        return self._insert(toBeInserted, function (err, newDoc) {\n          if (err) { return callback(err); }\n          return callback(null, 1, newDoc, true);\n        });\n      }\n    });\n  }\n  , function () {   // Perform the update\n    var modifiedDoc , modifications = [], createdAt;\n\n    self.getCandidates(query, function (err, candidates) {\n      if (err) { return callback(err); }\n\n      // Preparing update (if an error is thrown here neither the datafile nor\n      // the in-memory indexes are affected)\n      try {\n        for (i = 0; i < candidates.length; i += 1) {\n          if (model.match(candidates[i], query) && (multi || numReplaced === 0)) {\n            numReplaced += 1;\n            if (self.timestampData) { createdAt = candidates[i].createdAt; }\n            modifiedDoc = model.modify(candidates[i], updateQuery);\n            if (self.timestampData) {\n              modifiedDoc.createdAt = createdAt;\n              modifiedDoc.updatedAt = new Date();\n            }\n            modifications.push({ oldDoc: candidates[i], newDoc: modifiedDoc });\n          }\n        }\n      } catch (err) {\n        return callback(err);\n      }\n\n      // Change the docs in memory\n      try {\n        self.updateIndexes(modifications);\n      } catch (err) {\n        return callback(err);\n      }\n\n      // Update the datafile\n      var updatedDocs = _.pluck(modifications, 'newDoc');\n      self.persistence.persistNewState(updatedDocs, function (err) {\n        if (err) { return callback(err); }\n        if (!options.returnUpdatedDocs) {\n          return callback(null, numReplaced);\n        } else {\n          var updatedDocsDC = [];\n          updatedDocs.forEach(function (doc) { updatedDocsDC.push(model.deepCopy(doc)); });\n          if (! multi) { updatedDocsDC = updatedDocsDC[0]; }\n          return callback(null, numReplaced, updatedDocsDC);\n        }\n      });\n    });\n  }]);\n};\n\nDatastore.prototype.update = function () {\n  this.executor.push({ this: this, fn: this._update, arguments: arguments });\n};\n\n\n/**\n * Remove all docs matching the query\n * For now very naive implementation (similar to update)\n * @param {Object} query\n * @param {Object} options Optional options\n *                 options.multi If true, can update multiple documents (defaults to false)\n * @param {Function} cb Optional callback, signature: err, numRemoved\n *\n * @api private Use Datastore.remove which has the same signature\n */\nDatastore.prototype._remove = function (query, options, cb) {\n  var callback\n    , self = this, numRemoved = 0, removedDocs = [], multi\n    ;\n\n  if (typeof options === 'function') { cb = options; options = {}; }\n  callback = cb || function () {};\n  multi = options.multi !== undefined ? options.multi : false;\n\n  this.getCandidates(query, true, function (err, candidates) {\n    if (err) { return callback(err); }\n\n    try {\n      candidates.forEach(function (d) {\n        if (model.match(d, query) && (multi || numRemoved === 0)) {\n          numRemoved += 1;\n          removedDocs.push({ $$deleted: true, _id: d._id });\n          self.removeFromIndexes(d);\n        }\n      });\n    } catch (err) { return callback(err); }\n\n    self.persistence.persistNewState(removedDocs, function (err) {\n      if (err) { return callback(err); }\n      return callback(null, numRemoved);\n    });\n  });\n};\n\nDatastore.prototype.remove = function () {\n  this.executor.push({ this: this, fn: this._remove, arguments: arguments });\n};\n\n\n\nmodule.exports = Datastore;\n","module.exports = require(\"crypto\");","/**\n * Responsible for sequentially executing actions on the database\n */\n\nvar async = require('async')\n  ;\n\nfunction Executor () {\n  this.buffer = [];\n  this.ready = false;\n\n  // This queue will execute all commands, one-by-one in order\n  this.queue = async.queue(function (task, cb) {\n    var newArguments = [];\n\n    // task.arguments is an array-like object on which adding a new field doesn't work, so we transform it into a real array\n    for (var i = 0; i < task.arguments.length; i += 1) { newArguments.push(task.arguments[i]); }\n    var lastArg = task.arguments[task.arguments.length - 1];\n\n    // Always tell the queue task is complete. Execute callback if any was given.\n    if (typeof lastArg === 'function') {\n      // Callback was supplied\n      newArguments[newArguments.length - 1] = function () {\n        if (typeof setImmediate === 'function') {\n           setImmediate(cb);\n        } else {\n          process.nextTick(cb);\n        }\n        lastArg.apply(null, arguments);\n      };\n    } else if (!lastArg && task.arguments.length !== 0) {\n      // false/undefined/null supplied as callbback\n      newArguments[newArguments.length - 1] = function () { cb(); };\n    } else {\n      // Nothing supplied as callback\n      newArguments.push(function () { cb(); });\n    }\n\n\n    task.fn.apply(task.this, newArguments);\n  }, 1);\n}\n\n\n/**\n * If executor is ready, queue task (and process it immediately if executor was idle)\n * If not, buffer task for later processing\n * @param {Object} task\n *                 task.this - Object to use as this\n *                 task.fn - Function to execute\n *                 task.arguments - Array of arguments, IMPORTANT: only the last argument may be a function (the callback)\n *                                                                 and the last argument cannot be false/undefined/null\n * @param {Boolean} forceQueuing Optional (defaults to false) force executor to queue task even if it is not ready\n */\nExecutor.prototype.push = function (task, forceQueuing) {\n  if (this.ready || forceQueuing) {\n    this.queue.push(task);\n  } else {\n    this.buffer.push(task);\n  }\n};\n\n\n/**\n * Queue all tasks in buffer (in the same order they came in)\n * Automatically sets executor as ready\n */\nExecutor.prototype.processBuffer = function () {\n  var i;\n  this.ready = true;\n  for (i = 0; i < this.buffer.length; i += 1) { this.queue.push(this.buffer[i]); }\n  this.buffer = [];\n};\n\n\n\n// Interface\nmodule.exports = Executor;\n","module.exports.BinarySearchTree = require('./lib/bst');\nmodule.exports.AVLTree = require('./lib/avltree');\n","/**\n * Self-balancing binary search tree using the AVL implementation\n */\nvar BinarySearchTree = require('./bst')\n  , customUtils = require('./customUtils')\n  , util = require('util')\n  , _ = require('underscore')\n  ;\n\n\n/**\n * Constructor\n * We can't use a direct pointer to the root node (as in the simple binary search tree)\n * as the root will change during tree rotations\n * @param {Boolean}  options.unique Whether to enforce a 'unique' constraint on the key or not\n * @param {Function} options.compareKeys Initialize this BST's compareKeys\n */\nfunction AVLTree (options) {\n  this.tree = new _AVLTree(options);\n}\n\n\n/**\n * Constructor of the internal AVLTree\n * @param {Object} options Optional\n * @param {Boolean}  options.unique Whether to enforce a 'unique' constraint on the key or not\n * @param {Key}      options.key Initialize this BST's key with key\n * @param {Value}    options.value Initialize this BST's data with [value]\n * @param {Function} options.compareKeys Initialize this BST's compareKeys\n */\nfunction _AVLTree (options) {\n  options = options || {};\n\n  this.left = null;\n  this.right = null;\n  this.parent = options.parent !== undefined ? options.parent : null;\n  if (options.hasOwnProperty('key')) { this.key = options.key; }\n  this.data = options.hasOwnProperty('value') ? [options.value] : [];\n  this.unique = options.unique || false;\n\n  this.compareKeys = options.compareKeys || customUtils.defaultCompareKeysFunction;\n  this.checkValueEquality = options.checkValueEquality || customUtils.defaultCheckValueEquality;\n}\n\n\n/**\n * Inherit basic functions from the basic binary search tree\n */\nutil.inherits(_AVLTree, BinarySearchTree);\n\n/**\n * Keep a pointer to the internal tree constructor for testing purposes\n */\nAVLTree._AVLTree = _AVLTree;\n\n\n/**\n * Check the recorded height is correct for every node\n * Throws if one height doesn't match\n */\n_AVLTree.prototype.checkHeightCorrect = function () {\n  var leftH, rightH;\n\n  if (!this.hasOwnProperty('key')) { return; }   // Empty tree\n\n  if (this.left && this.left.height === undefined) { throw new Error(\"Undefined height for node \" + this.left.key); }\n  if (this.right && this.right.height === undefined) { throw new Error(\"Undefined height for node \" + this.right.key); }\n  if (this.height === undefined) { throw new Error(\"Undefined height for node \" + this.key); }\n\n  leftH = this.left ? this.left.height : 0;\n  rightH = this.right ? this.right.height : 0;\n\n  if (this.height !== 1 + Math.max(leftH, rightH)) { throw new Error(\"Height constraint failed for node \" + this.key); }\n  if (this.left) { this.left.checkHeightCorrect(); }\n  if (this.right) { this.right.checkHeightCorrect(); }\n};\n\n\n/**\n * Return the balance factor\n */\n_AVLTree.prototype.balanceFactor = function () {\n  var leftH = this.left ? this.left.height : 0\n    , rightH = this.right ? this.right.height : 0\n    ;\n  return leftH - rightH;\n};\n\n\n/**\n * Check that the balance factors are all between -1 and 1\n */\n_AVLTree.prototype.checkBalanceFactors = function () {\n  if (Math.abs(this.balanceFactor()) > 1) { throw new Error('Tree is unbalanced at node ' + this.key); }\n\n  if (this.left) { this.left.checkBalanceFactors(); }\n  if (this.right) { this.right.checkBalanceFactors(); }\n};\n\n\n/**\n * When checking if the BST conditions are met, also check that the heights are correct\n * and the tree is balanced\n */\n_AVLTree.prototype.checkIsAVLT = function () {\n  _AVLTree.super_.prototype.checkIsBST.call(this);\n  this.checkHeightCorrect();\n  this.checkBalanceFactors();\n};\nAVLTree.prototype.checkIsAVLT = function () { this.tree.checkIsAVLT(); };\n\n\n/**\n * Perform a right rotation of the tree if possible\n * and return the root of the resulting tree\n * The resulting tree's nodes' heights are also updated\n */\n_AVLTree.prototype.rightRotation = function () {\n  var q = this\n    , p = this.left\n    , b\n    , ah, bh, ch;\n\n  if (!p) { return this; }   // No change\n\n  b = p.right;\n\n  // Alter tree structure\n  if (q.parent) {\n    p.parent = q.parent;\n    if (q.parent.left === q) { q.parent.left = p; } else { q.parent.right = p; }\n  } else {\n    p.parent = null;\n  }\n  p.right = q;\n  q.parent = p;\n  q.left = b;\n  if (b) { b.parent = q; }\n\n  // Update heights\n  ah = p.left ? p.left.height : 0;\n  bh = b ? b.height : 0;\n  ch = q.right ? q.right.height : 0;\n  q.height = Math.max(bh, ch) + 1;\n  p.height = Math.max(ah, q.height) + 1;\n\n  return p;\n};\n\n\n/**\n * Perform a left rotation of the tree if possible\n * and return the root of the resulting tree\n * The resulting tree's nodes' heights are also updated\n */\n_AVLTree.prototype.leftRotation = function () {\n  var p = this\n    , q = this.right\n    , b\n    , ah, bh, ch;\n\n  if (!q) { return this; }   // No change\n\n  b = q.left;\n\n  // Alter tree structure\n  if (p.parent) {\n    q.parent = p.parent;\n    if (p.parent.left === p) { p.parent.left = q; } else { p.parent.right = q; }\n  } else {\n    q.parent = null;\n  }\n  q.left = p;\n  p.parent = q;\n  p.right = b;\n  if (b) { b.parent = p; }\n\n  // Update heights\n  ah = p.left ? p.left.height : 0;\n  bh = b ? b.height : 0;\n  ch = q.right ? q.right.height : 0;\n  p.height = Math.max(ah, bh) + 1;\n  q.height = Math.max(ch, p.height) + 1;\n\n  return q;\n};\n\n\n/**\n * Modify the tree if its right subtree is too small compared to the left\n * Return the new root if any\n */\n_AVLTree.prototype.rightTooSmall = function () {\n  if (this.balanceFactor() <= 1) { return this; }   // Right is not too small, don't change\n\n  if (this.left.balanceFactor() < 0) {\n    this.left.leftRotation();\n  }\n\n  return this.rightRotation();\n};\n\n\n/**\n * Modify the tree if its left subtree is too small compared to the right\n * Return the new root if any\n */\n_AVLTree.prototype.leftTooSmall = function () {\n  if (this.balanceFactor() >= -1) { return this; }   // Left is not too small, don't change\n\n  if (this.right.balanceFactor() > 0) {\n    this.right.rightRotation();\n  }\n\n  return this.leftRotation();\n};\n\n\n/**\n * Rebalance the tree along the given path. The path is given reversed (as he was calculated\n * in the insert and delete functions).\n * Returns the new root of the tree\n * Of course, the first element of the path must be the root of the tree\n */\n_AVLTree.prototype.rebalanceAlongPath = function (path) {\n  var newRoot = this\n    , rotated\n    , i;\n\n  if (!this.hasOwnProperty('key')) { delete this.height; return this; }   // Empty tree\n\n  // Rebalance the tree and update all heights\n  for (i = path.length - 1; i >= 0; i -= 1) {\n    path[i].height = 1 + Math.max(path[i].left ? path[i].left.height : 0, path[i].right ? path[i].right.height : 0);\n\n    if (path[i].balanceFactor() > 1) {\n      rotated = path[i].rightTooSmall();\n      if (i === 0) { newRoot = rotated; }\n    }\n\n    if (path[i].balanceFactor() < -1) {\n      rotated = path[i].leftTooSmall();\n      if (i === 0) { newRoot = rotated; }\n    }\n  }\n\n  return newRoot;\n};\n\n\n/**\n * Insert a key, value pair in the tree while maintaining the AVL tree height constraint\n * Return a pointer to the root node, which may have changed\n */\n_AVLTree.prototype.insert = function (key, value) {\n  var insertPath = []\n    , currentNode = this\n    ;\n\n  // Empty tree, insert as root\n  if (!this.hasOwnProperty('key')) {\n    this.key = key;\n    this.data.push(value);\n    this.height = 1;\n    return this;\n  }\n\n  // Insert new leaf at the right place\n  while (true) {\n    // Same key: no change in the tree structure\n    if (currentNode.compareKeys(currentNode.key, key) === 0) {\n      if (currentNode.unique) {\n        var err = new Error(\"Can't insert key \" + key + \", it violates the unique constraint\");\n        err.key = key;\n        err.errorType = 'uniqueViolated';\n        throw err;\n      } else {\n        currentNode.data.push(value);\n      }\n      return this;\n    }\n\n    insertPath.push(currentNode);\n\n    if (currentNode.compareKeys(key, currentNode.key) < 0) {\n      if (!currentNode.left) {\n        insertPath.push(currentNode.createLeftChild({ key: key, value: value }));\n        break;\n      } else {\n        currentNode = currentNode.left;\n      }\n    } else {\n      if (!currentNode.right) {\n        insertPath.push(currentNode.createRightChild({ key: key, value: value }));\n        break;\n      } else {\n        currentNode = currentNode.right;\n      }\n    }\n  }\n\n  return this.rebalanceAlongPath(insertPath);\n};\n\n// Insert in the internal tree, update the pointer to the root if needed\nAVLTree.prototype.insert = function (key, value) {\n  var newTree = this.tree.insert(key, value);\n\n  // If newTree is undefined, that means its structure was not modified\n  if (newTree) { this.tree = newTree; }\n};\n\n\n/**\n * Delete a key or just a value and return the new root of the tree\n * @param {Key} key\n * @param {Value} value Optional. If not set, the whole key is deleted. If set, only this value is deleted\n */\n_AVLTree.prototype.delete = function (key, value) {\n  var newData = [], replaceWith\n    , self = this\n    , currentNode = this\n    , deletePath = []\n    ;\n\n  if (!this.hasOwnProperty('key')) { return this; }   // Empty tree\n\n  // Either no match is found and the function will return from within the loop\n  // Or a match is found and deletePath will contain the path from the root to the node to delete after the loop\n  while (true) {\n    if (currentNode.compareKeys(key, currentNode.key) === 0) { break; }\n\n    deletePath.push(currentNode);\n\n    if (currentNode.compareKeys(key, currentNode.key) < 0) {\n      if (currentNode.left) {\n        currentNode = currentNode.left;\n      } else {\n        return this;   // Key not found, no modification\n      }\n    } else {\n      // currentNode.compareKeys(key, currentNode.key) is > 0\n      if (currentNode.right) {\n        currentNode = currentNode.right;\n      } else {\n        return this;   // Key not found, no modification\n      }\n    }\n  }\n\n  // Delete only a value (no tree modification)\n  if (currentNode.data.length > 1 && value) {\n    currentNode.data.forEach(function (d) {\n      if (!currentNode.checkValueEquality(d, value)) { newData.push(d); }\n    });\n    currentNode.data = newData;\n    return this;\n  }\n\n  // Delete a whole node\n\n  // Leaf\n  if (!currentNode.left && !currentNode.right) {\n    if (currentNode === this) {   // This leaf is also the root\n      delete currentNode.key;\n      currentNode.data = [];\n      delete currentNode.height;\n      return this;\n    } else {\n      if (currentNode.parent.left === currentNode) {\n        currentNode.parent.left = null;\n      } else {\n        currentNode.parent.right = null;\n      }\n      return this.rebalanceAlongPath(deletePath);\n    }\n  }\n\n\n  // Node with only one child\n  if (!currentNode.left || !currentNode.right) {\n    replaceWith = currentNode.left ? currentNode.left : currentNode.right;\n\n    if (currentNode === this) {   // This node is also the root\n      replaceWith.parent = null;\n      return replaceWith;   // height of replaceWith is necessarily 1 because the tree was balanced before deletion\n    } else {\n      if (currentNode.parent.left === currentNode) {\n        currentNode.parent.left = replaceWith;\n        replaceWith.parent = currentNode.parent;\n      } else {\n        currentNode.parent.right = replaceWith;\n        replaceWith.parent = currentNode.parent;\n      }\n\n      return this.rebalanceAlongPath(deletePath);\n    }\n  }\n\n\n  // Node with two children\n  // Use the in-order predecessor (no need to randomize since we actively rebalance)\n  deletePath.push(currentNode);\n  replaceWith = currentNode.left;\n\n  // Special case: the in-order predecessor is right below the node to delete\n  if (!replaceWith.right) {\n    currentNode.key = replaceWith.key;\n    currentNode.data = replaceWith.data;\n    currentNode.left = replaceWith.left;\n    if (replaceWith.left) { replaceWith.left.parent = currentNode; }\n    return this.rebalanceAlongPath(deletePath);\n  }\n\n  // After this loop, replaceWith is the right-most leaf in the left subtree\n  // and deletePath the path from the root (inclusive) to replaceWith (exclusive)\n  while (true) {\n    if (replaceWith.right) {\n      deletePath.push(replaceWith);\n      replaceWith = replaceWith.right;\n    } else {\n      break;\n    }\n  }\n\n  currentNode.key = replaceWith.key;\n  currentNode.data = replaceWith.data;\n\n  replaceWith.parent.right = replaceWith.left;\n  if (replaceWith.left) { replaceWith.left.parent = replaceWith.parent; }\n\n  return this.rebalanceAlongPath(deletePath);\n};\n\n// Delete a value\nAVLTree.prototype.delete = function (key, value) {\n  var newTree = this.tree.delete(key, value);\n\n  // If newTree is undefined, that means its structure was not modified\n  if (newTree) { this.tree = newTree; }\n};\n\n\n/**\n * Other functions we want to use on an AVLTree as if it were the internal _AVLTree\n */\n['getNumberOfKeys', 'search', 'betweenBounds', 'prettyPrint', 'executeOnEveryNode'].forEach(function (fn) {\n  AVLTree.prototype[fn] = function () {\n    return this.tree[fn].apply(this.tree, arguments);\n  };\n});\n\n\n// Interface\nmodule.exports = AVLTree;\n","/**\n * Handle every persistence-related task\n * The interface Datastore expects to be implemented is\n * * Persistence.loadDatabase(callback) and callback has signature err\n * * Persistence.persistNewState(newDocs, callback) where newDocs is an array of documents and callback has signature err\n */\n\nvar storage = require('./storage')\n  , path = require('path')\n  , model = require('./model')\n  , async = require('async')\n  , customUtils = require('./customUtils')\n  , Index = require('./indexes')\n  ;\n\n\n/**\n * Create a new Persistence object for database options.db\n * @param {Datastore} options.db\n * @param {Boolean} options.nodeWebkitAppName Optional, specify the name of your NW app if you want options.filename to be relative to the directory where\n *                                            Node Webkit stores application data such as cookies and local storage (the best place to store data in my opinion)\n */\nfunction Persistence (options) {\n  var i, j, randomString;\n\n  this.db = options.db;\n  this.inMemoryOnly = this.db.inMemoryOnly;\n  this.filename = this.db.filename;\n  this.corruptAlertThreshold = options.corruptAlertThreshold !== undefined ? options.corruptAlertThreshold : 0.1;\n\n  if (!this.inMemoryOnly && this.filename && this.filename.charAt(this.filename.length - 1) === '~') {\n    throw new Error(\"The datafile name can't end with a ~, which is reserved for crash safe backup files\");\n  }\n\n  // After serialization and before deserialization hooks with some basic sanity checks\n  if (options.afterSerialization && !options.beforeDeserialization) {\n    throw new Error(\"Serialization hook defined but deserialization hook undefined, cautiously refusing to start NeDB to prevent dataloss\");\n  }\n  if (!options.afterSerialization && options.beforeDeserialization) {\n    throw new Error(\"Serialization hook undefined but deserialization hook defined, cautiously refusing to start NeDB to prevent dataloss\");\n  }\n  this.afterSerialization = options.afterSerialization || function (s) { return s; };\n  this.beforeDeserialization = options.beforeDeserialization || function (s) { return s; };\n  for (i = 1; i < 30; i += 1) {\n    for (j = 0; j < 10; j += 1) {\n      randomString = customUtils.uid(i);\n      if (this.beforeDeserialization(this.afterSerialization(randomString)) !== randomString) {\n        throw new Error(\"beforeDeserialization is not the reverse of afterSerialization, cautiously refusing to start NeDB to prevent dataloss\");\n      }\n    }\n  }\n\n  // For NW apps, store data in the same directory where NW stores application data\n  if (this.filename && options.nodeWebkitAppName) {\n    console.log(\"==================================================================\");\n    console.log(\"WARNING: The nodeWebkitAppName option is deprecated\");\n    console.log(\"To get the path to the directory where Node Webkit stores the data\");\n    console.log(\"for your app, use the internal nw.gui module like this\");\n    console.log(\"require('nw.gui').App.dataPath\");\n    console.log(\"See https://github.com/rogerwang/node-webkit/issues/500\");\n    console.log(\"==================================================================\");\n    this.filename = Persistence.getNWAppFilename(options.nodeWebkitAppName, this.filename);\n  }\n};\n\n\n/**\n * Check if a directory exists and create it on the fly if it is not the case\n * cb is optional, signature: err\n */\nPersistence.ensureDirectoryExists = function (dir, cb) {\n  var callback = cb || function () {}\n    ;\n\n  storage.mkdirp(dir, function (err) { return callback(err); });\n};\n\n\n\n\n/**\n * Return the path the datafile if the given filename is relative to the directory where Node Webkit stores\n * data for this application. Probably the best place to store data\n */\nPersistence.getNWAppFilename = function (appName, relativeFilename) {\n  var home;\n\n  switch (process.platform) {\n    case 'win32':\n    case 'win64':\n      home = process.env.LOCALAPPDATA || process.env.APPDATA;\n      if (!home) { throw new Error(\"Couldn't find the base application data folder\"); }\n      home = path.join(home, appName);\n      break;\n    case 'darwin':\n      home = process.env.HOME;\n      if (!home) { throw new Error(\"Couldn't find the base application data directory\"); }\n      home = path.join(home, 'Library', 'Application Support', appName);\n      break;\n    case 'linux':\n      home = process.env.HOME;\n      if (!home) { throw new Error(\"Couldn't find the base application data directory\"); }\n      home = path.join(home, '.config', appName);\n      break;\n    default:\n      throw new Error(\"Can't use the Node Webkit relative path for platform \" + process.platform);\n      break;\n  }\n\n  return path.join(home, 'nedb-data', relativeFilename);\n}\n\n\n/**\n * Persist cached database\n * This serves as a compaction function since the cache always contains only the number of documents in the collection\n * while the data file is append-only so it may grow larger\n * @param {Function} cb Optional callback, signature: err\n */\nPersistence.prototype.persistCachedDatabase = function (cb) {\n  var callback = cb || function () {}\n    , toPersist = ''\n    , self = this\n    ;\n\n  if (this.inMemoryOnly) { return callback(null); }\n\n  this.db.getAllData().forEach(function (doc) {\n    toPersist += self.afterSerialization(model.serialize(doc)) + '\\n';\n  });\n  Object.keys(this.db.indexes).forEach(function (fieldName) {\n    if (fieldName != \"_id\") {   // The special _id index is managed by datastore.js, the others need to be persisted\n      toPersist += self.afterSerialization(model.serialize({ $$indexCreated: { fieldName: fieldName, unique: self.db.indexes[fieldName].unique, sparse: self.db.indexes[fieldName].sparse }})) + '\\n';\n    }\n  });\n\n  storage.crashSafeWriteFile(this.filename, toPersist, function (err) {\n    if (err) { return callback(err); }\n    self.db.emit('compaction.done');\n    return callback(null);\n  });\n};\n\n\n/**\n * Queue a rewrite of the datafile\n */\nPersistence.prototype.compactDatafile = function () {\n  this.db.executor.push({ this: this, fn: this.persistCachedDatabase, arguments: [] });\n};\n\n\n/**\n * Set automatic compaction every interval ms\n * @param {Number} interval in milliseconds, with an enforced minimum of 5 seconds\n */\nPersistence.prototype.setAutocompactionInterval = function (interval) {\n  var self = this\n    , minInterval = 5000\n    , realInterval = Math.max(interval || 0, minInterval)\n    ;\n\n  this.stopAutocompaction();\n\n  this.autocompactionIntervalId = setInterval(function () {\n    self.compactDatafile();\n  }, realInterval);\n};\n\n\n/**\n * Stop autocompaction (do nothing if autocompaction was not running)\n */\nPersistence.prototype.stopAutocompaction = function () {\n  if (this.autocompactionIntervalId) { clearInterval(this.autocompactionIntervalId); }\n};\n\n\n/**\n * Persist new state for the given newDocs (can be insertion, update or removal)\n * Use an append-only format\n * @param {Array} newDocs Can be empty if no doc was updated/removed\n * @param {Function} cb Optional, signature: err\n */\nPersistence.prototype.persistNewState = function (newDocs, cb) {\n  var self = this\n    , toPersist = ''\n    , callback = cb || function () {}\n    ;\n\n  // In-memory only datastore\n  if (self.inMemoryOnly) { return callback(null); }\n\n  newDocs.forEach(function (doc) {\n    toPersist += self.afterSerialization(model.serialize(doc)) + '\\n';\n  });\n\n  if (toPersist.length === 0) { return callback(null); }\n\n  storage.appendFile(self.filename, toPersist, 'utf8', function (err) {\n    return callback(err);\n  });\n};\n\n\n/**\n * From a database's raw data, return the corresponding\n * machine understandable collection\n */\nPersistence.prototype.treatRawData = function (rawData) {\n  var data = rawData.split('\\n')\n    , dataById = {}\n    , tdata = []\n    , i\n    , indexes = {}\n    , corruptItems = -1   // Last line of every data file is usually blank so not really corrupt\n    ;\n\n  for (i = 0; i < data.length; i += 1) {\n    var doc;\n\n    try {\n      doc = model.deserialize(this.beforeDeserialization(data[i]));\n      if (doc._id) {\n        if (doc.$$deleted === true) {\n          delete dataById[doc._id];\n        } else {\n          dataById[doc._id] = doc;\n        }\n      } else if (doc.$$indexCreated && doc.$$indexCreated.fieldName != undefined) {\n        indexes[doc.$$indexCreated.fieldName] = doc.$$indexCreated;\n      } else if (typeof doc.$$indexRemoved === \"string\") {\n        delete indexes[doc.$$indexRemoved];\n      }\n    } catch (e) {\n      corruptItems += 1;\n    }\n  }\n\n  // A bit lenient on corruption\n  if (data.length > 0 && corruptItems / data.length > this.corruptAlertThreshold) {\n    throw new Error(\"More than \" + Math.floor(100 * this.corruptAlertThreshold) + \"% of the data file is corrupt, the wrong beforeDeserialization hook may be used. Cautiously refusing to start NeDB to prevent dataloss\");\n  }\n\n  Object.keys(dataById).forEach(function (k) {\n    tdata.push(dataById[k]);\n  });\n\n  return { data: tdata, indexes: indexes };\n};\n\n\n/**\n * Load the database\n * 1) Create all indexes\n * 2) Insert all data\n * 3) Compact the database\n * This means pulling data out of the data file or creating it if it doesn't exist\n * Also, all data is persisted right away, which has the effect of compacting the database file\n * This operation is very quick at startup for a big collection (60ms for ~10k docs)\n * @param {Function} cb Optional callback, signature: err\n */\nPersistence.prototype.loadDatabase = function (cb) {\n  var callback = cb || function () {}\n    , self = this\n    ;\n\n  self.db.resetIndexes();\n\n  // In-memory only datastore\n  if (self.inMemoryOnly) { return callback(null); }\n\n  async.waterfall([\n    function (cb) {\n      Persistence.ensureDirectoryExists(path.dirname(self.filename), function (err) {\n        storage.ensureDatafileIntegrity(self.filename, function (err) {\n          storage.readFile(self.filename, 'utf8', function (err, rawData) {\n            if (err) { return cb(err); }\n\n            try {\n              var treatedData = self.treatRawData(rawData);\n            } catch (e) {\n              return cb(e);\n            }\n\n            // Recreate all indexes in the datafile\n            Object.keys(treatedData.indexes).forEach(function (key) {\n              self.db.indexes[key] = new Index(treatedData.indexes[key]);\n            });\n\n            // Fill cached database (i.e. all indexes) with data\n            try {\n              self.db.resetIndexes(treatedData.data);\n            } catch (e) {\n              self.db.resetIndexes();   // Rollback any index which didn't fail\n              return cb(e);\n            }\n\n            self.db.persistence.persistCachedDatabase(cb);\n          });\n        });\n      });\n    }\n  ], function (err) {\n       if (err) { return callback(err); }\n\n       self.db.executor.processBuffer();\n       return callback(null);\n     });\n};\n\n\n// Interface\nmodule.exports = Persistence;\n","/**\n * Way data is stored for this database\n * For a Node.js/Node Webkit database it's the file system\n * For a browser-side database it's localforage which chooses the best option depending on user browser (IndexedDB then WebSQL then localStorage)\n *\n * This version is the Node.js/Node Webkit version\n * It's essentially fs, mkdirp and crash safe write and read functions\n */\n\nvar fs = require('fs')\n  , mkdirp = require('mkdirp')\n  , async = require('async')\n  , path = require('path')\n  , storage = {}\n  ;\n\nstorage.exists = fs.exists;\nstorage.rename = fs.rename;\nstorage.writeFile = fs.writeFile;\nstorage.unlink = fs.unlink;\nstorage.appendFile = fs.appendFile;\nstorage.readFile = fs.readFile;\nstorage.mkdirp = mkdirp;\n\n\n/**\n * Explicit name ...\n */\nstorage.ensureFileDoesntExist = function (file, callback) {\n  storage.exists(file, function (exists) {\n    if (!exists) { return callback(null); }\n\n    storage.unlink(file, function (err) { return callback(err); });\n  });\n};\n\n\n/**\n * Flush data in OS buffer to storage if corresponding option is set\n * @param {String} options.filename\n * @param {Boolean} options.isDir Optional, defaults to false\n * If options is a string, it is assumed that the flush of the file (not dir) called options was requested\n */\nstorage.flushToStorage = function (options, callback) {\n  var filename, flags;\n  if (typeof options === 'string') {\n    filename = options;\n    flags = 'r+';\n  } else {\n    filename = options.filename;\n    flags = options.isDir ? 'r' : 'r+';\n  }\n\n  // Windows can't fsync (FlushFileBuffers) directories. We can live with this as it cannot cause 100% dataloss\n  // except in the very rare event of the first time database is loaded and a crash happens\n  if (flags === 'r' && (process.platform === 'win32' || process.platform === 'win64')) { return callback(null); }\n\n  fs.open(filename, flags, function (err, fd) {\n    if (err) { return callback(err); }\n    fs.fsync(fd, function (errFS) {\n      fs.close(fd, function (errC) {\n        if (errFS || errC) {\n          var e = new Error('Failed to flush to storage');\n          e.errorOnFsync = errFS;\n          e.errorOnClose = errC;\n          return callback(e);\n        } else {\n          return callback(null);\n        }\n      });\n    });\n  });\n};\n\n\n/**\n * Fully write or rewrite the datafile, immune to crashes during the write operation (data will not be lost)\n * @param {String} filename\n * @param {String} data\n * @param {Function} cb Optional callback, signature: err\n */\nstorage.crashSafeWriteFile = function (filename, data, cb) {\n  var callback = cb || function () {}\n    , tempFilename = filename + '~';\n\n  async.waterfall([\n    async.apply(storage.flushToStorage, { filename: path.dirname(filename), isDir: true })\n  , function (cb) {\n      storage.exists(filename, function (exists) {\n        if (exists) {\n          storage.flushToStorage(filename, function (err) { return cb(err); });\n        } else {\n          return cb();\n        }\n      });\n    }\n  , function (cb) {\n      storage.writeFile(tempFilename, data, function (err) { return cb(err); });\n    }\n  , async.apply(storage.flushToStorage, tempFilename)\n  , function (cb) {\n      storage.rename(tempFilename, filename, function (err) { return cb(err); });\n    }\n  , async.apply(storage.flushToStorage, { filename: path.dirname(filename), isDir: true })\n  ], function (err) { return callback(err); })\n};\n\n\n/**\n * Ensure the datafile contains all the data, even if there was a crash during a full file write\n * @param {String} filename\n * @param {Function} callback signature: err\n */\nstorage.ensureDatafileIntegrity = function (filename, callback) {\n  var tempFilename = filename + '~';\n\n  storage.exists(filename, function (filenameExists) {\n    // Write was successful\n    if (filenameExists) { return callback(null); }\n\n    storage.exists(tempFilename, function (oldFilenameExists) {\n      // New database\n      if (!oldFilenameExists) {\n        return storage.writeFile(filename, '', 'utf8', function (err) { callback(err); });\n      }\n\n      // Write failed, use old version\n      storage.rename(tempFilename, filename, function (err) { return callback(err); });\n    });\n  });\n};\n\n\n\n// Interface\nmodule.exports = storage;\n","var path = require('path');\nvar fs = require('fs');\nvar _0777 = parseInt('0777', 8);\n\nmodule.exports = mkdirP.mkdirp = mkdirP.mkdirP = mkdirP;\n\nfunction mkdirP (p, opts, f, made) {\n    if (typeof opts === 'function') {\n        f = opts;\n        opts = {};\n    }\n    else if (!opts || typeof opts !== 'object') {\n        opts = { mode: opts };\n    }\n    \n    var mode = opts.mode;\n    var xfs = opts.fs || fs;\n    \n    if (mode === undefined) {\n        mode = _0777\n    }\n    if (!made) made = null;\n    \n    var cb = f || function () {};\n    p = path.resolve(p);\n    \n    xfs.mkdir(p, mode, function (er) {\n        if (!er) {\n            made = made || p;\n            return cb(null, made);\n        }\n        switch (er.code) {\n            case 'ENOENT':\n                if (path.dirname(p) === p) return cb(er);\n                mkdirP(path.dirname(p), opts, function (er, made) {\n                    if (er) cb(er, made);\n                    else mkdirP(p, opts, cb, made);\n                });\n                break;\n\n            // In the case of any other error, just see if there's a dir\n            // there already.  If so, then hooray!  If not, then something\n            // is borked.\n            default:\n                xfs.stat(p, function (er2, stat) {\n                    // if the stat fails, then that's super weird.\n                    // let the original error be the failure reason.\n                    if (er2 || !stat.isDirectory()) cb(er, made)\n                    else cb(null, made);\n                });\n                break;\n        }\n    });\n}\n\nmkdirP.sync = function sync (p, opts, made) {\n    if (!opts || typeof opts !== 'object') {\n        opts = { mode: opts };\n    }\n    \n    var mode = opts.mode;\n    var xfs = opts.fs || fs;\n    \n    if (mode === undefined) {\n        mode = _0777\n    }\n    if (!made) made = null;\n\n    p = path.resolve(p);\n\n    try {\n        xfs.mkdirSync(p, mode);\n        made = made || p;\n    }\n    catch (err0) {\n        switch (err0.code) {\n            case 'ENOENT' :\n                made = sync(path.dirname(p), opts, made);\n                sync(p, opts, made);\n                break;\n\n            // In the case of any other error, just see if there's a dir\n            // there already.  If so, then hooray!  If not, then something\n            // is borked.\n            default:\n                var stat;\n                try {\n                    stat = xfs.statSync(p);\n                }\n                catch (err1) {\n                    throw err0;\n                }\n                if (!stat.isDirectory()) throw err0;\n                break;\n        }\n    }\n\n    return made;\n};\n","/**\n * Manage access to data, be it to find, update or remove it\n */\nvar model = require('./model')\n  , _ = require('underscore')\n  ;\n\n\n\n/**\n * Create a new cursor for this collection\n * @param {Datastore} db - The datastore this cursor is bound to\n * @param {Query} query - The query this cursor will operate on\n * @param {Function} execFn - Handler to be executed after cursor has found the results and before the callback passed to find/findOne/update/remove\n */\nfunction Cursor (db, query, execFn) {\n  this.db = db;\n  this.query = query || {};\n  if (execFn) { this.execFn = execFn; }\n}\n\n\n/**\n * Set a limit to the number of results\n */\nCursor.prototype.limit = function(limit) {\n  this._limit = limit;\n  return this;\n};\n\n\n/**\n * Skip a the number of results\n */\nCursor.prototype.skip = function(skip) {\n  this._skip = skip;\n  return this;\n};\n\n\n/**\n * Sort results of the query\n * @param {SortQuery} sortQuery - SortQuery is { field: order }, field can use the dot-notation, order is 1 for ascending and -1 for descending\n */\nCursor.prototype.sort = function(sortQuery) {\n  this._sort = sortQuery;\n  return this;\n};\n\n\n/**\n * Add the use of a projection\n * @param {Object} projection - MongoDB-style projection. {} means take all fields. Then it's { key1: 1, key2: 1 } to take only key1 and key2\n *                              { key1: 0, key2: 0 } to omit only key1 and key2. Except _id, you can't mix takes and omits\n */\nCursor.prototype.projection = function(projection) {\n  this._projection = projection;\n  return this;\n};\n\n\n/**\n * Apply the projection\n */\nCursor.prototype.project = function (candidates) {\n  var res = [], self = this\n    , keepId, action, keys\n    ;\n\n  if (this._projection === undefined || Object.keys(this._projection).length === 0) {\n    return candidates;\n  }\n\n  keepId = this._projection._id === 0 ? false : true;\n  this._projection = _.omit(this._projection, '_id');\n\n  // Check for consistency\n  keys = Object.keys(this._projection);\n  keys.forEach(function (k) {\n    if (action !== undefined && self._projection[k] !== action) { throw new Error(\"Can't both keep and omit fields except for _id\"); }\n    action = self._projection[k];\n  });\n\n  // Do the actual projection\n  candidates.forEach(function (candidate) {\n    var toPush;\n    if (action === 1) {   // pick-type projection\n      toPush = { $set: {} };\n      keys.forEach(function (k) {\n        toPush.$set[k] = model.getDotValue(candidate, k);\n        if (toPush.$set[k] === undefined) { delete toPush.$set[k]; }\n      });\n      toPush = model.modify({}, toPush);\n    } else {   // omit-type projection\n      toPush = { $unset: {} };\n      keys.forEach(function (k) { toPush.$unset[k] = true });\n      toPush = model.modify(candidate, toPush);\n    }\n    if (keepId) {\n      toPush._id = candidate._id;\n    } else {\n      delete toPush._id;\n    }\n    res.push(toPush);\n  });\n\n  return res;\n};\n\n\n/**\n * Get all matching elements\n * Will return pointers to matched elements (shallow copies), returning full copies is the role of find or findOne\n * This is an internal function, use exec which uses the executor\n *\n * @param {Function} callback - Signature: err, results\n */\nCursor.prototype._exec = function(_callback) {\n  var res = [], added = 0, skipped = 0, self = this\n    , error = null\n    , i, keys, key\n    ;\n\n  function callback (error, res) {\n    if (self.execFn) {\n      return self.execFn(error, res, _callback);\n    } else {\n      return _callback(error, res);\n    }\n  }\n\n  this.db.getCandidates(this.query, function (err, candidates) {\n    if (err) { return callback(err); }\n\n    try {\n      for (i = 0; i < candidates.length; i += 1) {\n        if (model.match(candidates[i], self.query)) {\n          // If a sort is defined, wait for the results to be sorted before applying limit and skip\n          if (!self._sort) {\n            if (self._skip && self._skip > skipped) {\n              skipped += 1;\n            } else {\n              res.push(candidates[i]);\n              added += 1;\n              if (self._limit && self._limit <= added) { break; }\n            }\n          } else {\n            res.push(candidates[i]);\n          }\n        }\n      }\n    } catch (err) {\n      return callback(err);\n    }\n\n    // Apply all sorts\n    if (self._sort) {\n      keys = Object.keys(self._sort);\n\n      // Sorting\n      var criteria = [];\n      for (i = 0; i < keys.length; i++) {\n        key = keys[i];\n        criteria.push({ key: key, direction: self._sort[key] });\n      }\n      res.sort(function(a, b) {\n        var criterion, compare, i;\n        for (i = 0; i < criteria.length; i++) {\n          criterion = criteria[i];\n          compare = criterion.direction * model.compareThings(model.getDotValue(a, criterion.key), model.getDotValue(b, criterion.key), self.db.compareStrings);\n          if (compare !== 0) {\n            return compare;\n          }\n        }\n        return 0;\n      });\n\n      // Applying limit and skip\n      var limit = self._limit || res.length\n        , skip = self._skip || 0;\n\n      res = res.slice(skip, skip + limit);\n    }\n\n    // Apply projection\n    try {\n      res = self.project(res);\n    } catch (e) {\n      error = e;\n      res = undefined;\n    }\n\n    return callback(error, res);\n  });\n};\n\nCursor.prototype.exec = function () {\n  this.db.executor.push({ this: this, fn: this._exec, arguments: arguments });\n};\n\n\n\n// Interface\nmodule.exports = Cursor;\n","module.exports = require(\"events\");","/*---------------------------------------------------------\r\n * Copyright (C) Xored Software Inc. All rights reserved.\r\n * Licensed under the MIT License. See LICENSE in the project root for license information.\r\n *--------------------------------------------------------*/\r\n\r\n'use strict';\r\n\r\nimport vscode = require('vscode');\r\nimport { getDirtyFile } from './nimUtils';\r\nimport { execNimSuggest, NimSuggestType } from './nimSuggestExec';\r\n\r\nexport class NimSignatureHelpProvider implements vscode.SignatureHelpProvider {\r\n\r\n  public provideSignatureHelp(document: vscode.TextDocument, position: vscode.Position, token: vscode.CancellationToken): Thenable<vscode.SignatureHelp> {\r\n    return new Promise<vscode.SignatureHelp>((resolve, reject) => {\r\n      var filename = document.fileName;\r\n\r\n      var currentArgument = 0;\r\n      var identBeforeDot = '';\r\n      {\r\n        var lines = document.getText().split('\\n');\r\n        var cursorX = position.character - 1, cursorY = position.line;\r\n        var line = lines[cursorY];\r\n        var bracketsWithin = 0;\r\n        while (line[cursorX] !== '(' || bracketsWithin !== 0) {\r\n          if ((line[cursorX] === ',' || line[cursorX] === ';') && bracketsWithin === 0)\r\n            currentArgument++;\r\n          else if (line[cursorX] === ')')\r\n            bracketsWithin++;\r\n          else if (line[cursorX] === '(')\r\n            bracketsWithin--;\r\n\r\n          cursorX--;\r\n\r\n          if (cursorX < 0) {\r\n            if (cursorY - 1 < 0) {\r\n              resolve();\r\n              return;\r\n            }\r\n            line = lines[--cursorY];\r\n          }\r\n        }\r\n\r\n        var dotPosition = -1, start = -1;\r\n        while (cursorX >= 0) {\r\n          if (line[cursorX] === '.') {\r\n            dotPosition = cursorX;\r\n            break;\r\n          }\r\n          cursorX--;\r\n        }\r\n\r\n        while (cursorX >= 0 && dotPosition !== -1) {\r\n          if (line[cursorX].search('[ \\t\\({=]') !== -1) {\r\n            start = cursorX + 1;\r\n            break;\r\n          }\r\n          cursorX--;\r\n        }\r\n\r\n        if (start === -1)\r\n          start = 0;\r\n\r\n        if (start !== -1) {\r\n          identBeforeDot = line.substring(start, dotPosition);\r\n        }\r\n      }\r\n\r\n      execNimSuggest(NimSuggestType.con, filename, position.line + 1, position.character, getDirtyFile(document))\r\n        .then(items => {\r\n          var signatures = new vscode.SignatureHelp();\r\n          var isModule = 0;\r\n          if (items && items.length > 0)\r\n            signatures.activeSignature = 0;\r\n          if (items) {\r\n            items.forEach(item => {\r\n              var signature = new vscode.SignatureInformation(item.type, item.documentation);\r\n\r\n              var genericsCleanType = '';\r\n              {\r\n                var insideGeneric = 0;\r\n                for (var i = 0; i < item.type.length; i++) {\r\n                  if (item.type[i] === '[')\r\n                    insideGeneric++;\r\n                  if (!insideGeneric)\r\n                    genericsCleanType += item.type[i];\r\n                  if (item.type[i] === ']')\r\n                    insideGeneric--;\r\n                }\r\n              }\r\n\r\n              var signatureCutDown = /(proc|macro|template|iterator|func) \\((.+: .+)*\\)/.exec(genericsCleanType);\r\n              if (signatureCutDown) {\r\n                var parameters = signatureCutDown[2].split(', ');\r\n                parameters.forEach(parameter => {\r\n                  signature.parameters.push(new vscode.ParameterInformation(parameter));\r\n                });\r\n              }\r\n\r\n              if (item.names[0] === identBeforeDot || item.path.search('/' + identBeforeDot + '/') !== -1 || item.path.search('\\\\\\\\' + identBeforeDot + '\\\\\\\\') !== -1)\r\n                isModule++;\r\n\r\n              signatures.signatures.push(signature);\r\n            });\r\n          }\r\n          signatures.activeParameter = isModule > 0 || identBeforeDot === '' ? currentArgument : currentArgument + 1;\r\n\r\n          resolve(signatures);\r\n        }).catch(reason => reject(reason));\r\n    });\r\n  }\r\n}\r\n","/*---------------------------------------------------------\r\n * Copyright (C) Xored Software Inc. All rights reserved.\r\n * Licensed under the MIT License. See LICENSE in the project root for license information.\r\n *--------------------------------------------------------*/\r\n\r\n'use strict';\r\n\r\nimport vscode = require('vscode');\r\nimport cp = require('child_process');\r\nimport fs = require('fs');\r\nimport { getDirtyFile, getNimPrettyExecPath } from './nimUtils';\r\n\r\nexport class NimFormattingProvider implements vscode.DocumentFormattingEditProvider {\r\n\r\n  public provideDocumentFormattingEdits(document: vscode.TextDocument, options: vscode.FormattingOptions, token: vscode.CancellationToken): vscode.TextEdit[] | Thenable<vscode.TextEdit[]> {\r\n    return new Promise((resolve, reject) => {\r\n      if (getNimPrettyExecPath() === '') {\r\n        vscode.window.showInformationMessage('No \\'nimpretty\\' binary could be found in PATH environment variable');\r\n        resolve([]);\r\n      } else {\r\n        let file = getDirtyFile(document);\r\n        let config = vscode.workspace.getConfiguration('nim');\r\n        let res = cp.spawnSync(getNimPrettyExecPath(), ['--backup:OFF', '--indent:' + config['nimprettyIndent'], '--maxLineLen:' + config['nimprettyMaxLineLen'], file], { cwd: vscode.workspace.rootPath });\r\n\r\n        if (res.status !== 0) {\r\n          reject(res.error);\r\n        } else {\r\n          if (!fs.existsSync(file)) {\r\n            reject(file + ' file not found');\r\n          } else {\r\n            let content = fs.readFileSync(file, 'utf-8');\r\n            let range = document.validateRange(new vscode.Range(new vscode.Position(0, 0), new vscode.Position(1000000, 1000000)));\r\n            resolve([vscode.TextEdit.replace(range, content)]);\r\n          }\r\n        }\r\n      }\r\n    });\r\n  }\r\n}\r\n","/*---------------------------------------------------------\r\n * Copyright (C) Xored Software Inc. All rights reserved.\r\n * Licensed under the MIT License. See LICENSE in the project root for license information.\r\n *--------------------------------------------------------*/\r\n\r\n'use strict';\r\n\r\nimport vscode = require('vscode');\r\nimport cp = require('child_process');\r\nimport os = require('os');\r\nimport { isWorkspaceFile, getNimExecPath, getProjectFileInfo, getProjects, isProjectMode, ProjectFileInfo, toLocalFile, outputLine } from './nimUtils';\r\nimport { execNimSuggest, NimSuggestType, NimSuggestResult } from './nimSuggestExec';\r\n\r\nexport interface ICheckResult {\r\n    file: string;\r\n    line: number;\r\n    column: number;\r\n    msg: string;\r\n    severity: string;\r\n}\r\n\r\nlet executors: { [project: string]: { initialized: boolean, process?: cp.ChildProcess } } = {};\r\n\r\nfunction nimExec(project: ProjectFileInfo, command: string, args: string[], useStdErr: boolean, callback: (lines: string[]) => any) {\r\n    return new Promise((resolve, reject) => {\r\n        if (!getNimExecPath()) {\r\n            return resolve([]);\r\n        }\r\n        let projectPath = toLocalFile(project);\r\n        if (executors[projectPath] && executors[projectPath].initialized) {\r\n            let ps = executors[projectPath].process;\r\n            executors[projectPath] = { initialized: false, process: undefined };\r\n            if (ps) {\r\n                ps.kill('SIGKILL');\r\n            }\r\n        } else {\r\n            executors[projectPath] = { initialized: false, process: undefined };\r\n        }\r\n        let executor = cp.spawn(getNimExecPath(), [command, ...args], { cwd: project.wsFolder.uri.fsPath });\r\n        executors[projectPath].process = executor;\r\n        executors[projectPath].initialized = true;\r\n        executor.on('error', (err) => {\r\n            if (err && (<any>err).code === 'ENOENT') {\r\n                vscode.window.showInformationMessage('No \\'nim\\' binary could be found in PATH: \\'' + process.env['PATH'] + '\\'');\r\n                return resolve([]);\r\n            }\r\n        });\r\n        executor.stdout.on('data', data => {\r\n            outputLine('[info] nim check output:\\n' + data.toString());\r\n        });\r\n        var out = '';\r\n        executor.on('exit', (code, signal) => {\r\n            if (signal === 'SIGKILL') {\r\n                reject([]);\r\n            } else {\r\n                executors[projectPath] = { initialized: false, process: undefined };\r\n                try {\r\n                    let split = out.split(os.EOL);\r\n                    if (split.length === 1) {\r\n                        var lfSplit = split[0].split('\\n');\r\n                        if (lfSplit.length > split.length)\r\n                            split = lfSplit;\r\n                    }\r\n\r\n                    var ret = callback(split);\r\n                    resolve(ret);\r\n                } catch (e) {\r\n                    reject(e);\r\n                }\r\n            }\r\n        });\r\n\r\n        if (useStdErr) {\r\n            executor.stderr.on('data', (data) => {\r\n                out += data.toString();\r\n            });\r\n        } else {\r\n            executor.stdout.on('data', (data) => {\r\n                out += data.toString();\r\n            });\r\n        }\r\n    });\r\n}\r\n\r\nfunction parseErrors(lines: string[]): ICheckResult[] {\r\n    var ret: ICheckResult[] = [];\r\n    var messageText = '';\r\n    var lastFile = { file: '', column: '', line: '' };\r\n    for (var i = 0; i < lines.length; i++) {\r\n        let line = lines[i].trim();\r\n        if (line.startsWith('Hint:')) {\r\n            continue;\r\n        }\r\n        let match = /^([^(]*)?\\((\\d+)(,\\s(\\d+))?\\)( (\\w+):)? (.*)/.exec(line);\r\n        if (!match) {\r\n            if (messageText.length < 1024) {\r\n                messageText += os.EOL + line;\r\n            }\r\n        } else {\r\n            let [, file, lineStr, , charStr, , severity, msg] = match;\r\n            if (msg === 'template/generic instantiation from here') {\r\n                if (isWorkspaceFile(file)) {\r\n                    lastFile = { file: file, column: charStr, line: lineStr };\r\n                }\r\n            } else {\r\n                if (messageText !== '' && ret.length > 0) {\r\n                    ret[ret.length - 1].msg += os.EOL + messageText;\r\n                }\r\n                messageText = '';\r\n                if (isWorkspaceFile(file)) {\r\n                    ret.push({ file: file, line: parseInt(lineStr), column: parseInt(charStr), msg: msg, severity });\r\n                } else if (lastFile.file !== '') {\r\n                    ret.push({ file: lastFile.file, line: parseInt(lastFile.line), column: parseInt(lastFile.column), msg: msg, severity });\r\n                }\r\n                lastFile = { file: '', column: '', line: '' };\r\n            }\r\n        }\r\n    }\r\n    if (messageText !== '' && ret.length > 0) {\r\n        ret[ret.length - 1].msg += os.EOL + messageText;\r\n    }\r\n\r\n    return ret;\r\n}\r\n\r\nfunction parseNimsuggestErrors(items: NimSuggestResult[]): ICheckResult[] {\r\n    var ret: ICheckResult[] = [];\r\n    for (var i = 0; i < items.length; i++) {\r\n        let item = items[i];\r\n        if (item.path === '???' && item.type === 'Hint') {\r\n            continue;\r\n        }\r\n        ret.push({ file: item.path, line: item.line, column: item.column, msg: item.documentation, severity: item.type });\r\n    }\r\n    return ret;\r\n}\r\n\r\nexport function check(filename: string, nimConfig: vscode.WorkspaceConfiguration): Promise<ICheckResult[]> {\r\n    var runningToolsPromises: Promise<any>[] = [];\r\n\r\n    if (!!nimConfig['useNimsuggestCheck']) {\r\n        runningToolsPromises.push(new Promise((resolve, reject) => {\r\n            execNimSuggest(NimSuggestType.chk, filename, 0, 0, '').then(items => {\r\n                if (items && items.length > 0) {\r\n                    resolve(parseNimsuggestErrors(items));\r\n                } else {\r\n                    resolve([]);\r\n                }\r\n            }).catch(reason => reject(reason));\r\n        }));\r\n    } else {\r\n        if (!isProjectMode()) {\r\n            let project = getProjectFileInfo(filename);\r\n            runningToolsPromises.push(nimExec(project, 'check', ['--listFullPaths', project.filePath], true, parseErrors));\r\n        } else {\r\n            getProjects().forEach(project => {\r\n                runningToolsPromises.push(nimExec(project, 'check', ['--listFullPaths', project.filePath], true, parseErrors));\r\n            });\r\n        }\r\n    }\r\n\r\n    return Promise.all(runningToolsPromises).then(resultSets => [].concat.apply([], resultSets));\r\n}\r\n\r\nvar evalTerminal: vscode.Terminal | undefined;\r\n\r\nexport function activateEvalConsole() {\r\n    vscode.window.onDidCloseTerminal((e: vscode.Terminal) => {\r\n        if (evalTerminal && e.processId === evalTerminal.processId) {\r\n            evalTerminal = undefined;\r\n        }\r\n    });\r\n}\r\n\r\nexport function execSelectionInTerminal(document?: vscode.TextDocument) {\r\n    if (vscode.window.activeTextEditor) {\r\n        if (!getNimExecPath()) {\r\n            return;\r\n        }\r\n\r\n        if (!evalTerminal) {\r\n            evalTerminal = vscode.window.createTerminal('Nim Console');\r\n            evalTerminal.show(true);\r\n            evalTerminal.sendText(getNimExecPath() + ' ' + 'secret\\n');\r\n        }\r\n        evalTerminal.sendText(vscode.window.activeTextEditor.document.getText(vscode.window.activeTextEditor.selection));\r\n        // evalTerminal.sendText('\\n');\r\n    }\r\n}\r\n"],"sourceRoot":""}